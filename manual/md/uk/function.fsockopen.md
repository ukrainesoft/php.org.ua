- [« dns_get_record](function.dns-get-record.md)
- [gethostbyaddr »](function.gethostbyaddr.md)

- [PHP Manual](index.md)
- [Мережні функції](ref.network.md)
- Відкриває з'єднання з інтернет-сокетом або доменним сокетом Unix

# fsockopen

(PHP 4, PHP 5, PHP 7, PHP 8)

fsockopen — Відкриває з'єднання з інтернет-сокетом або доменним сокетом
Unix

### Опис

**fsockopen**(
string `$hostname`,
int `$port` u003d -1,
int `&$error_code` u003d **`null`**,
string `&$error_message` u003d **`null`**,
?float `$timeout` u003d **`null`**
): resource \ | false

Встановлює з'єднання із сокетом ресурсу `hostname`.

PHP підтримує цільові ресурси в інтернеті та Unix-доменах у тому вигляді,
як вони описані в [Список підтримуваних транспортних
протоколів] (transports.md). Список підтримуваних транспортів можна
отримати за допомогою функції
[stream_get_transports()](function.stream-get-transports.md).

За умовчанням сокет буде відкритий у режимі блокування. Переключити його на
неблокуючий режим можна функцією
[stream_set_blocking()](function.stream-set-blocking.md).

[stream_socket_client()](function.stream-socket-client.md) виконує
аналогічну функцію, але надає більш широкий вибір налаштувань
з'єднання, що включає встановлення неблокуючого режиму та можливість
надання потокового контексту.

### Список параметрів

`hostname`
Якщо [встановлена](openssl.installation.md) підтримка OpenSSL, можна
використовувати SSL- або TLS-протоколи з'єднань поверх TCP/IP при
підключення до віддаленого хоста. Для цього перед `hostname` потрібно
додати префікс `ssl://` або `tls://`.

`port`
Номер порту. Його можна не вказувати, передавши `-1` для тих протоколів,
які використовують порти, наприклад `unix://`.

`error_code`
Якщо цей параметр надати, то у разі виникнення помилки
системного виклику функції `connect()` він прийматиме номер цієї
помилки.

Якщо значення параметра `error_code` дорівнює `0`, а функція повернула
**`false`**, отже помилка сталася до виклику `connect()`. В
в більшості випадків це свідчить про проблеми при ініціалізації
сокет.

`error_message`
Повідомлення про помилку у вигляді рядка.

`timeout`
Час очікування з'єднання за секунди. Якщо **`null`**, використовується
налаштування `php.ini`
[default_socket_timeout](filesystem.configuration.md#ini.default-socket-timeout).

> **Примітка**:
>
> Якщо потрібно встановити час очікування/запису даних через
> сокет, використовуйте функцію
> [stream_set_timeout()](function.stream-set-timeout.md), т.к.
> параметр `timeout` функції **fsockopen()** обмежує лише час
> процесу встановлення з'єднання із сокетом.

### Значення, що повертаються

**fsockopen()** повертає файловий покажчик, який можна
використовувати з функціями, що працюють із файлами (такі як
[fgets()](function.fgets.md), [fgetss()](function.fgetss.md),
[fwrite()](function.fwrite.md), [fclose()](function.fclose.md) та
[feof()](function.feof.md)). Якщо дзвінок завершиться невдало, функція
поверне **`false`**.

### Помилки

Викликає помилку рівня **`E_WARNING`**, якщо `hostname` не є
допустимим доменом.

### Список змін

| Версія | Опис |
|--------|---------------------------------------- ---|
| 8.0.0 | `timeout` тепер допускає значення null. |

### Приклади

**Приклад #1 Приклад використання **fsockopen()****

` <?php$fp u003d fsockopen("www.example.com", 80, $errno, $errstr, 30);if (!$fp) {   echo "$errstr ($errno)<br />
";} else {   $out u003d "GET//HTTP/1.1
";   $out .u003d "Host: www.example.com
";   $out .u003d "Connection: Close

";   fwrite($fp, $out);   while (!feof($fp)) {        echo fgets($fp, 128);    } |

**Приклад #2 Використання UDP-з'єднання**

Приклад нижче демонструє, як отримати день і час від служби UDP
"daytime" (порт 13) на вашій машині.

` <?php$fp u003d fsockopen("udp://127.0.0.1", 13, $errno, $errstr);if (!$fp) {   echo "ERROR: $errno - $rr>
";} else {   fwrite($fp, "
");   echofread($fp, 26);   fclose($fp);}?> `

### Примітки

> **Примітка**:
>
> Залежно від оточення, Unix-домен або час очікування установки
> підключення можуть бути недоступними.

**Увага**

Іноді UDP-сокети набувають статусу відкритих, навіть якщо віддалений хост
недоступний. Помилка проявить себе лише під час читання чи запису даних
в/з цього сокету. Причина цього полягає в тому, що протокол UDP
передає дані без встановлення з'єднання, а це означає, що
операційна система не встановлює та не тримає з'єднання з сокетом,
поки не розпочнеться передача даних.

> **Примітка**: Якщо вказувати числову адресу IPv6 (наприклад,
> `fe80::1`) ви повинні укладати його у квадратні дужки. Наприклад,
> `tcp://[fe80::1]:80`.

### Дивіться також

- [pfsockopen()](function.pfsockopen.md) - Відкриває постійне
з'єднання з інтернет-сокетом або доменним сокетом Unix
- [stream_socket_client()](function.stream-socket-client.md) -
Відкрити з'єднання з інтернет-сокетом або доменним сокетом Unix
- [stream_set_blocking()](function.stream-set-blocking.md) -
Встановити блокуючий/неблокуючий режим у потоці
- [stream_set_timeout()](function.stream-set-timeout.md) -
Встановити час очікування для потоку
- [fgets()](function.fgets.md) - Читає рядок із файлу
- [fgetss()](function.fgetss.md) - Читає рядок з файлу та видаляє
HTML-теги
- [fwrite()](function.fwrite.md) - Бінарно-безпечний запис у файл
- [fclose()](function.fclose.md) - Закриває відкритий дескриптор
файлу
- [feof()](function.feof.md) - Перевіряє, чи кінець файлу досягнуто
- [socket_connect()](function.socket-connect.md) - Починає
з'єднання з сокетом
- [Модуль Curl](ref.curl.md)
