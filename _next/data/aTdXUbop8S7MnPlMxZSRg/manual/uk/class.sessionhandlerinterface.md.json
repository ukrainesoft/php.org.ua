{"pageProps":{"page":{"slug":"class.sessionhandlerinterface.md","content":"# Клас SessionHandlerInterface\n\n(PHP 5 >= 5.4.0, PHP 7, PHP 8)\n\n## Вступ\n\n**SessionHandlerInterface** - це інтерфейс, який визначає мінімальний прототип для створення користувальницького оброблювача сесії. Для надання користувальницького оброблювача сесії функції [session\\_set\\_save\\_handler()](function.session-set-save-handler.md), Використовуючи її ООП реалізацію, клас повинен реалізовувати цей інтерфейс.\n\nЗауважте, що callback-методи цього класу створені для внутрішніх викликів PHP і не призначені для викликів з вашого коду.\n\n## Огляд інтерфейсів\n\n```classsynopsis\n\n    \n     interface SessionHandlerInterface {\n\n    /* Методы */\n    \n   public close(): bool\npublic destroy(string $id): bool\npublic gc(int $max_lifetime): int|false\npublic open(string $path, string $name): bool\npublic read(string $id): string|false\npublic write(string $id, string $data): bool\n\n   }\n```\n\n**Приклад #1 Приклад використання** SessionHandlerInterface\\*\\*\\*\\*\n\nНаступний приклад реалізує файлову сесію так само, як це реалізовано у внутрішньому обробнику сесії PHP. Цей приклад може бути легко розширений для забезпечення зберігання сесій в базі даних.\n\nЗверніть увагу, що ми використовуємо об'єктно-орієнтовані прототипи з функцією [session\\_set\\_save\\_handler()](function.session-set-save-handler.md) та реєструємо функцію завершення (shutdown) використовуючи один із параметрів цієї функції. Ця дія рекомендується проводити в більшості випадків, коли об'єкти реєструються як обробники сесії.\n\n**Застереження**\n\nДля стислості в цьому прикладі не додано перевірку вхідних даних. Зверніть увагу, що параметр `$id` надається користувачем і обов'язково повинен перевірятися для виключення можливих атак, які використовують, наприклад, проблеми обходу шляху . *Так що в жодному разі не використовуйте цей код у промисловій експлуатації, не додавши відповідних перевірок.*\n\n```php\n<?php\nclass MySessionHandler implements SessionHandlerInterface\n{\n    private $savePath;\n    public function open($savePath, $sessionName): bool\n    {\n        $this->savePath = $savePath;\n        if (!is_dir($this->savePath)) {\n            mkdir($this->savePath, 0777);\n        }\n        return true;\n    }\n    public function close(): bool\n    {\n        return true;\n    }\n    #[\\ReturnTypeWillChange]\n    public function read($id)\n    {\n        return (string)@file_get_contents(\"$this->savePath/sess_$id\");\n    }\n    public function write($id, $data): bool\n    {\n        return file_put_contents(\"$this->savePath/sess_$id\", $data) === false ? false : true;\n    }\n    public function destroy($id): bool\n    {\n        $file = \"$this->savePath/sess_$id\";\n        if (file_exists($file)) {\n            unlink($file);\n        }\n        return true;\n    }\n    #[\\ReturnTypeWillChange]\n    public function gc($maxlifetime)\n    {\n        foreach (glob(\"$this->savePath/sess_*\") as $file) {\n            if (filemtime($file) + $maxlifetime < time() && file_exists($file)) {\n                unlink($file);\n            }\n        }\n        return true;\n    }\n}\n$handler = new MySessionHandler();\nsession_set_save_handler($handler, true);\nsession_start();\n\n// продолжаем работать с переменными сессии, устанавливая или читая их значение из $_SESSION\n```\n\n## Зміст\n\n-   [SessionHandlerInterface::close](sessionhandlerinterface.close.md) \\- Закриває сесію\n-   [SessionHandlerInterface::destroy](sessionhandlerinterface.destroy.md) \\- Знищує сесію\n-   [SessionHandlerInterface::gc](sessionhandlerinterface.gc.md) \\- Очищає старі сесії\n-   [SessionHandlerInterface::open](sessionhandlerinterface.open.md) \\- Ініціалізує сесію\n-   [SessionHandlerInterface::read](sessionhandlerinterface.read.md)— Читає дані сесії\n-   [SessionHandlerInterface::write](sessionhandlerinterface.write.md)— Записати дані сесії\n","title":"Клас SessionHandlerInterface","contentType":2,"navigation":[{"sessionhandler.write.md":"« SessionHandler::write"},{"sessionhandlerinterface.close.md":"SessionHandlerInterface::close »"},{"index.md":"PHP Manual"},{"book.session.md":"Сесії"}]}},"__N_SSG":true}