{"pageProps":{"page":{"slug":"mongodb-driver-readpreference.construct.md","content":"# MongoDB\\\\Driver\\\\ReadPreference::\\_\\_construct\n\n(mongodb >=1.0.0)\n\nMongoDB\\\\Driver\\\\ReadPreference::\\_\\_construct — Створити новий ReadPreference\n\n### Опис\n\n```methodsynopsis\nfinal public MongoDB\\Driver\\ReadPreference::__construct(string|int $mode, ?array $tagSets = null, ?array $options = null)\n```\n\nСтворює новий [MongoDB\\\\Driver\\\\ReadPreference](class.mongodb-driver-readpreference.md)що є незмінним об'єктом значення.\n\n### Список параметрів\n\n`mode`\n\n**Режим переваги читання**\n\n| Значение | Опис |\n| --- | --- |\n| \\*\\*`MongoDB\\Driver\\ReadPreference::RP_PRIMARY`\\*\\*or`\"primary\"` |  |\n| Усі операції зчитується з поточного первинного вузла реплік набору. Це перевага для читання за промовчанням для MongoDB. |  |\n\n\\*\\*`MongoDB\\Driver\\ReadPreference::RP_PRIMARY_PREFERRED`\\*\\*or`\"primaryPreferred\"`\n\nУ більшості ситуацій операції зчитуються з первинного вузла, але якщо він недоступний, операції зчитуються з вторинних вузлів.\n\n\\*\\*`MongoDB\\Driver\\ReadPreference::RP_SECONDARY`\\*\\*или`\"secondary\"`\n\nУсі операції зчитуються із вторинних вузлів набору реплік.\n\n\\*\\*`MongoDB\\Driver\\ReadPreference::RP_SECONDARY_PREFERRED`\\*\\*или`\"secondaryPreferred\"`\n\nУ більшості ситуацій операції зчитуються з вторинних членів, але якщо вторинні члени недоступні, операції зчитуються з первинного вузла.\n\n\\*\\*`MongoDB\\Driver\\ReadPreference::RP_NEAREST`\\*\\*or`\"nearest\"`\n\nОперації зчитуються з члена набору реплік із найменшою затримкою мережі, незалежно від типу члена.\n\n`tagSets`\n\nНабори тегів дозволяють настроювати операції читання для певних членів набору реплік. Цей параметр має бути масивом асоціативних масивів, кожен з яких містить нуль або кілька пар ключ-значення. При виборі сервера для операції читання драйвер намагається вибрати вузол, що має всі теги в наборі (тобто асоціативний масив пар ключ-значення). Якщо вибір не вдався, driver will attempt subsequent sets. Порожній набір тегів (`array()`) буде відповідати будь-якому вузлу і може використовуватись як резервний.\n\nТеги не сумісні з режимом **`MongoDB\\Driver\\ReadPreference::RP_PRIMARY`**, і, зазвичай, застосовується лише за виборі вторинного члена набору для операції читання. Однак режим **`MongoDB\\Driver\\ReadPreference::RP_NEAREST`** у поєднанні з набором тегів вибирає відповідний член з найменшою затримкою мережі. Цей член може бути первинним чи вторинним.\n\n`options`\n\n**options**\n\n| Опция | Тип | Опис |\n| --- | --- | --- |\n| hedge | object | array |\n| Вказує, чи використовувати [» хеджовані читання](https://www.mongodb.com/docs/manual/core/sharded-cluster-query-router/#mongos-hedged-reads), що підтримуються MongoDB 4.4+ для закритих запитів. |  |  |\n\nХеджовані читання з сервера доступні для всіх неосновних переваг читання та включаються за умовчанням під час використання режиму `\"nearest\"`. Цей параметр дозволяє явно дозволити читання з хеджування на сервері для неосновних переваг читання, вказавши `['enabled' => true]`, або явно відключивши серверне читання з хеджуванням для переваг читання `\"nearest\"`, указав`['enabled' => false]`\n\n| | maxStalenessSeconds | int |\n\nВизначає максимальне відставання реплікації чи “staleness” для читання з вторинних вузлів. Коли оцінювана staleness вторинних вузлів перевищує це значення, драйвер припиняє використовувати її для операцій читання.\n\nЯкщо вказано, максимальний staleness має бути 32-бітовим числом без знака, більшим чи рівним **`MongoDB\\Driver\\ReadPreference::SMALLEST_MAX_STALENESS_SECONDS`**\n\nПо умолчанию используется\\*\\*`MongoDB\\Driver\\ReadPreference::NO_MAX_STALENESS`\\*\\*, що означає, що драйвер не враховуватиме відставання вторинних вузлів при виборі напрямку для операції читання.\n\nЦей параметр несумісний із режимом **`MongoDB\\Driver\\ReadPreference::RP_PRIMARY`**. Вказівка ​​максимальної staleness також вимагає, щоб усі екземпляри MongoDB у розгортанні використовували MongoDB 3.4+. Виняток буде викинуто під час виконання, якщо екземпляри MongoDB у розгортанні мають старішу версію.\n\n### Помилки\n\n-   При помилці парсингу аргумент кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)\n-   При некоректному`mode` викидає [MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)\n-   Якщо `tagSets`надається як первинна перевага читання або має неправильний формат (тобто не масив з нуля або більше документів) викидає[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)\n-   Якщо опція `\"maxStalenessSeconds\"`надається для первинної переваги читання або знаходиться поза діапазоном, викидає[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)\n\n### список змін\n\n| Версия | Опис |\n| --- | --- |\n| PECL mongodb 1.8.0 | Добавлен параметр`\"hedge\"` |\n| PECL mongodb 1.3.0 |  |\n| Аргумент`mode` тепер набуває рядкового значення, яке відповідає URI-опції `\"readPreference\"`для[MongoDB\\\\Driver\\\\Manager::\\_\\_construct()](mongodb-driver-manager.construct.md) |  |\n\n| | PECL mongodb 1.2.0 |\n\nДобавлен третий аргумент`options`, який підтримує параметр `\"maxStalenessSeconds\"`\n\n### Приклади\n\n**Приклад #1 Приклад використання** MongoDB\\\\Driver\\\\ReadPreference::\\_\\_construct()\\*\\*\\*\\*\n\n```php\n<?php\n\n/* Предпочитать вторичный узел, но в случае отказа отступить к первичному. */\nvar_dump(new MongoDB\\Driver\\ReadPreference(MongoDB\\Driver\\ReadPreference::RP_SECONDARY_PREFERRED));\n\n/* Предпочитать узел в Нью-Йоркском центре обработки данных с минимальной задержкой. */\nvar_dump(new MongoDB\\Driver\\ReadPreference(MongoDB\\Driver\\ReadPreference::RP_NEAREST, [['dc' => 'ny']]));\n\n/* Требуется дополнительный узел, чья задержка репликации находится в пределах двух минут от основного */\nvar_dump(new MongoDB\\Driver\\ReadPreference(MongoDB\\Driver\\ReadPreference::RP_SECONDARY, null, ['maxStalenessSeconds' => 120]));\n\n/* Явно включить хеджирование чтения на сервере */\nvar_dump(new MongoDB\\Driver\\ReadPreference(MongoDB\\Driver\\ReadPreference::RP_SECONDARY, null, ['hedge' => ['enabled' => true]]));\n\n?>\n```\n\nРезультат виконання наведеного прикладу:\n\n```\nobject(MongoDB\\Driver\\ReadPreference)#1 (1) {\n  [\"mode\"]=>\n  string(18) \"secondaryPreferred\"\n}\nobject(MongoDB\\Driver\\ReadPreference)#1 (2) {\n  [\"mode\"]=>\n  string(7) \"nearest\"\n  [\"tags\"]=>\n  array(1) {\n    [0]=>\n    object(stdClass)#2 (1) {\n      [\"dc\"]=>\n      string(2) \"ny\"\n    }\n  }\n}\nobject(MongoDB\\Driver\\ReadPreference)#1 (2) {\n  [\"mode\"]=>\n  string(9) \"secondary\"\n  [\"maxStalenessSeconds\"]=>\n  int(120)\n}\nobject(MongoDB\\Driver\\ReadPreference)#1 (2) {\n  [\"mode\"]=>\n  string(9) \"secondary\"\n  [\"hedge\"]=>\n  object(stdClass)#1 (1) {\n    [\"enabled\"]=>\n    bool(true)\n  }\n}\n```\n\n### Дивіться також\n\n-   [» Посібник з переваги читання](https://www.mongodb.com/docs/manual/core/read-preference/)\n","title":"MongoDB\\\\Driver\\\\ReadPreference::\\_\\_construct","contentType":2,"navigation":[{"mongodb-driver-readpreference.bsonserialize.md":"« MongoDB\\\\Driver\\\\ReadPreference::bsonSerialize"},{"mongodb-driver-readpreference.gethedge.md":"MongoDB\\\\Driver\\\\ReadPreference::getHedge »"},{"index.md":"PHP Manual"},{"class.mongodb-driver-readpreference.md":"MongoDB\\\\Driver\\\\ReadPreference"}]}},"__N_SSG":true}