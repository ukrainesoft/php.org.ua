- [«db2_pclose](function.db2-pclose.md)
- [db2_prepare »](function.db2-prepare.md)

- [PHP Manual](index.md)
- [Функції IBM DB2](ref.ibm-db2.md)
- Повертає постійне з'єднання з базою даних

#db2_pconnect

(PECL ibm_db2 \>u003d 1.0.0)

db2_pconnect — Повертає постійне з'єднання з базою даних

### Опис

**db2_pconnect**(
string `$database`,
string `$username`,
string `$password`,
array `$options` u003d ?
): resource

Повертає постійне з'єднання з базою даних IBM DB2 Universal
Database, IBM Cloudscape або Apache Derby.

Для отримання додаткової інформації про постійні з'єднання
дивіться [Постійні з'єднання з базами
даних](features.persistent-connections.md).

Виклик [db2_close()](function.db2-close.md) у постійному з'єднанні
завжди повертає **`true`**, але базове клієнтське з'єднання DB2
залишається відкритим і чекає на обслуговування наступного відповідного
запиту **db2_pconnect()**.

Користувачі, які використовують ibm_db2 версії 1.9.0 або пізнішої,
повинні знати, що модуль виконає відкат транзакції для постійних
з'єднань в кінці запиту, тим самим завершивши транзакцію. Це
запобігає перенесенню блоку транзакції на наступний запит, який
використовує це з'єднання, якщо виконання скрипта завершується раніше,
ніж блок транзакції.

### Список параметрів

`database`
Псевдонім бази даних у клієнтському каталозі DB2.

`username`
Ім'я користувача, під яким здійснюється підключення до бази даних.

`password`
Пароль, який використовується для підключення до бази даних.

`options`
Асоціативний масив параметрів підключення, які впливають на поведінку
підключення, де допустимими ключами масиву є:

`autocommit`
Передача значення DB2_AUTOCOMMIT_ON включає автоматичну фіксацію
для цього дескриптора з'єднання.

Передача значення `DB2_AUTOCOMMIT_OFF` вимикає автоматичну фіксацію
для цього дескриптора з'єднання.

`DB2_ATTR_CASE`
Передача значення DB2_CASE_NATURAL вказує, що імена стовпців
повертаються у природному регістрі.

Передача значення DB2_CASE_LOWER вказує, що імена стовпців
повертаються у нижньому регістрі.

Передача значення DB2_CASE_UPPER вказує, що імена стовпців
повертаються у верхньому регістрі.

`CURSOR`
Передача значення `DB2_FORWARD_ONLY` задає курсор тільки вперед
ресурс оператора. Це тип курсору за промовчанням, який підтримується
на всіх серверах бази даних.

Передача значення `DB2_SCROLLABLE` задає курсор, що прокручується
ресурс оператора. Цей режим включає довільний доступ до рядків
набір результатів, але в даний час підтримується лише IBM DB2
Universal Database.

Наступна нова опція доступна у ibm_db2 версії 1.7.0 та новішої.

`trustedcontext`
Передача значення DB2_TRUSTED_CONTEXT_ENABLE містить довірений
контекст для цього дескриптора з'єднання. Параметр не можна встановити з
[db2_set_option()](function.db2-set-option.md).

Ключ працює лише в тому випадку, якщо база даних каталогізована
(навіть якщо база даних є локальною) або якщо ви вкажете повний
DSN під час створення з'єднання.

Щоб каталогізувати базу даних, використовуйте такі команди:

``` literallayout
db2 catalog tcpip node loopback remote <SERVERNAME> server <SERVICENAME>
db2 catalog database <LOCALDBNAME> as <REMOTEDBNAME> at node loopback
db2 "update dbm cfg using svcename <SERVICENAME>"
db2set DB2COMMu003dTCPIP
````

Наступні нові параметри i5/OS доступні в ibm_db2 версії 1.5.1 та новіші.

**Підказка**
Конфліктуючі атрибути з'єднання, що використовуються разом із постійними
з'єднаннями можуть призвести до невизначених результатів в i5/OS.
Політики сайту повинні бути встановлені для всіх програм, що використовують
кожен профіль користувача із постійним підключенням. При використанні
постійних з'єднань пропонується значення за замовчуванням
DB2_AUTOCOMMIT_ON.

`i5_lib`
Символьне значення, яке вказує бібліотеку за умовчанням, яка буде
використовуватись для дозволу некваліфікованих посилань на файли.
Неможливо, якщо з'єднання використовує режим іменування системи.

`i5_naming`
Значення `DB2_I5_NAMING_ON` включає режим іменування системи DB2 UDB
CLI iSeries. Файли кваліфікуються за допомогою роздільника косої межі
(/). Некваліфіковані файли дозволяються за допомогою списку
бібліотек для завдання.

Значення DB2_I5_NAMING_OFF відключає режим іменування за замовчуванням CLI
DB2 UDB, який є ім'ям SQL. Файли кваліфікуються з
використанням роздільника точки (.). Некваліфіковані файли
дозволяються з використанням бібліотеки за замовчуванням, або поточного
ідентифікатор користувача.

`i5_commit`
Атрибут i5_commit має бути встановлений до виклику **db2_pconnect()**.
Якщо значення змінюється після того, як з'єднання було встановлено та
з'єднання встановлено з віддаленим джерелом даних, зміна не
набуде чинності до наступного успішного **db2_pconnect()** для
дескриптора з'єднання.

> **Примітка**:
>
> Параметр php.ini `ibm_db2.i5_allow_commit`u003du003d0 або
> `DB2_I5_TXN_NO_COMMIT` є значенням за замовчуванням, але його можна
> Змінити за допомогою параметра `i5_commit`.

`DB2_I5_TXN_NO_COMMIT` - Контроль фіксації не використовується.

`DB2_I5_TXN_READ_UNCOMMITTED` - Брудне читання, неповторні reads, and
phantoms are possible.

`DB2_I5_TXN_READ_COMMITTED` - Брудне читання неможливе. Можливі
неповторне читання та фантоми.

`DB2_I5_TXN_REPEATABLE_READ` - Брудне читання та неповторні читання
неможливі. Можливі фантоми.

`DB2_I5_TXN_SERIALIZABLE` - Транзакції серіалізуються. Брудне читання,
неповторне читання і фантоми неможливі.

`i5_query_optimize`
`DB2_FIRST_IO` Усі запити оптимізовані з метою максимально швидкого
повернення першої сторінки виводу. Ця мета добре працює, коли висновок
контролюється користувачем, який, швидше за все, скасує запит
після перегляду першої сторінки вихідних даних. Запити, закодовані
з пропозицією OPTIMIZE FOR nnn ROWS, відповідають цілі, зазначеній у
реченні.

`DB2_ALL_IO` Всі запити оптимізовані з метою виконати весь запит
завершення у найкоротші терміни. Це гарний варіант, коли вихідні
дані запиту записуються у файл або звіт або коли інтерфейс ставить
вихідні дані у чергу. Запити, закодовані з пропозицією
OPTIMIZE FOR nnn ROWS, відповідають цілі, зазначеній у реченні. Це
значення за замовчуванням.

`i5_dbcs_alloc`
`DB2_I5_DBCS_ALLOC_ON` Значення включає схему розподілу DB2 6X для
збільшення розміру шпальти перетворення DBCS.

`DB2_I5_DBCS_ALLOC_OFF` Значення вимикає схему розподілу DB2 6X
збільшення розміру стовпця перетворення DBCS.

> **Примітка**:
>
> Параметр php.ini `ibm_db2.i5_dbcs_alloc`u003du003d0 або
> `DB2_I5_DBCS_ALLOC_OFF` є за замовчуванням, але його можна
> Змінити за допомогою параметра `i5_dbcs_alloc`.

`i5_date_fmt`
`DB2_I5_FMT_ISO` - Використовується формат дати Міжнародної організації з
стандартизації (ISO) yyyy-mm-dd. Це значення за промовчанням.

`DB2_I5_FMT_USA` - Використовується формат дати США mm/dd/yyyy.

`DB2_I5_FMT_EUR` - Використовується європейський формат дати dd.mm.yyyy.

`DB2_I5_FMT_JIS` - Використовується японський формат дати yyyy-mm-dd.

`DB2_I5_FMT_MDY` - Використовується формат дати mm/dd/yyyy.

`DB2_I5_FMT_DMY` - Використовується формат дати dd/mm/yyyy.

`DB2_I5_FMT_YMD` - Використовується формат дати yy/mm/dd.

DB2_I5_FMT_JUL - Використовується юліанський формат дати yy/ddd.

`DB2_I5_FMT_JOB` - Використовується стандартне завдання.

`i5_date_sep`
`DB2_I5_SEP_SLASH` -Як розділювач дати використовується коса риса
(/). Це значення за промовчанням.

`DB2_I5_SEP_DASH` - Як роздільник дати використовується тире (-).

`DB2_I5_SEP_PERIOD` - Як роздільник дати використовується точка
(.).

`DB2_I5_SEP_COMMA` - Як роздільник дати використовується кома
(,).

`DB2_I5_SEP_BLANK` - В якості роздільника дати використовується пробіл.

`DB2_I5_SEP_JOB` - Використовується стандартне завдання.

`i5_time_fmt`
`DB2_I5_FMT_ISO` - Використовується формат часу Міжнародної організації
стандартизації (ISO) hh.mm.ss. Це значення за промовчанням.

`DB2_I5_FMT_USA` - Використовується формат часу США hh:mmxx, де xx - це
AM чи PM.

DB2_I5_FMT_EUR - Використовується європейський формат часу hh.mm.ss.

`DB2_I5_FMT_JIS` - Використовується японський промисловий стандартний формат
часу hh:mm:ss.

`DB2_I5_FMT_HMS` - Використовується формат hh:mm:ss.

`i5_time_sep`
`DB2_I5_SEP_COLON` - Двокрапка (:) використовується як роздільник часу.
Це значення за промовчанням.

`DB2_I5_SEP_PERIOD` - Точка (.) використовується як роздільник часу.

`DB2_I5_SEP_COMMA` - Кома (,) використовується як роздільник часу.

`DB2_I5_SEP_BLANK` - Пробіл використовується як роздільник часу.

`DB2_I5_SEP_JOB` - Використовується стандартне завдання.

`i5_decimal_sep`
`DB2_I5_SEP_PERIOD` - Як десятковий роздільник використовується
крапка (.). Це значення за промовчанням.

`DB2_I5_SEP_COMMA` - Як десятковий роздільник використовується
кома (,).

`DB2_I5_SEP_JOB` - Використовується стандартне завдання.

Наступна нова опція i5/OS доступна в ibm_db2 версії 1.8.0 та новішої.

`i5_libl`
Символьне значення, що вказує на список бібліотек, який буде
використовуватись для дозволу некваліфікованих посилань на файли.
Вкажіть елементи списку бібліотек, розділені пробілами
'i5_libl'u003d\>"MYLIB YOURLIB ANYLIB".

> **Примітка**:
>
> i5_libl викликає qsys2/qcmdexc ('cmd',cmdlen), який доступний тільки
> в i5/OS V5R4 та новіший.

### Значення, що повертаються

Повертає ресурс дескриптора підключення у разі успішної спроби
підключення. **db2_pconnect()** намагається повторно використати
існуючий ресурс підключення, який точно відповідає параметрам
`database`, `username` та `password`. Якщо спроба підключення не
вдалося, **db2_pconnect()** поверне **`false`**.

### Список змін

| Версія | Опис |
|---------------|--------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- --------------|
| ibm_db2 1.9.0 | Активні транзакції у постійному з'єднанні будуть відкочуватися наприкінці кожного запиту. |
| ibm_db2 1.8.0 | Параметр i5_libl доступний для користувачів i5/OS. |
| ibm_db2 1.7.0 | Доступний параметр `trustedcontext`. |
| ibm_db2 1.5.1 | Параметри `i5_lib`, `i5_naming`, `i5_commit`, `i5_query_optimize`, `i5_dbcs_alloc`, `i5_date_fmt`, `i5_date_sep`, `i5_time_fmt`, `i5_time_sep` та `s5`. |

### Приклади

**Приклад #1 Приклад використання **db2_pconnect()****

У наступному прикладі перший виклик **db2_pconnect()** повертає новий
ресурс постійного з'єднання. Другий виклик **db2_pconnect()**
повертає ресурс постійного з'єднання, який просто повторно
використовує перший ресурс постійного з'єднання.

` <?php$database u003d 'SAMPLE';$user u003d 'db2inst1';$password u003d 'ibmdb2';$pconn u003d db2_pconnect($database, $user, $password);if ($pconn) { успішно встановлено.";}else {    echo "Постійне з'єднання завершилося помилкою.";}$pconn2 u003d db2_pconnect($database, $user, $password);if установлене| Установлення else {    echo "Друге постійне з'єднання завершилося помилкою";}?> `

Результат виконання цього прикладу:

Постійне з'єднання успішно встановлено.
Друге постійне з'єднання успішно встановлено.

**Приклад #2 Використання довіреного контексту**

У наступному прикладі показано, як увімкнути довірений контекст,
переключити користувачів та отримати поточний ідентифікатор користувача.

` <?php$database u003d "SAMPLE";$hostname u003d "localhost";$port u003d 50000;$authID u003d "db2inst1";$auth_pass u003d "ibmdb2";$tc_user u003d "tcuser"; ;$dsnu003du003d"DATABASEu003d$database;HOSTNAMEu003d$hostname;PORTu003d$port; PROTOCOLu003dTCPIP;UIDu003d$authID;PWDu003d$auth_pass;";$options u003d array ("trustedcontext" u003dDDB2_TR tc_connu003d db2_pconnect($dsn, "", "", $options);if($tc_conn) {    echo "Явне довірене з'єднання успішно встановлено.
";    if(db2_get_option($tc_conn, "trustedcontext")) {        $userBefore u003d db2_get_option($tc_conn, "trusted_user");        // Поработайте как пользователь 1.        // Переход на доверенного пользователя.Switching to trusted user.        $parameters u003d array("trusted_user" u003d> $tc_user,          "trusted_password" u003d> $tcuser_pass);        $res u003d db2_set_option ($tc_conn, $parameters, 1);        $userAfter u003d db2_get_option($tc_conn, "trusted_user");        // Сделайте больше як довіреного користувача.
";        }    }}   db2_close($tc_conn);}else {   echo "Явне довірене з'єднання завершилося помилкою.
";}?> `

Результат виконання цього прикладу:

Явне довірене з'єднання успішно встановлено
Користувача було переключено.

### Дивіться також

- [db2_connect()](function.db2-connect.md) - Повертає з'єднання з
базою даних
