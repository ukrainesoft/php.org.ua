- [« Міграція з PHP 7.3.x на PHP 7.4.x](migration74.md)
- [Нові класи та інтерфейси »](migration74.new-classes.md)

- [PHP Manual](index.md)
- [Міграція з PHP 7.3.x на PHP 7.4.x](migration74.md)
-   Нові можливості

## Нові можливості

### Ядро PHP

#### Типізовані властивості

Властивості класу підтримують оголошення типів.

`<?phpclass User {    public int $id; public string $name;}?> `

У наведеному прикладі вище показано, що $user->id можна присвоїти
тільки значення типу int, коли як $user->name - виключно
Значення типу string.

#### Стрілочні функції

[Стрілкові функції](functions.arrow.md) - це скорочений запис для
визначення функцій із неявною прив'язкою батьківської області видимості
за значенням.

` <?php$factor u003d 10;$nums u003d array_map(fn($n) u003d> $n * $factor, [1, 2, 3, 4]);// $nums u003d array(10, 20, 30 , 40);?> `

#### Обмежена коваріація типу, що повертається, і контраваріантність типу аргументу

Наступний код тепер працюватиме:

`<?phpclass A {}class B extends A {}class Producer {    public function method(): A {}}class ChildProducer extends Producer {       

Повна підтримка варіантності доступна лише за умови використання
автозавантаження. Всередині одного файлу можуть бути лише нециклічні
посилання, оскільки всі класи повинні бути визначені, перед тим як на
них посилатися.

#### Присвоює оператор об'єднання з null

` <?php$array['key'] ??u003d computeDefault();// приблизно то ж самеif (!isset($array['key'])) {   $array['key'] u003d computeDefault(); }?> `

#### Розпакування всередині масивів

` <?php$parts u003d ['apple', 'pear'];$fruits u003d ['banana', 'orange', ...$parts, 'watermelon'];// ['banana', 'orange' , 'apple', 'pear', 'watermelon'];?> `

#### Розділювач у числових літералах

Тепер у числових літералах між знаками можуть бути символи
підкреслення.

`<?php6.674_083e-11; // число з плаваючою точкою299_792_458; // десяткове число0xCAFE_F00D; // шістнадцяткове число0b0101_1111; // двійкове число?> `

#### Слабкі посилання

[Слабкі посилання](class.weakreference.md) дозволяють програмісту
зберегти посилання на об'єкт, який не завадить збирачеві сміття видалити
цей об'єкт.

#### Обробка винятків із методу \_\_toString()

Викидання винятків із методу
[\_\_toString()](language.oop5.magic.md#object.tostring) тепер
дозволено. Раніше це призводило до фатальної помилки. Існуючі
фатальні помилки, що відловлюються при перетворенні об'єкта в рядок будуть
доступні як виняток класу [Error](class.error.md).

### CURL

Крім звичайних імен файлів, клас [CURLFile](class.curlfile.md) тепер
підтримує потокові обгортки, якщо модуль зібрано з версією libcurl
\>u003d 7.56.0.

### Фільтрування

Фільтр **`FILTER_VALIDATE_FLOAT`** тепер підтримує параметри
`min_range` і `max_range`, з тим самим змістом, що і для
**`FILTER_VALIDATE_INT`**.

### FFI

FFI - новий модуль, який пропонує простий спосіб виклику вбудованих
функцій, доступу до вбудованих змінних, а також створювати або
звертатися до структур даних у бібліотеках мовою Сі.

### GD

Додано константу **`IMG_FILTER_SCATTER`** для застосування
фільтра, що розсіюється, до зображень.

### Хешування

Доданий хеш `crc32c`, який використовує поліном Кастанолі. Ця реалізація
алгоритм CRC32 використовується системами зберігання, такими як iSCSI, SCTP,
Btrfs та ext4.

### Багатобайтові рядки

Додано функцію [mb_str_split()](function.mb-str-split.md), яка
виконує те ж саме, що і [str_split()](function.str-split.md), але
працює з кодовими точками, а чи не з байтами.

### OPcache

Додано підтримку [попереднього завантаження
коду](opcache.preloading.md).

### Регулярні вирази (сумісні з Perl)

Функції [preg_replace_callback()](function.preg-replace-callback.md) та
[preg_replace_callback_array()](function.preg-replace-callback-array.md)
тепер приймають додатковий аргумент `flags` з підтримкою прапорів
**`PREG_OFFSET_CAPTURE`** та **`PREG_UNMATCHED_AS_NULL`**. Він вплине на
формат масиву збіглих значень, що передається в callback-функцію.

### PDO

Ім'я користувача та пароль тепер можна вказати як частину DSN для
драйверів mysql, mssql, sybase, dblib, firebird та oci. Раніше підтримка
це була тільки для драйвера pgsql. Якщо ім'я користувача/пароль
вказано і в конструкторі і в DSN, то конструктор матиме пріоритет.

Також тепер можна екранувати знаки запитання в SQL-запитах,
щоб вони сприймалися як іменовані параметри. Використання
`??` відправить один знак питання до бази даних, і, наприклад, у разі
використання PostgreSQL, буде використаний оператор перевірки
існування ключа в JSON (`?`).

### PDO_OCI

Для даного драйвера тепер доступний метод
[PDOStatement::getColumnMeta()](pdostatement.getcolumnmeta.md).

### PDO_SQLite

Вираз
`PDOStatement::getAttribute(PDO::SQLITE_ATTR_READONLY_STATEMENT)`
дозволяє перевірити, чи доступний підготовлений запит тільки для
читання, тобто. чи не змінює він базу даних.

`PDO::setAttribute(PDO::SQLITE_ATTR_EXTENDED_RESULT_CODES, true)`
дозволяє використовувати розширені коди результату SQLite3
[PDOStatement::errorInfo()](pdostatement.errorinfo.md).

### SQLite3

Доданий метод **SQLite3::lastExtendedErrorCode()** для отримання
останнього розширеного коду результату.

Доданий метод `SQLite3::enableExtendedResultCodes($enable u003d true)`,
який змусить метод
[SQLite3::lastErrorCode()](sqlite3.lasterrorcode.md) повертати
розширені коди результатів.

### Стандартне

#### strip_tags() з масивом імен тегів

Функція [strip_tags()](function.strip-tags.md) тепер також приймає
масив дозволених тегів: замість `strip_tags($str, '<a><p>')` тепер
можна написати `strip_tags($str, ['a', 'p'])`.

#### Користувальницька серіалізація об'єктів

Додано новий механізм серіалізації об'єктів,
використовує два нові магічні методи: `__serialize` та
`__unserialize`.

`<?php// Повертає масив, містить все необхідний стан об'єкта.public function __serialize(): array;// Відновлює стан об'єкту з вказаного масиву¸

Новий механізм серіалізації замінює інтерфейс
[Serializable](class.serializable.md), який у майбутньому буде
оголошено застарілим.

#### Функції злиття масивів без аргументів

Функції [array_merge()](function.array-merge.md) та
[array_merge_recursive()](function.array-merge-recursive.md) тепер
можуть викликатися без жодних аргументів, і тоді вони повернуть порожній
масив. Це корисно у поєднанні з оператором розширення, наприклад,
`array_merge(...$arrays)`.

#### Функція [proc_open()](function.proc-open.md)

[proc_open()](function.proc-open.md) тепер приймає масив замість
рядки для виконання команди. У цьому випадку процес буде відкрито
безпосередньо (без командної оболонки), а PHP екранує будь-який необхідний
аргумент.

` <?phpproc_open(['php', '-r', 'echo "Привіт, світ
";'], $descriptors, $pipes);?> `

Функція [proc_open()](function.proc-open.md) тепер підтримує
дескриптори `redirect` та `null`.

` <?php// То ж саме, що і 2>&1 в командній оболонціproc_open($cmd, [1 u003d> ['pipe', 'w'], 2 u003d> ['redirect', 1 );// То що, що і 2>/dev/null або 2>nul в командній оболонціproc_open($cmd, [1 u003d> ['pipe', 'w'], 2 u003d>' , $pipes);?> `

#### argon2i(d) без libargon

Функція [password_hash()](function.password-hash.md) тепер
підтримує варіанти хешування argon2i та argon2id з модуля sodium,
коли PHP зібраний без libargon.
