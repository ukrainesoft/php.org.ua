{"pageProps":{"page":{"slug":"function.stream-notification-callback.md","content":"# stream\\_notification\\_callback\n\n(PHP 5 >= 5.2.0, PHP 7, PHP 8)\n\nstream\\_notification\\_callback — Callback-функция для параметра контекста`notification`\n\n### Опис\n\n```methodsynopsis\nstream_notification_callback(    int $notification_code,    int $severity,    ?string $message,    int $message_code,    int $bytes_transferred,    int $bytes_max): void\n```\n\nCallback-функция типа[callable](language.types.callable.md), що використовується [параметром контексту notification](context.params.md#context.params.notification), що викликається під час події.\n\n> **Зауваження** :\n> \n> Це *не* справжня функція, лише прототип того, як має бути реалізована функція.\n\n### Список параметрів\n\n`notification_code`\n\nОдна из констант оповещения\\*\\*`STREAM_NOTIFY_*`\\*\\*\n\n`severity`\n\nОдна из констант оповещения\\*\\*`STREAM_NOTIFY_SEVERITY_*`\\*\\*\n\n`message`\n\nПередається, якщо для події доступне описове повідомлення.\n\n`message_code`\n\nПередається, якщо для події доступний код повідомлення, що описує.\n\nЗначення даної величини залежить від використовуваної обгортки.\n\n`bytes_transferred`\n\nЕсли доступно, то параметр`bytes_transferred`будет заполнен.\n\n`bytes_max`\n\nЕсли доступно, то параметр`bytes_max`будет заполнен.\n\n### Значення, що повертаються\n\nФункція не повертає значення після виконання.\n\n### Приклади\n\n**Приклад #1 Приклад використання** stream\\_notification\\_callback()\\*\\*\\*\\*\n\n```php\n<?php\nfunction stream_notification_callback($notification_code, $severity, $message, $message_code, $bytes_transferred, $bytes_max) {\n\n    switch($notification_code) {\n        case STREAM_NOTIFY_RESOLVE:\n        case STREAM_NOTIFY_AUTH_REQUIRED:\n        case STREAM_NOTIFY_COMPLETED:\n        case STREAM_NOTIFY_FAILURE:\n        case STREAM_NOTIFY_AUTH_RESULT:\n            var_dump($notification_code, $severity, $message, $message_code, $bytes_transferred, $bytes_max);\n            /* Игнорируем */\n            break;\n\n        case STREAM_NOTIFY_REDIRECTED:\n            echo \"Перенаправлены на: \", $message;\n            break;\n\n        case STREAM_NOTIFY_CONNECT:\n            echo \"Подсоединились...\";\n            break;\n\n        case STREAM_NOTIFY_FILE_SIZE_IS:\n            echo \"Получили размер файла: \", $bytes_max;\n            break;\n\n        case STREAM_NOTIFY_MIME_TYPE_IS:\n            echo \"Получили mime-тип файла: \", $message;\n            break;\n\n        case STREAM_NOTIFY_PROGRESS:\n            echo \"Пошёл прогресс, пока загружено \", $bytes_transferred, \" байт\";\n            break;\n    }\n    echo \"\\n\";\n}\n\n$ctx = stream_context_create();\nstream_context_set_params($ctx, array(\"notification\" => \"stream_notification_callback\"));\n\nfile_get_contents(\"http://php.net/contact\", false, $ctx);\n?>\n```\n\nВисновок наведеного прикладу буде схожим на:\n\n```\nПодсоединились...\nПолучили mime-тип файла: text/html; charset=utf-8\nПеренаправлены на: http://no.php.net/contact\nПодсоединились...\nПолучили размер файла: 0\nПолучили mime-тип файла: text/html; charset=utf-8\nПеренаправлены на: http://no.php.net/contact.php\nПодсоединились...\nПолучили размер файла: 4589\nПолучили mime-тип файла: text/html;charset=utf-8\nПошёл прогресс, пока загружено 0 байт\nПошёл прогресс, пока загружено 0 байт\nПошёл прогресс, пока загружено 0 байт\nПошёл прогресс, пока загружено 1440 байт\nПошёл прогресс, пока загружено 2880 байт\nПошёл прогресс, пока загружено 4320 байт\nПошёл прогресс, пока загружено 5760 байт\nПошёл прогресс, пока загружено 6381 байт\nПошёл прогресс, пока загружено 7002 байт\n```\n\n**Приклад #2 Простий індикатор для завантажувача файлів із командного рядка**\n\n```php\n<?php\nfunction usage($argv) {\n    echo \"Использование:\\n\";\n    printf(\"\\tphp %s <http://example.com/file> <localfile>\\n\", $argv[0]);\n    exit(1);\n}\n\nfunction stream_notification_callback($notification_code, $severity, $message, $message_code, $bytes_transferred, $bytes_max) {\n    static $filesize = null;\n\n    switch($notification_code) {\n    case STREAM_NOTIFY_RESOLVE:\n    case STREAM_NOTIFY_AUTH_REQUIRED:\n    case STREAM_NOTIFY_COMPLETED:\n    case STREAM_NOTIFY_FAILURE:\n    case STREAM_NOTIFY_AUTH_RESULT:\n        /* Игнорируем */\n        break;\n\n    case STREAM_NOTIFY_REDIRECTED:\n        echo \"Перенаправлены на: \", $message, \"\\n\";\n        break;\n\n    case STREAM_NOTIFY_CONNECT:\n        echo \"Подсоединились...\\n\";\n        break;\n\n    case STREAM_NOTIFY_FILE_SIZE_IS:\n        $filesize = $bytes_max;\n        echo \"Размер файла: \", $filesize, \"\\n\";\n        break;\n\n    case STREAM_NOTIFY_MIME_TYPE_IS:\n        echo \"Mime-тип файла: \", $message, \"\\n\";\n        break;\n\n    case STREAM_NOTIFY_PROGRESS:\n        if ($bytes_transferred > 0) {\n            if (!isset($filesize)) {\n                printf(\"\\rНеизвестный размер файла.. Закачано %2d Кб..\", $bytes_transferred/1024);\n            } else {\n                $length = (int)(($bytes_transferred/$filesize)*100);\n                printf(\"\\r[%-100s] %d%% (%2d/%2d kb)\", str_repeat(\"=\", $length). \">\", $length, ($bytes_transferred/1024), $filesize/1024);\n            }\n        }\n        break;\n    }\n}\n\nisset($argv[1], $argv[2]) or usage($argv);\n\n$ctx = stream_context_create();\nstream_context_set_params($ctx, array(\"notification\" => \"stream_notification_callback\"));\n\n$fp = fopen($argv[1], \"r\", false, $ctx);\nif (is_resource($fp) && file_put_contents($argv[2], $fp)) {\n    echo \"\\nГотово!\\n\";\n    exit(0);\n}\n\n$err = error_get_last();\necho \"\\nОшшшшибкка..\\n\", $err[\"message\"], \"\\n\";\nexit(1);\n?>\n```\n\nВиконання вищенаведеного прикладу з наступними опціями: `php -n fetch.php http://no2.php.net/get/php-5-LATEST.tar.bz2/from/this/mirror php-latest.tar.bz2` виведе щось схоже на це:\n\n```\nПодсоединились...\nMime-тип файла: text/html; charset=utf-8\nПеренаправлены на: http://no2.php.net/distributions/php-5.2.5.tar.bz2\nПодсоединились...\nРазмер файла: 7773024\nMime-тип файла: application/octet-stream\n[========================================>                                                           ] 40% (3076/7590 kb)\n```\n\n### Дивіться також\n\n-   [Параметри контексту](context.params.md)\n","title":"stream\\_notification\\_callback","contentType":2,"navigation":[{"function.stream-isatty.md":"« stream\\_isatty"},{"function.stream-register-wrapper.md":"stream\\_register\\_wrapper »"},{"index.md":"PHP Manual"},{"ref.stream.md":"Функції для роботи з потоками"}]}},"__N_SSG":true}