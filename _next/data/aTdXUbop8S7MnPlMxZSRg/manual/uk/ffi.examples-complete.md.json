{"pageProps":{"page":{"slug":"ffi.examples-complete.md","content":"## Комплексний приклад PHP/FFI/preloading\n\nphp.ini\n\nffi.enable=preload opcache.preload=preload.php\n\npreload.php\n\n```php\n<?php\nFFI::load(__DIR__ . \"/dummy.h\");\nopcache_compile_file(__DIR__ . \"/dummy.php\");\n?>\n```\n\ndummy.h\n\n#define FFI\\_SCOPE \"DUMMY\" #define FFI\\_LIB \"libc.so.6\"\n\nint printf(const char\\*format, ...);\n\ndummy.php\n\n```php\n<?php\nfinal class Dummy {\n    private static $ffi = null;\n    function __construct() {\n        if (is_null(self::$ffi)) {\n            self::$ffi = FFI::scope(\"DUMMY\");\n        }\n    }\n    function printf($format, ...$args) {\n       return (int)self::$ffi->printf($format, ...$args);\n    }\n}\n?>\n```\n\ntest.php\n\n```php\n<?php\n$d = new Dummy();\n$d->printf(\"Привет, %s!\\n\", \"мир\");\n?>\n```\n","title":"Комплексний приклад PHP/FFI/preloading","contentType":2,"navigation":[{"ffi.examples-callback.md":"Callback-функції PHP"},{"class.ffi.md":"FFI »"},{"index.md":"PHP Manual"},{"ffi.examples.md":"Приклади"}]}},"__N_SSG":true}