{"pageProps":{"page":{"slug":"sockets.examples.md","content":"# Приклади\n\n**Приклад #1 Приклад використання сокетів: Простий сервер TCP/IP**\n\nЦей приклад показує роботу простого сервера. Змініть змінні address та port відповідно до ваших налаштувань і виконайте. Потім ви можете з'єднатися з сервером із командою, схожою на: **telnet 192.168.1.53 10000** (де адреса та порт повинні відповідати вашим налаштуванням). Все, що ви наберете на клавіатурі, буде виведено на сервері і відправлено вам назад. Щоб вимкнути, наберіть 'вихід'.\n\n```php\n#!/usr/local/bin/php -q\n<?php\nerror_reporting(E_ALL);\n\n/* Позволяет скрипту ожидать соединения бесконечно. */\nset_time_limit(0);\n\n/* Включает скрытое очищение вывода так, что мы видим данные\n * как только они появляются. */\nob_implicit_flush();\n\n$address = '192.168.1.53';\n$port = 10000;\n\nif (($sock = socket_create(AF_INET, SOCK_STREAM, SOL_TCP)) === false) {\n    echo \"Не удалось выполнить socket_create(): причина: \" . socket_strerror(socket_last_error()) . \"\\n\";\n}\n\nif (socket_bind($sock, $address, $port) === false) {\n    echo \"Не удалось выполнить socket_bind(): причина: \" . socket_strerror(socket_last_error($sock)) . \"\\n\";\n}\n\nif (socket_listen($sock, 5) === false) {\n    echo \"Не удалось выполнить socket_listen(): причина: \" . socket_strerror(socket_last_error($sock)) . \"\\n\";\n}\n\ndo {\n    if (($msgsock = socket_accept($sock)) === false) {\n        echo \"Не удалось выполнить socket_accept(): причина: \" . socket_strerror(socket_last_error($sock)) . \"\\n\";\n        break;\n    }\n    /* Отправляем инструкции. */\n    $msg = \"\\nДобро пожаловать на тестовый сервер PHP. \\n\" .\n        \"Чтобы отключиться, наберите 'выход'. Чтобы выключить сервер, наберите 'выключение'.\\n\";\n    socket_write($msgsock, $msg, strlen($msg));\n\n    do {\n        if (false === ($buf = socket_read($msgsock, 2048, PHP_NORMAL_READ))) {\n            echo \"Не удалось выполнить socket_read(): причина: \" . socket_strerror(socket_last_error($msgsock)) . \"\\n\";\n            break 2;\n        }\n        if (!$buf = trim($buf)) {\n            continue;\n        }\n        if ($buf == 'выход') {\n            break;\n        }\n        if ($buf == 'выключение') {\n            socket_close($msgsock);\n            break 2;\n        }\n        $talkback = \"PHP: Вы сказали '$buf'.\\n\";\n        socket_write($msgsock, $talkback, strlen($talkback));\n        echo \"$buf\\n\";\n    } while (true);\n    socket_close($msgsock);\n} while (true);\n\nsocket_close($sock);\n?>\n```\n\n**Приклад #2 Приклад використання сокетів: Простий клієнт TCP/IP**\n\nЦей приклад показує використання простого одноразового HTTP-клієнта. Він просто з'єднується зі сторінкою, надсилає запит HEAD, виводить відповідь та завершує роботу.\n\n```php\n<?php\nerror_reporting(E_ALL);\n\necho \"<h2>Соединение TCP/IP</h2>\\n\";\n\n/* Получаем порт сервиса WWW. */\n$service_port = getservbyname('www', 'tcp');\n\n/* Получаем IP-адрес целевого хоста. */\n$address = gethostbyname('www.example.com');\n\n/* Создаём сокет TCP/IP. */\n$socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);\nif ($socket === false) {\n    echo \"Не удалось выполнить socket_create(): причина: \" . socket_strerror(socket_last_error()) . \"\\n\";\n} else {\n    echo \"OK.\\n\";\n}\n\necho \"Пытаемся соединиться с '$address' на порту '$service_port'...\";\n$result = socket_connect($socket, $address, $service_port);\nif ($result === false) {\n    echo \"Не удалось выполнить socket_connect().\\nПричина: ($result) \" . socket_strerror(socket_last_error($socket)) . \"\\n\";\n} else {\n    echo \"OK.\\n\";\n}\n\n$in = \"HEAD / HTTP/1.1\\r\\n\";\n$in .= \"Host: www.example.com\\r\\n\";\n$in .= \"Connection: Close\\r\\n\\r\\n\";\n$out = '';\n\necho \"Отправляем HTTP-запрос HEAD...\";\nsocket_write($socket, $in, strlen($in));\necho \"OK.\\n\";\n\necho \"Читаем ответ:\\n\\n\";\nwhile ($out = socket_read($socket, 2048)) {\n    echo $out;\n}\n\necho \"Закрываем сокет...\";\nsocket_close($socket);\necho \"OK.\\n\\n\";\n?>\n```\n","title":"Приклади","contentType":2,"navigation":[{"sockets.constants.md":"« Зумовлені константи"},{"sockets.errors.md":"Помилки сокетів »"},{"index.md":"PHP Manual"},{"book.sockets.md":"Сокети"}]}},"__N_SSG":true}