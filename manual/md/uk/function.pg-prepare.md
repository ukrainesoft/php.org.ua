- [«pg_port](function.pg-port.md)
- [pg_put_line »](function.pg-put-line.md)

- [PHP Manual](index.md)
- [Функції PostgreSQL](ref.pgsql.md)
- Надсилає запит на створення параметризованого SQL виразу та чекає
його завершення

#pg_prepare

(PHP 5 \>u003d 5.1.0, PHP 7, PHP 8)

pg_prepare — Надсилає запит на створення параметризованого SQL
висловлювання та чекає його завершення

### Опис

**pg_prepare**([PgSql\Connection](class.pgsql-connection.md)
`$connection` u003d ?, string `$stmtname`, string `$query`):
[PgSql\Result](class.pgsql-result.md)\|false

**pg_prepare()** створює заготівлю SQL висловлювання на сервері для
наступного запуску функціями [pg_execute()](function.pg-execute.md)
або [pg_send_execute()](function.pg-send-execute.md). Це дозволяє
багаторазово виконувати один раз створені запити з різними
параметрами. **pg_prepare()** підтримується PostgreSQL версії 7.4 та
вище. Функція не працюватиме з серверами ранніх версій.

Функція створює заготівлю SQL запиту під назвою `stmtname` і тілом
`query`, яке має містити один SQL вираз. `stmtname` може
бути порожнім рядком, тоді буде створено безіменну заготівлю. Якщо
якась безіменна заготівля вже визначена, вона буде замінена на
нову автоматично. В інших випадках збіг імен нової та
існуючої в цій сесії заготовок призведе до помилки. Якщо в `query`
будуть передаватися параметри, вони замінять псевдоперемінні $1, $2 і
і т.д. під час передачі запиту.

Подібні заготівлі запитів можна робити за допомогою SQL-команди
`PREPARE` (але **pg_prepare()** більш гнучка, тому що не вимагає суворої
типізації своїх параметрів). Важливо відзначити, що у PHP немає функцій для
видалення підготовлених SQL-виражень, для цього використовуйте команду SQL
`DEALLOCATE`.

### Список параметрів

`connection`
Примірник [PgSql\Connection](class.pgsql-connection.md). Якщо
`connection` не вказано, використовується стандартне з'єднання.
З'єднання за замовчуванням - це останнє з'єднання, виконане з
за допомогою функцій [pg_connect()](function.pg-connect.md) або
[pg_pconnect()](function.pg-pconnect.md).

**Увага**
Починаючи з версії PHP 8.1.0, використання стандартного з'єднання
застаріло.

`stmtname`
Ім'я заготовки, що створюється. Має бути унікальним у межах сесії.
Якщо встановлено порожній рядок, буде створено безіменний SQL вираз. При
цьому воно перезапише вже існуючий безіменний вираз, визначений
раніше.

`query`
Параметризований SQL-запит. Повинен містити лише один вираз
(кілька виразів розділених крапкою з комою не підтримуються).
Якщо на запит будуть передаватися параметри, вони замінять
псевдозмінні $1, $2 і т.д.

### Значення, що повертаються

Примірник [PgSql\Result](class.pgsql-result.md) у разі успішного
виконання або **`false`** у разі виникнення помилки.

### Список змін

| Версія | Опис |
|--------|---------------------------------------- -------------------------------------------------- -------------------------------------------------- -----------------------|
| 8.1.0 | Повертає екземпляр [PgSql\Result](class.pgsql-result.md); раніше повертався ресурс ([resource](language.types.resource.md)). |
| 8.1.0 | Параметр `connection` тепер чекає на екземпляр [PgSql\Connection](class.pgsql-connection.md); раніше очікувався ресурс ([resource](language.types.resource.md)). |

### Приклади

**Приклад #1 Приклад використання **pg_prepare()****

`<?php// Підключення до бази даних "mary"$dbconn u003d pg_connect("dbnameu003dmary");// Підготовка запиту$result u003d pg_prepare($dbconn, "my_query", '  ');// Запуск запиту на виконання. Варто відзначити, що немає необхідності екранувати // спецсимволи в рядку "Joe's Widgets" $ result u003d u003d pg_execute ($ dbconn, " my_query ", / array ( " Joe's " ); $result u003d pg_execute($dbconn, "my_query", array("Clothes Clothes Clothes"));?> `

### Дивіться також

- [pg_execute()](function.pg-execute.md) - Запускає виконання
раніше підготовленого параметризованого запиту та чекає результат
- [pg_send_execute()](function.pg-send-execute.md) - Запускає
попередньо підготовлений SQL-запит та передає йому параметри;
не чекає результату, що повертається
