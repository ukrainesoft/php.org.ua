{"pageProps":{"page":{"slug":"streamwrapper.dir-readdir.md","content":"# streamWrapper::dir\\_readdir\n\n(PHP 4 >= 4.3.2, PHP 5, PHP 7, PHP 8)\n\nstreamWrapper::dir\\_readdir - Читання запису з дескриптора директорії\n\n### Опис\n\n```methodsynopsis\npublic streamWrapper::dir_readdir(): string\n```\n\nЦей метод викликається у процесі виконання [readdir()](function.readdir.md)\n\n### Список параметрів\n\nЦя функція не має параметрів.\n\n### Значення, що повертаються\n\nПовинна повертати рядок (string), що представляє ім'я наступного файлу, або \\*\\*`false`\\*\\*якщо наступного файлу немає.\n\n> **Зауваження** :\n> \n> Значення, що повертається, буде наведено до типу string.\n\n### Помилки\n\nВикликає помилку рівня **`E_WARNING`**, якщо виклик до цього методу не вдалося (наприклад, не реалізовано).\n\n### Приклади\n\n**Приклад #1 Отримання списку файлів із tar-архівів**\n\n```php\n<?php\nclass streamWrapper {\n    protected $fp;\n\n    public function dir_opendir($path, $options) {\n        $url = parse_url($path);\n\n        $path = $url[\"host\"] . $url[\"path\"];\n\n        if (!is_readable($path)) {\n            trigger_error(\"Не могу прочитать $path \", E_USER_NOTICE);\n            return false;\n        }\n        if (!is_file($path)) {\n            trigger_error(\"$path не является файлом\", E_USER_NOTICE);\n            return false;\n        }\n\n        $this->fp = fopen($path, \"rb\");\n        return true;\n    }\n\n    public function dir_readdir() {\n        // Извлечение заголовка\n        $header      = fread($this->fp, 512);\n        $data = unpack(\"a100filename/a8mode/a8uid/a8gid/a12size/a12mtime/a8checksum/a1filetype/a100link/a100linkedfile\", $header);\n\n        // Убираем лишние пробелы в имени файла и его размере\n        $filename    = trim($data[\"filename\"]);\n\n        // Нет файла? Значит мы дошли до конца архива\n        if (!$filename) {\n            return false;\n        }\n\n        $octal_bytes = trim($data[\"size\"]);\n        // Размер файла определён в восьмеричной системе\n        $bytes       = octdec($octal_bytes);\n\n        // tar округляет размеры файлов, чтобы они были\n        // кратными 512 байтам (с заполнением нулями)\n        $rest        = $bytes % 512;\n        if ($rest > 0) {\n            $bytes      += 512 - $rest;\n        }\n\n        // Перемещаемся внутри файла\n        fseek($this->fp, $bytes, SEEK_CUR);\n\n        return $filename;\n    }\n\n    public function dir_closedir() {\n        return fclose($this->fp);\n    }\n\n    public function dir_rewinddir() {\n        return fseek($this->fp, 0, SEEK_SET);\n    }\n}\n\nstream_wrapper_register(\"tar\", \"streamWrapper\");\n$handle = opendir(\"tar://example.tar\");\nwhile (false !== ($file = readdir($handle))) {\n    var_dump($file);\n}\n\necho \"Перемотка в начало..\\n\";\nrewind($handle);\nvar_dump(readdir($handle));\n\nclosedir($handle);\n?>\n```\n\nВисновок наведеного прикладу буде схожим на:\n\n```\nstring(13) \"construct.xml\"\nstring(16) \"dir-closedir.xml\"\nstring(15) \"dir-opendir.xml\"\nstring(15) \"dir-readdir.xml\"\nstring(17) \"dir-rewinddir.xml\"\nstring(9) \"mkdir.xml\"\nstring(10) \"rename.xml\"\nstring(9) \"rmdir.xml\"\nstring(15) \"stream-cast.xml\"\nstring(16) \"stream-close.xml\"\nstring(14) \"stream-eof.xml\"\nstring(16) \"stream-flush.xml\"\nstring(15) \"stream-lock.xml\"\nstring(15) \"stream-open.xml\"\nstring(15) \"stream-read.xml\"\nstring(15) \"stream-seek.xml\"\nstring(21) \"stream-set-option.xml\"\nstring(15) \"stream-stat.xml\"\nstring(15) \"stream-tell.xml\"\nstring(16) \"stream-write.xml\"\nstring(10) \"unlink.xml\"\nstring(12) \"url-stat.xml\"\nRewinding..\nstring(13) \"construct.xml\"\n```\n\n### Дивіться також\n\n-   [readdir()](function.readdir.md) \\- Отримує елемент каталогу за його дескриптором\n","title":"streamWrapper::dir\\_readdir","contentType":2,"navigation":[{"streamwrapper.dir-opendir.md":"« streamWrapper::dir\\_opendir"},{"streamwrapper.dir-rewinddir.md":"streamWrapper::dir\\_rewinddir »"},{"index.md":"PHP Manual"},{"class.streamwrapper.md":"streamWrapper"}]}},"__N_SSG":true}