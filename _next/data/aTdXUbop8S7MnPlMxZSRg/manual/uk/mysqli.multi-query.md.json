{"pageProps":{"page":{"slug":"mysqli.multi-query.md","content":"# mysqli::multi\\_query\n\n# mysqli\\_multi\\_query\n\n(PHP 5, PHP 7, PHP 8)\n\nmysqli::multi\\_query -- mysqli\\_multi\\_query — Виконує один або кілька запитів до бази даних\n\n### Опис\n\nОб'єктно-орієнтований стиль\n\n```methodsynopsis\npublic mysqli::multi_query(string $query): bool\n```\n\nПроцедурний стиль\n\n```methodsynopsis\nmysqli_multi_query(mysqli $mysql, string $query): bool\n```\n\nЗапускає один або кілька запитів, перерахованих через точку з комою.\n\n**Увага**\n\n# Попередження безпеки: SQL-ін'єкція\n\nЗамість складання рядку запиту з включенням змінних значень необхідно [готувати запити](mysqli.quickstart.prepared-statements.md). Або рядки запиту мають бути екрановані функцією [mysqli\\_real\\_escape\\_string()](mysqli.real-escape-string.md) та правильно відформатовані.\n\nЗапити надсилаються асинхронно за один виклик бази даних, але база даних обробляє їх послідовно . **mysqli\\_multi\\_query()** очікує завершення першого запиту, перш ніж повернути керування PHP. Потім сервер MySQL обробить наступний запит у послідовності. Як тільки наступний результат буде готовий, MySQL чекатиме наступного виконання [mysqli\\_next\\_result()](mysqli.next-result.md)из PHP.\n\nДля обробки кількох запитів рекомендується використовувати [do-while](control-structures.do.while.md). З'єднання буде зайнято доти, доки всі запити не будуть завершені та їх результати не будуть завантажені до PHP. Ніякий інший оператор не може бути виданий у тому ж з'єднанні, доки не будуть опрацьовані всі запити. Щоб перейти до наступного запиту у послідовності, використовуйте [mysqli\\_next\\_result()](mysqli.next-result.md). Якщо наступний результат ще не готовий, на mysqli буде чекати відповіді від сервера MySQL. Щоб перевірити, чи є результати, використовуйте [mysqli\\_more\\_results()](mysqli.more-results.md)\n\nДля запитів, які виробляють набір результатів, таких як `SELECT, SHOW, DESCRIBE`или`EXPLAIN` [mysqli\\_use\\_result()](mysqli.use-result.md) або [mysqli\\_store\\_result()](mysqli.store-result.md) може використовуватись для отримання набору результатів. Для запитів, які не роблять набір результатів, ті ж функції можуть використовуватися для отримання інформації, такої як кількість порушених рядків.\n\n**Підказка**\n\nВиконання запитів `CALL` для процедур, що зберігаються, може дати кілька наборів результатів. Якщо процедура, що зберігається, містить запити `SELECT`набори результатів повертаються в тому порядку, в якому вони створюються при виконанні процедури. Загалом, функція, що викликає, не може знати, скільки наборів результатів поверне процедура, і повинна бути готова отримати кілька результатів. Кінцевий результат процедури - результат статусу, який включає набір результатів. Статус показує, чи була процедура успішною чи помилка.\n\n### Список параметрів\n\n`mysql`\n\nТільки для процедурного стилю: об'єкт [mysqli](class.mysqli.md), який повернула функція [mysqli\\_connect()](function.mysqli-connect.md)или функция[mysqli\\_init()](mysqli.init.md)\n\n`query`\n\nРядок, що містить запити, які потрібно виконати. Декілька запитів слід розділяти крапкою з комою.\n\n### Значення, що повертаються\n\nПовертає \\*\\*`false`\\*\\*якщо перший вираз викликав помилку. Щоб отримати доступ до помилок інших підзапитів, потрібно спочатку викликати функцію [mysqli\\_next\\_result()](mysqli.next-result.md)\n\n### Помилки\n\nЯкщо сповіщення про помилки mysqli включено (**`MYSQLI_REPORT_ERROR`**) та запитана операція не вдалася, видається попередження. Якщо, крім того, встановлено режим **`MYSQLI_REPORT_STRICT`**, натомість буде викинуто виняток [mysqli\\_sql\\_exception](class.mysqli-sql-exception.md)\n\n### Приклади\n\n**Приклад #1 Приклад використання** mysqli::multi\\_query()\\*\\*\\*\\*\n\nОб'єктно-орієнтований стиль\n\n```php\n<?php\n\nmysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);\n$mysqli = new mysqli(\"localhost\", \"my_user\", \"my_password\", \"world\");\n\n$query = \"SELECT CURRENT_USER();\";\n$query .= \"SELECT Name FROM City ORDER BY ID LIMIT 20, 5\";\n\n/* выполнение нескольких запросов */\n$mysqli->multi_query($query);\ndo {\n    /* сохранить набор результатов в PHP */\n    if ($result = $mysqli->store_result()) {\n        while ($row = $result->fetch_row()) {\n            printf(\"%s\\n\", $row[0]);\n        }\n    }\n    /* вывести разделитель */\n    if ($mysqli->more_results()) {\n        printf(\"-----------------\\n\");\n    }\n} while ($mysqli->next_result());\n```\n\nПроцедурний стиль\n\n```php\n<?php\n\nmysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);\n$link = mysqli_connect(\"localhost\", \"my_user\", \"my_password\", \"world\");\n\n$query = \"SELECT CURRENT_USER();\";\n$query .= \"SELECT Name FROM City ORDER BY ID LIMIT 20, 5\";\n\n/* выполнение нескольких запросов */\nmysqli_multi_query($link, $query);\ndo {\n    /* сохранить набор результатов в PHP */\n    if ($result = mysqli_store_result($link)) {\n        while ($row = mysqli_fetch_row($result)) {\n            printf(\"%s\\n\", $row[0]);\n        }\n    }\n    /* вывести разделитель */\n    if (mysqli_more_results($link)) {\n        printf(\"-----------------\\n\");\n    }\n} while (mysqli_next_result($link));\n```\n\nВисновок наведених прикладів буде схожим на:\n\n```\nmy_user@localhost\n-----------------\nAmersfoort\nMaastricht\nDordrecht\nLeiden\nHaarlemmermeer\n```\n\n### Дивіться також\n\n-   [mysqli\\_query()](mysqli.query.md) \\- Виконує запит до бази даних\n-   [mysqli\\_use\\_result()](mysqli.use-result.md) \\- Готує результуючий набір на сервері для використання\n-   [mysqli\\_store\\_result()](mysqli.store-result.md) \\- передає на клієнта результуючий набір останнього запиту\n-   [mysqli\\_next\\_result()](mysqli.next-result.md) \\- Підготовка наступного доступного результуючого набору з multi\\_query\n-   [mysqli\\_more\\_results()](mysqli.more-results.md) \\- Перевірка, чи є ще результати у мультизапиті\n","title":"mysqli::multi\\_query","contentType":2,"navigation":[{"mysqli.more-results.md":"« mysqli::more\\_results"},{"mysqli.next-result.md":"mysqli::next\\_result »"},{"index.md":"PHP Manual"},{"class.mysqli.md":"mysqli"}]}},"__N_SSG":true}