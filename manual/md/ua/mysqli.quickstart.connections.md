- [« Процедурний та об'єктно-орієнтований
интерфейс](mysqli.quickstart.dual-interface.md)
- [Виконання запитів »](mysqli.quickstart.statements.md)

- [PHP Manual](index.md)
- [Короткий посібник](mysqli.quickstart.md)
- З'єднання

## З'єднання

Сервер MySQL підтримує різні методи передачі. З'єднання
можуть використовувати протоколи TCP/IP, сокети Unix-доменів або іменовані
пайпи Windows.

Ім'я хоста `localhost` має особливе значення. Воно використовується тільки в
сокетів Unix доменів. Щоб відкрити TCP/IP з'єднання з локальним
хостом, необхідно використовувати `127.0.0.1` замість імені хоста
`localhost`.

**Приклад #1 Спеціальне призначення localhost**

` <?php$mysqli u003d new mysqli("localhost", "user", "password", "database");echo $mysqli->host_info . "
";$mysqli u003d new mysqli("127.0.0.1", "user", "password", "database", 3306);echo $mysqli->host_info . "
";

Результат виконання цього прикладу:

Localhost via UNIX socket
127.0.0.1 via TCP/IP

*Змовчання для параметрів з'єднань*

Залежно від функції, що здійснює підключення, якісь параметри
можна не ставити. Якщо параметр не заданий, модуль спробує
використовувати значення за замовчуванням для цього параметра, яке встановлено
конфігураційному файлі PHP.

**Приклад #2 Завдання значень за замовчуванням**

`` inicode
mysqli.default_hostu003d192.168.2.27
mysqli.default_useru003droot
mysqli.default_pwu003d""
mysqli.default_portu003d3306
mysqli.default_socketu003d/tmp/mysql.sock
````

Далі, щоб встановити з'єднання, функція передає параметри
клієнтську бібліотеку, якою користується модуль. Якщо бібліотека
виявить порожні або відсутні параметри, вона може підставити
замість них свої вбудовані значення за промовчанням.

*Вбудовані бібліотечні значення за замовчуванням для параметрів
з'єднання*

Якщо ім'я хоста не задано або передано порожній рядок, клієнтська
бібліотека використовує для підключення до Unix-сокету хоста `localhost`.
Якщо сокет не заданий або передано порожній рядок, і при цьому запрошено
підключення до Unix-сокету, бібліотека спробує підключитися до сокету
`/tmp/mysql.sock`.

У Windows-системах, якщо як ім'я хоста передається `.`,
бібліотека спробує відкрити з'єднання з урахуванням іменованого пайпа. В
У цьому випадку ім'я сокета буде сприйнято як ім'я пайпа. Якщо ім'я сокету
не задано, то буде використано значення `\.\pipe\MySQL`.

Якщо з'єднання не використовує ні сокет домену Unix, ні іменований пайп
Windows, і при цьому не заданий порт для підключення, бібліотека використовує
номер порту `3306`.

У драйвері [mysqlnd](mysqlnd.overview.md) та клієнтській бібліотеці
MySQL (libmysqlclient) закладена та сама логіка визначення умовчань.

*Налаштування з'єднання*

Налаштування з'єднання дозволяють, наприклад, задати якісь команди,
які потрібно виконати одразу після підключення, або віддати розпорядження
використовувати певний набір символів. Налаштування повинні бути задані
до підключення до сервера.

Коли потрібно встановити налаштування з'єднання, операція підключення
виконується в три етапи: функцією [mysqli_init()](mysqli.init.md) або
[mysqli::\_\_construct()](mysqli.construct.md) створюється дескриптор
підключення, потім підключення налаштовується за допомогою функції
[mysqli::options()](mysqli.options.md), і нарешті встановлюється
мережеве з'єднання з сервером за допомогою функції
[mysqli::real_connect()](mysqli.real-connect.md).

*Об'єднання підключень у пул*

Модуль mysqli підтримує постійні з'єднання з базою даних, які
являють собою спеціальний вид об'єднаних сполук. за
замовчуванням кожне відкрите скриптом з'єднання закривається або самим
скриптом під час виконання, або автоматично після завершення роботи
скрипт. Постійні з'єднання відрізняються тим, що не закриваються, а
поміщаються в пул для повторного використання надалі. Якщо
потрібно підключитися до того ж сервера та бази даних, з тим же ім'ям
користувача, паролем, сокетом та портом, то замість створення нового
підключення з пулу виймається вже існуюче. Повторне
використання підключень дозволяє уникнути накладних витрат на
створення нових з'єднань.

Кожен PHP процес використовує свій пул підключень mysqli. В залежності
від конфігурації веб-сервера, PHP-процес може обслуговувати один або
кілька запитів. Відповідно, з'єднання з пулу можуть
послідовно використати кілька скриптів.

*Постійне з'єднання*

Нове підключення створюється, тільки якщо в кулі не знайдеться вільного
підключення з тими ж даними хоста, імені користувача, пароля, сокету,
порту та бази даних за замовчуванням. Механізм постійних з'єднань можна
включати та вимикати PHP директивою
[mysqli.allow_persistent](mysqli.configuration.md#ini.mysqli.allow-persistent).
Максимальна кількість з'єднань, які може відкрити скрипт,
обмежено значенням
[mysqli.max_links](mysqli.configuration.md#ini.mysqli.max-links).
Максимальна кількість з'єднань, які може відкрити один
PHP-процес, обмежений значенням
[mysqli.max_persistent](mysqli.configuration.md#ini.mysqli.max-persistent).
Слід зазначити, що веб-сервер може породжувати багато PHP
процесів.

Головний недолік постійних підключень полягає в тому, що перед
повторним використанням їхній стан не скидається до первісного.
Наприклад, відкриті та незавершені транзакції не будуть автоматично.
відкочуватися. Також, якщо під час знаходження з'єднання в пулі для
процесу змінилися будь-які дозволи або рівні доступу, цей факт
ніяк не позначиться на підключенні при витягуванні з пулу. Таке
поведінка може призвести до небажаних результатів. Хоча, з іншого
сторони, назву `постійний` можна розглядати, як обіцянку, що
підключення і справді залишиться в тому стані, в якому воно було
поміщено у пул.

Модуль mysqli підтримує обидві інтерпретації терміну постійне
з'єднання: стан з'єднання може зберігатися, а може і
скидатися у початкове. За замовчуванням під час вилучення з пулу,
з'єднання скидається. mysqli робить це неявним викликом функції
[mysqli::change_user()](mysqli.change-user.md) щоразу, коли
підключення використовується повторно. З погляду користувача
підключення виглядає, як щойно створене.

Однак, виклик функції [mysqli::change_user()](mysqli.change-user.md)
Досить дорога операція. Для покращення швидкодії можна
перекомпілювати модуль із встановленим прапором
**`MYSQLI_NO_CHANGE_USER_ON_PCONNECT`**.

Вибір між безпечною поведінкою підключень та найкращим
швидкодією залишається за користувачем. Тут не можна дати
однозначної поради. Для простоти використання, за замовчуванням увімкнено
безпечний режим із очищенням з'єднань.

*Дивіться також*

- [mysqli::\_\_construct()](mysqli.construct.md)
- [mysqli_init()](mysqli.init.md)
- [mysqli::options()](mysqli.options.md)
- [mysqli::real_connect()](mysqli.real-connect.md)
- [mysqli::change_user()](mysqli.change-user.md)
- [$mysqli::host_info](mysqli.get-host-info.md)
- [MySQLi Configuration Options](mysqli.configuration.md)
- [Persistent Database
Connections](features.persistent-connections.md)
