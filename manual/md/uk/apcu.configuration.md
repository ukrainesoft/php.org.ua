- [« Встановлення](apcu.installation.md)
- [Типи ресурсів»] (apcu.resources.md)

- [PHP Manual](index.md)
- [Встановлення та налаштування](apcu.setup.md)
- Налаштування під час виконання

## Налаштування під час виконання

Поведінка цих функцій залежить від установок `php.ini`.

Хоча налаштувань APCu за замовчуванням цілком достатньо для більшості завдань,
але для серйозних проектів необхідно уважно вивчити наступні
налаштування.

При налаштуванні APCu необхідно визначитися, скільки пам'яті надати
у розпорядження APCu. Директива ini-файлу, відповідальна за цю
налаштування - `apc.shm_size`. Уважно прочитайте наступний розділ.

Як тільки сервер запущено, скрипт `apc.php`, що постачається з цим
модулем повинен бути скопійований в "docroot" і права на нього повинні
дозволяти запустити його через браузер. Цей скрипт надає
детальну інформацію щодо роботи APCu. Якщо PHP підтримується GD, то
цей скрипт також показуватиме корисні графіки. Звичайно ж перше,
що буде цікаво, це те, чи кешує APC що-небудь. Якщо APC
працює, то значення `Cache full count` (ліворуч) буде показувати,
скільки разів кеш був повністю заповнений і був змушений примусово
видалити записи, до яких не зверталися останні `apc.ttl` секунд. Чим
менше це число - тим краще налаштований кеш. Якщо це число
постійно росте, отже APCu доводиться постійно очищати старі записи
і значить втрачається весь сенс кешування. Найкращий спосіб зменшити
це число - додати APCu пам'яті. Якщо зробити цього не можна, то треба
переналаштувати `apc.filters`, щоб обмежити набір скриптів, що кешуються.

Якщо APCu зібрано за допомогою mmap (Memory Mapping), він буде
використовувати лише один сегмент пам'яті, якщо ж навпаки, APC зібраний з
підтримкою SHM (SysV Shared Memory), він використовуватиме кілька
сегментів. MMAP не має максимального обмеження, на відміну від SHM,
який обмежується `/proc/sys/kernel/shmmax`. Зазвичай рекомендується
використовувати MMAP, тому що він набагато швидше виділяє пам'ять при
перезавантаження веб-сервера, що позначається на швидкості запуску сервера.

| Ім'я За замовчуванням | Місце зміни | Список змін |
|------------------------------------------------- --------------------------|--------------|-------- ---------|---------------------------------------- --------------|
| [apc.enabled](apcu.configuration.md#ini.apcu.enabled) | "1" | PHP_INI_SYSTEM | |
| [apc.shm_segments](apcu.configuration.md#ini.apcu.shm-segments) | "1" | PHP_INI_SYSTEM | |
| [apc.shm_size](apcu.configuration.md#ini.apcu.shm-size) | "32M" | PHP_INI_SYSTEM | |
| [apc.entries_hint](apcu.configuration.md#ini.apcu.entries-hint) | "4096" | PHP_INI_SYSTEM | |
| [apc.ttl](apcu.configuration.md#ini.apcu.ttl) | "0" | PHP_INI_SYSTEM | |
PHP_INI_SYSTEM | || [apc.gc_ttl](apcu.configuration.md#ini.apcu.gc-ttl) | "3600" | 
| [apc.mmap_file_mask](apcu.configuration.md#ini.apcu.mmap-file-mask) | NULL | PHP_INI_SYSTEM | |
PHP_INI_SYSTEM | || [apc.slam_defense](apcu.configuration.md#ini.apcu.slam-defense) | "1" | 
| [apc.enable_cli](apcu.configuration.md#ini.apcu.enable-cli) | "0" | PHP_INI_SYSTEM | |
| [apc.use_request_time](apcu.configuration.md#ini.apcu.use-request-time) | "0" | PHP_INI_ALL | До APCu 5.1.19 значення за промовчанням було "1". |
| [apc.serializer](apcu.configuration.md#ini.apcu.serializer) | "php" | PHP_INI_SYSTEM | До APCu 5.1.19 значення за промовчанням було "default". |
PHP_INI_SYSTEM | || [apc.coredump_unmap](apcu.configuration.md#ini.apcu.coredump-unmap) | "0" | 
| [apc.preload_path](apcu.configuration.md#ini.apcu.preload-path) | NULL | PHP_INI_SYSTEM | |

**Опції конфігурації APCu**

Для детального опису констант PHP_INI\_\*, зверніться до розділу [Де
можуть бути встановлені параметри
конфігурації] (configuration.changes.modes.md).

Коротке пояснення конфігураційних директив.

`apc.enabled` bool
Якщо встановити apc.enabled рівним 0, то APCu не буде запущений. Це
корисно, коли APCu статично включений в PHP і немає інших варіантів,
заборони його використання. Якщо APC зібрано як DSO, можна просто
закоментувати рядок `extension` у `php.ini`.

`apc.shm_segments` int
Кількість сегментів пам'яті, що розділяється, виділеної під кеш. Якщо APC
використав всю доступну розділювану пам'ять, а `apc.shm_size` таким
великим, як дозволяє система, збільшення цього параметра може допомогти.

`apc.shm_size` string
Розмір сегмента пам'яті, що розділяється, заданий в короткій нотації
(дивіться [цей FAQ](faq.using.md#faq.using.shorthandbytes)). за
замовчуванням, деякі системи (включаючи більшість варіантів BSD)
обмежують це значення украй малим значенням.

`apc.entries_hint` int
Це підказка про кількість унікальних змін користувачів,
які треба кешувати. Встановіть рівним нулю або взагалі не
вказуйте, якщо не впевнені.

`apc.ttl` int
Кількість секунд, які запис може лежати в кеші без звернення до
ній, як буде дозволено її замінити іншу. Встановлення цього
параметра рівного нулю може призвести до того, що місце буде забито
і нові записи не зможуть потрапити до кешу. У цьому випадку, якщо параметр
дорівнює 0, кеш повністю очищений. Якщо ж ttl буде більшим за нуль, то
APCu намагатиметься очистити застарілі записи.

`apc.gc_ttl` int
Кількість секунд, які запис може перебувати у списку збирача
сміття. Це значення забезпечує безвідмовність у разі падіння сервера
у момент виконання закешованого файлу. Якщо виконуваний файл був
змінено, пам'ять, виділена під кешування його старої версії, не буде
повернуто до закінчення цього часу. Встановлення в нуль відключає цей
функціонал.

`apc.mmap_file_mask` string
Якщо зібраний за допомогою MMAP, за допомогою опції `--enable-mmap`, цей
параметр повинен містити файлову маску типу mktemp-style для передачі
в модуль MMAP, щоб визначити, чи MMAP використовуватиме файлову
систему або пам'ять, що розділяється. Для файлової системи задайте опцію як
`/tmp/apc.XXXXXX` (рівно 6 `X`). Для використання shm_open/mmap у стилі
POSIX, додайте `.shm` у будь-якому місці маски, наприклад `/apc.shm.XXXXXX`
Ви також можете встановити його як `/dev/zero` для використання
інтерфейсу ядра `/dev/zero` для анонімної пам'яті mmap Якщо не поставлено,
то примусово використовуватиметься анонімний mmap.

`apc.slam_defense` int
На дуже завантажених серверах, коли ви запускаєте веб-сервер, відразу
безліч процесів намагатимуться закешувати один і той же файл
одночасно. Цією опцією задається можливість, у відсотках, того, що
спроба одного конкретного процесу закешувати дані буде відхилена.
Наприклад, якщо `apc.slam_defense` встановити рівні `75`, то це
означає, що можливість закешувати файл, якого в кеші немає, буде
дорівнює 25% і ймовірність того, що в кешуванні буде відмовлено рівну
75%. Для заборони даного функціоналу встановіть цей параметр рівним
`0`.

`apc.enable_cli` int
Більше для тестування та налагодження. Ця установка включає APCu для CLI
версії PHP. При звичайній роботі, запускати APCu, який буде створювати,
наповнювати та знищувати кеш при кожному запуску сценарію в консолі, буде
далеко не найкращою ідеєю. Але з метою тестування та налагодження, можна легко
увімкнути APCu для CLI.

`apc.serializer` string
Вказує APC на використання стороннього серіалізатора.

`apc.coredump_unmap` bool
Дозволяє APC перехоплювати сигнали, такі як SIGSEGV, який
записує coredump, коли подано. Коли ці сигнали будуть отримані, APC
спробує звільнити всю пам'ять, що розділяється, щоб не включати її в
coredump. Ця установка може збільшити стабільність системи, коли
критичний сигнал був отриманий, а APC налаштований на використання
великого обсягу пам'яті.

**Увага**
Ця можливість потенційно небезпечна. Визволення сегментів
пам'яті при отриманні критичного сигналу може призвести до
непередбачуваної поведінки.

> **Примітка**:
>
> Хоча деякі ядра надають можливість ігнорувати деякі
> сегменти пам'яті при записі core-файлу, ці реалізації
> можуть також ігнорувати важливі сегменти пам'яті, такі як Apache
> scoreboard.

`apc.preload_path` string
Опціонально. Задає шлях, який використовується APC для завантаження
кешованих даних під час запуску.

`apc.use_request_time` bool
Використовувати час старту запиту SAPI для TTL.
