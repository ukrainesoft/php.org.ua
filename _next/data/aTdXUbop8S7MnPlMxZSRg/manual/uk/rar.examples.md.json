{"pageProps":{"page":{"slug":"rar.examples.md","content":"# Приклади\n\nТакож дивіться приклади за посиланням [`rar://`wrapper](wrappers.rar.md)\n\n**Приклад #1 Декомпресія на льоту**\n\n```php\n<?php\n\nif (!array_key_exists(\"i\", $_GET) || !is_numeric($_GET[\"i\"]))\n    die(\"Индекс не указан или не числовой\");\n$index = (int) $_GET[\"i\"];\n\n$arch = RarArchive::open(\"example.rar\");\nif ($arch === FALSE)\n    die(\"Невозможно открыть example.rar\");\n\n$entries = $arch->getEntries();\nif ($entries === FALSE)\n    die(\"Невозможно получить записи\");\n\nif (!array_key_exists($index, $entries))\n    die(\"Нет такого индекса: $index\");\n\n$orfilename = $entries[$index]->getName(); //Кодировка UTF-8\n\n$filesize = $entries[$index]->getUnpackedSize();\n\n/* Вы можете здесь проверить константу HTTP_IF_MODIFIED_SINCE и сравнить с\n * $entries[$index]->getFileTime(). Также возможно отослать заголовок\n * \"Last modified\" */\n\n$fp = $entries[$index]->getStream();\nif ($fp === FALSE)\n    die(\"Невозможно открыть файл с индексом $index внутри архива.\");\n\n$arch->close(); // Больше не нужен. Поток является независимым\n\nfunction detectUserAgent() {\n    if (!array_key_exists('HTTP_USER_AGENT', $_SERVER))\n        return \"Other\";\n\n    $uas = $_SERVER['HTTP_USER_AGENT'];\n    if (preg_match(\"@Opera/@\", $uas))\n        return \"Opera\";\n    if (preg_match(\"@Firefox/@\", $uas))\n        return \"Firefox\";\n    if (preg_match(\"@Chrome/@\", $uas))\n        return \"Chrome\";\n    if (preg_match(\"@MSIE ([0-9.]+);@\", $uas, $matches)) {\n        if (((float)$matches[1]) >= 7.0)\n            return \"IE\";\n    }\n\n    return \"Other\";\n}\n\n/*\n * Действуют 3 опции:\n * - Для FF и Opera, с поддержкой RFC 2231, используется этот формат.\n * - Для IE и Chrome, используется attwithfnrawpctenclong\n *   (http://greenbytes.de/tech/tc2231/#attwithfnrawpctenclong)\n * - Для других браузеров, перекодируется в ISO-8859-1, если возможно\n */\n$formatRFC2231 = 'Content-Disposition: attachment; filename*=UTF-8\\'\\'%s';\n$formatDef = 'Content-Disposition: attachment; filename=\"%s\"';\n\nswitch (detectUserAgent()) {\n    case \"Opera\":\n    case \"Firefox\":\n        $orfilename = rawurlencode($orfilename);\n        $format = $formatRFC2231;\n        break;\n\n    case \"IE\":\n    case \"Chrome\":\n        $orfilename = rawurlencode($orfilename);\n        $format = $formatDef;\n        break;\n    default:\n        if (function_exists('iconv'))\n            $orfilename =\n                @iconv(\"UTF-8\", \"ISO-8859-1//TRANSLIT\", $orfilename);\n        $format = $formatDef;\n}\n\nheader(sprintf($format, $orfilename));\n//Невозможна дальнейшая отсылка сообщений об ошибках (заголовки уже отправлены)\n\n//Замена на реальный content type, возможно определённый по расширению файла\n$contentType = \"application/octet-stream\";\nheader(\"Content-Type: $contentType\");\n\nheader(\"Content-Transfer-Encoding: binary\");\n\nheader(\"Content-Length: $filesize\");\n\nif ($_SERVER['REQUEST_METHOD'] == \"HEAD\")\n    die();\n\nwhile (!feof($fp)) {\n    $s = @fread($fp, 8192);\n    if ($s === false)\n        break; //тут бесполезно отправлять сообщения об ошибках\n\n    echo $s;\n}\n?>\n```\n\nЦей приклад відкриває файл RAR і надає запитаний файл поза RAR-архівом для завантаження клієнтом.\n\n**Приклад #2 Приклад вилучення переліку файлів та директорій з RAR-архіву**\n\n```php\n<?php\n\n$rar_file = rar_open('example.rar') or die(\"Невозможно открыть RAR архив\");\n\n$entries = rar_list($rar_file);\n\nforeach ($entries as $entry) {\n    echo 'Имя файла: ' . $entry->getName() . \"\\n\";\n    echo 'Упакованный размер: ' . $entry->getPackedSize() . \"\\n\";\n    echo 'Распакованный размер: ' . $entry->getUnpackedSize() . \"\\n\";\n\n    $entry->extract('/dir/extract/to/');\n}\n\nrar_close($rar_file);\n\n?>\n```\n\nЦей приклад відкриває RAR-файл та витягує кожен об'єкт у вказану директорію.\n","title":"Приклади","contentType":2,"navigation":[{"rar.constants.md":"« Зумовлені константи"},{"ref.rar.md":"Rar »"},{"index.md":"PHP Manual"},{"book.rar.md":"Rar"}]}},"__N_SSG":true}