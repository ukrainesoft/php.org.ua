{"pageProps":{"page":{"slug":"stream.streamwrapper.example-1.md","content":"## Приклад класу, зареєстрованого як обгортка потоку\n\nПриклад нижче реалізує обробник протоколу var://, який дозволяє читати/писати в іменовану глобальну змінну, використовуючи стандартні потокові функції, що працюють із файловою системою, такі як [fread()](function.fread.md). . Протокол var:// при передачі URL \"var://foo\" читатиме/писати з/в $GLOBALS\\[\"foo\"\\]\n\n**Приклад #1 Потік для читання/запису глобальних змінних**\n\n```php\n<?php\n\nclass VariableStream {\n    var $position;\n    var $varname;\n\n    function stream_open($path, $mode, $options, &$opened_path)\n    {\n        $url = parse_url($path);\n        $this->varname = $url[\"host\"];\n        $this->position = 0;\n\n        return true;\n    }\n\n    function stream_read($count)\n    {\n        $ret = substr($GLOBALS[$this->varname], $this->position, $count);\n        $this->position += strlen($ret);\n        return $ret;\n    }\n\n    function stream_write($data)\n    {\n        $left = substr($GLOBALS[$this->varname], 0, $this->position);\n        $right = substr($GLOBALS[$this->varname], $this->position + strlen($data));\n        $GLOBALS[$this->varname] = $left . $data . $right;\n        $this->position += strlen($data);\n        return strlen($data);\n    }\n\n    function stream_tell()\n    {\n        return $this->position;\n    }\n\n    function stream_eof()\n    {\n        return $this->position >= strlen($GLOBALS[$this->varname]);\n    }\n\n    function stream_seek($offset, $whence)\n    {\n        switch ($whence) {\n            case SEEK_SET:\n                if ($offset < strlen($GLOBALS[$this->varname]) && $offset >= 0) {\n                     $this->position = $offset;\n                     return true;\n                } else {\n                     return false;\n                }\n                break;\n\n            case SEEK_CUR:\n                if ($offset >= 0) {\n                     $this->position += $offset;\n                     return true;\n                } else {\n                     return false;\n                }\n                break;\n\n            case SEEK_END:\n                if (strlen($GLOBALS[$this->varname]) + $offset >= 0) {\n                     $this->position = strlen($GLOBALS[$this->varname]) + $offset;\n                     return true;\n                } else {\n                     return false;\n                }\n                break;\n\n            default:\n                return false;\n        }\n    }\n\n    function stream_metadata($path, $option, $var)\n    {\n        if($option == STREAM_META_TOUCH) {\n            $url = parse_url($path);\n            $varname = $url[\"host\"];\n            if(!isset($GLOBALS[$varname])) {\n                $GLOBALS[$varname] = '';\n            }\n            return true;\n        }\n        return false;\n    }\n}\n\nstream_wrapper_register(\"var\", \"VariableStream\")\n    or die(\"Не удалось зарегистрировать обёртку\");\n\n$myvar = \"\";\n\n$fp = fopen(\"var://myvar\", \"r+\");\n\nfwrite($fp, \"line1\\n\");\nfwrite($fp, \"line2\\n\");\nfwrite($fp, \"line3\\n\");\n\nrewind($fp);\nwhile (!feof($fp)) {\n    echo fgets($fp);\n}\nfclose($fp);\nvar_dump($myvar);\n\n?>\n```\n\nРезультат виконання наведеного прикладу:\n\n```\nline1\nline2\nline3\nstring(18) \"line1\nline2\nline3\n\"\n```\n","title":"Приклад класу, зареєстрованого як обгортка потоку","contentType":2,"navigation":[{"stream.examples.md":"« Приклади"},{"class.php-user-filter.md":"php\\_user\\_filter »"},{"index.md":"PHP Manual"},{"stream.examples.md":"Приклади"}]}},"__N_SSG":true}