{"pageProps":{"page":{"slug":"intro.eio.md","content":"# Вступ\n\nМодуль реалізує підсистему введення-виведення POSIX I/O засобів [» libeio](http://software.schmorp.de/pkg/libeio.md)Библиотека C Написана Марком Леманном (Marc Lehmann).\n\n> **Зауваження**: Для Windows-платформ цей модуль недоступний.\n\n**Увага**\n\nСлід врахувати, кожен запит виконується окремому потоці, у своїй виконання запитів безупинно, які порядок у черзі виконання непередбачуваний. Наприклад, наведений нижче приклад коду невірний.\n\n**Приклад #1 Приклад неправильних запитів**\n\n```php\n<?php\n// Запрос на создание символической ссылки $link на файл $filename\neio_symlink($filename, $link);\n\n// Запрос на переименование файла $filename в $new_filename\neio_rename($filename, $new_filename);\n\n// Выполнение запросов\neio_event_loop();\n?>\n```\n\nУ наведеному вище прикладі запит [eio\\_rename()](function.eio-rename.md) може бути виконаний перед [eio\\_symlink()](function.eio-symlink.md). Правильним рішенням буде виклик [eio\\_rename()](function.eio-rename.md) callback-функцією в [eio\\_symlink()](function.eio-symlink.md) :\n\n**Приклад #2 Створення запиту за допомогою callback-функції**\n\n```php\n<?php\nfunction my_symlink_done($filename, $result) {\n // Запрос на переменование $filename в $new_filename\n eio_rename($filename, \"/path/to/new-name\");\n\n // Выполнение запросов\n eio_event_loop();\n}\n\n// Запрос на создание символической ссылки $link на файл $filename\neio_symlink($filename, $link, EIO_PRI_DEFAULT, \"my_symlink_done\", $filename);\n\n// Выполнение запросов\neio_event_loop();\n?>\n```\n\nАльтернативним рішенням є створення групи запитів:\n\n**Приклад #3 Створення запиту за допомогою callback-функції**\n\n```php\n<?php\n/* Функция вызывается после выполнения группы запросов */\nfunction my_grp_done($data, $result) {\n // ...\n}\n\nfunction my_symlink_done($filename, $result) {\n // Создание запроса eio_rename и добавление его в группу\n $req = eio_rename($filename, \"/path/to/new-name\");\n eio_grp_add($grp, $req);\n // Возможно, вы захотите добавить больше запросов...\n}\n\n// Создание группы запросов\n$grp = eio_grp(\"my_grp_done\", \"my_grp_data\");\n\n// Создание запроса eio_symlink request и добавление в группу\n// Передача $filename в callback-функцию\n$req = eio_symlink($filename, $link,\n  EIO_PRI_DEFAULT, \"my_symlink_done\", $filename);\neio_grp_add($grp, $req);\n\n// Выполнение запросов\neio_event_loop();\n?>\n```\n\nГрупа – це спеціальний вид запиту, що дозволяє створити набір звичайних. *eio*\\-запитів. Це може бути використане для створення складних запитів, які відкривають, читають та закривають файл.\n\nПочинаючи з версії 0.3.0 alpha, змінна, що використовується для внутрішньої взаємодії з libeio, може бути отримана функцією [eio\\_get\\_event\\_stream()](function.eio-get-event-stream.md). Змінна може бути використана для прив'язки до циклу обробки, що поставляється стороннім модулем. Можливо організувати простий цикл обробки, де eio і libevent працюють спільно.\n\n**Приклад #4 Використання eio спільно з libevent**\n\n```php\n<?php\nfunction my_eio_poll($fd, $events, $arg) {\n    /* Некоторые действия с libevent могут быть здесь */\n    if (eio_nreqs()) {\n        eio_poll();\n    }\n    /* .. и здесь */\n}\n\nfunction my_res_cb($d, $r) {\n    var_dump($r); var_dump($d);\n}\n\n$base = event_base_new();\n$event = event_new();\n\n// Этот поток требуется для привязки к libevent\n$fd = eio_get_event_stream();\n\neio_nop(EIO_PRI_DEFAULT, \"my_res_cb\", \"nop data\");\neio_mkdir(\"/tmp/abc-eio-temp\", 0750, EIO_PRI_DEFAULT, \"my_res_cb\", \"mkdir data\");\n/* Прочие eio_* запросы  ... */\n\n\n// Установка флагов события\nevent_set($event, $fd, EV_READ /*| EV_PERSIST*/, \"my_eio_poll\", array($event, $base));\n\n// Установка основы события\nevent_base_set($event, $base);\n\n// Включение события\nevent_add($event);\n\n// Запуск цикла обработки\nevent_base_loop($base);\n\n/* То же самое доступно через интерфейс буфера libevent */\n?>\n```\n","title":"Вступ","contentType":2,"navigation":[{"book.eio.md":"« Eio"},{"eio.setup.md":"Встановлення та налаштування \""},{"index.md":"PHP Manual"},{"book.eio.md":"Eio"}]}},"__N_SSG":true}