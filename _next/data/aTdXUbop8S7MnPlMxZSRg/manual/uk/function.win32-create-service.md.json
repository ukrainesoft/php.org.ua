{"pageProps":{"page":{"slug":"function.win32-create-service.md","content":"# win32\\_create\\_service\n\n(PECL win32service >=0.1.0)\n\nwin32\\_create\\_service — Створює новий запис служби у базі даних SCM\n\n### Опис\n\n```methodsynopsis\nwin32_create_service(array $details, string $machine = ?): void\n```\n\nСпробує додати службу до бази даних SCM. Для цього потрібні права адміністратора.\n\n### Список параметрів\n\n`details`\n\nМасив деталей служби:\n\n`service`\n\nКоротка назва служби. Це ім'я, яке ви будете використовувати для керування службою за допомогою команди `net`. Служба повинна бути унікальною (ніякі дві служби не можуть мати одну й ту саму назву) і, в ідеалі, не повинна містити прогалин у назві.\n\n`display`\n\nІм'я служби, що відображається. Це ім'я, яке ви побачите в аплеті служб.\n\n`description`\n\nДетальний опис послуги. Це опис, який ви побачите в аплеті служб.\n\n`user`\n\nІм'я облікового запису користувача, під яким потрібно запускати службу. Якщо цей параметр не вказано, служба буде працювати під обліковим записом LocalSystem. Якщо вказано ім'я користувача, ви також повинні вказати пароль.\n\n`password`\n\nПароль, соответствующий`user`\n\n`path`\n\nПовний шлях до модуля, який буде запущений при запуску служби. Якщо не вказано, використовуватиметься шлях до поточного процесу PHP.\n\n`params`\n\nПараметри командного рядка передачі службі під час її запуску. Якщо ви хочете запустити скрипт PHP як службу, то першим параметром має бути повний шлях до скрипту PHP, який ви збираєтеся запустити. Якщо ім'я скрипта або шлях містять прогалини, увімкніть повний шлях до скрипту в лапки `\"`\n\n`load_order`\n\nКерує load\\_order. Ще не повністю підтримується.\n\n`svc_type`\n\nВстановлює тип служби. Якщо опущено, буде використано значення за замовчуванням **`WIN32_SERVICE_WIN32_OWN_PROCESS`**. Не змінюйте цього, якщо ви не знаєте, що робите.\n\n`start_type`\n\nВстановлює спосіб запуску служби. За замовчуванням використовується **`WIN32_SERVICE_AUTO_START`**, що означає, що служба буде запущена під час запуску машини.\n\n`error_control`\n\nПовідомляє SCM, що він повинен робити при виявленні проблеми зі службою. За умовчанням це **`WIN32_SERVER_ERROR_IGNORE`**. Зміна цього значення поки що підтримується не повністю.\n\n`delayed_start`\n\nЯкщо для `delayed_start`установлено значение\\*\\*`true`\\*\\*, Це проінформує SCM про те, що служба повинна бути запущена після того, як будуть запущені інші служби автозапуску, плюс невелика затримка.\n\nБудь-яку службу можна позначити як службу з відкладеним автозапуском; однак цей параметр не діє, якщо `start_type` служби не дорівнює **`WIN32_SERVICE_AUTO_START`**\n\nПараметр застосовується лише у Windows Vista та Windows Server 2008 або пізніших версіях.\n\n`base_priority`\n\nЩоб зменшити вплив на використання процесора, може знадобитися встановити базовий пріоритет нижче звичайного.\n\n`base_priority` може бути однією з констант визначених у [базових класах пріоритету Win32](win32service.constants.basepriorities.md)\n\n`dependencies`\n\nЩоб визначити залежність вашої служби, може знадобитися встановити цей параметр для списку імен служб у масиві.\n\n`recovery_delay`\n\nЦей параметр визначає затримку між помилкою та виконанням дії відновлення. Значення у мілісекундах.\n\nЗначення за замовчуванням – 60000.\n\n`recovery_action_1`\n\nДія буде виконана за першої помилки. Значення за замовчуванням - **`WIN32_SC_ACTION_NONE`**\n\nДля`recovery_action_1` можна задати одну з констант [дій відновлення Win32](win32service.constants.recovery-action.md)\n\n`recovery_action_2`\n\nДія буде виконана за другої помилки. Значення за замовчуванням - **`WIN32_SC_ACTION_NONE`**\n\nДля`recovery_action_2` можна задати одну з констант [дій відновлення Win32](win32service.constants.recovery-action.md)\n\n`recovery_action_3`\n\nДія буде виконана за наступних помилок. Значення за замовчуванням - **`WIN32_SC_ACTION_NONE`**\n\nДля`recovery_action_3` можна задати одну з констант [дій відновлення Win32](win32service.constants.recovery-action.md)\n\n`recovery_reset_period`\n\nЛічильник відмов буде скинутий після затримки, визначеної у параметрі. Затримка вказується за секунди.\n\nЗначение по умолчанию`86400`\n\n`recovery_enabled`\n\nВстановіть для цього параметра значення \\*\\*`true`**для включения настроек восстановления,**`false`\\*\\*для отключения.\n\nЗначение по умолчанию\\*\\*`false`\\*\\*\n\n`recovery_reboot_msg`\n\nВстановіть цей параметр, щоб визначити повідомлення, яке зберігається в журналі подій Windows перед перезавантаженням. Використовується, лише якщо для однієї з дій встановлено значення **`WIN32_SC_ACTION_REBOOT`**\n\n`recovery_command`\n\nВстановіть цей параметр, щоб визначити команду, яка виконується, якщо одна з дій визначена, як **`WIN32_SC_ACTION_RUN_COMMAND`**\n\n`machine`\n\nНеобов'язкове ім'я машини, на якій потрібно створити службу. Якщо не вказано, використовуватиметься локальний комп'ютер.\n\n### Значення, що повертаються\n\nФункція не повертає значення після виконання.\n\nДо версії 1.0.0, Повертає **`WIN32_NO_ERROR`** у разі успішного завершення **`false`** якщо була виявлена ​​проблема з параметрами або [код помилки Win32](win32service.constants.errors.md) при невдалому завершенні роботи.\n\n### Помилки\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`service`не задано.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`path`не задано.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`svc_type` вказано неправильно.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`start_type` вказано неправильно.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`error_control` вказано неправильно.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`base_priority` вказано неправильно.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`recovery_delay` не в проміжку між 0 та PHP\\_INT\\_MAX.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`recovery_action_1` вказано неправильно.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`recovery_action_2` вказано неправильно.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`recovery_action_3` вказано неправильно.\n\nВикидається [ValueError](class.valueerror.md), если значение параметра`recovery_reset_period` не в проміжку між 0 та PHP\\_INT\\_MAX.\n\nУ разі виникнення помилки викидається [Win32ServiceException](class.win32serviceexception.md)\n\n### список змін\n\n| Версия | Опис |\n| --- | --- |\n| PECL win32service 1.0.0 | Викидає [ValueError](class.valueerror.md) у разі невірних даних у параметрах раніше поверталося **`false`** |\n| PECL win32service 1.0.0 | Викидає [Win32ServiceException](class.win32serviceexception.md) у разі виникнення помилки, раніше повертався [Код помилки Win32](win32service.constants.errors.md) |\n| PECL win32service 1.0.0 | Тип повернення тепер void, раніше був [mixed](language.types.declarations.md#language.types.declarations.mixed) |\n| PECL win32service 0.4.0 | Додані параметри `dependencies` `recovery_delay` `recovery_action_1` `recovery_action_2` `recovery_action_3` `recovery_reset_period` `recovery_enabled` `recovery_reboot_msg`и`recovery_command` |\n\n### Приклади\n\n**Приклад #1 Приклад використання** win32\\_create\\_service()\\*\\*\\*\\*\n\nСтворення сервісу з короткою назвою dummyphp.\n\n```php\n<?php\n$x = win32_create_service(array(\n    'service'     => 'dummyphp',                                           // название сервиса\n    'display'     => 'sample dummy PHP service',                           // краткое описание\n    'description' => 'This is a dummy Windows service created using PHP.', // полное описание\n    'params'      => '\"' . __FILE__ . '\"  run',                            // путь до скрипта и параметров\n));\ndebug_zval_dump($x);\n?>\n```\n\n**Приклад #2 Приклад використання** win32\\_create\\_service()\\*\\* із залежностями\\*\\*\n\nСтворення сервісу з короткою назвою 'dummyphp' та залежностями.\n\n```php\n<?php\n$x = win32_create_service(array(\n    'service'      => 'dummyphp',                                           // название сервиса\n    'display'      => 'sample dummy PHP service',                           // краткое описание\n    'description'  => 'This is a dummy Windows service created using PHP.', // полное описание\n    'params'       => '\"' . __FILE__ . '\"  run',                            // путь до скрипта и параметров\n    'dependencies' => array(\"Netman\"),                                      // список зависимостей\n));\ndebug_zval_dump($x);\n?>\n```\n\n**Приклад #3 Приклад використання** win32\\_create\\_service()**с восстановлением**\n\nСтворення сервісу з короткою назвою 'dummyphp' та налаштуваннями відновлення.\n\n```php\n<?php\n$x = win32_create_service(array(\n    'service'               => 'dummyphp',                                           // название сервиса\n    'display'               => 'sample dummy PHP service',                           // краткое описание\n    'description'           => 'This is a dummy Windows service created using PHP.', // полное описание\n    'params'                => '\"' . __FILE__ . '\"  run',                            // путь до скрипта и параметров\n    'recovery_delay'        => 120000,                                               // Действие восстановления выполняется через 2 минуты.\n    'recovery_action_1'     => WIN32_SC_ACTION_RESTART,                              // При первом сбое перезапускается служба.\n    'recovery_action_2'     => WIN32_SC_ACTION_RUN_COMMAND,                          // При втором сбое выполняется команда\n    'recovery_action_3'     => WIN32_SC_ACTION_NONE,                                 // При последующих сбоях ничего не делать\n    'recovery_reset_period' => 86400,                                                // Сбросить счётчик ошибок через 1 день\n    'recovery_enabled'      => true,                                                 // Включить параметр восстановления\n    'recovery_reboot_msg'   => null,                                                 // Не определяйте сообщение о перезагрузке, здесь оно не нужно\n    'recovery_command'      => \"c:\\clean-service.bat\",                               // Когда действие - WIN32_SC_ACTION_RUN_COMMAND, выполняется эта команда\n));\ndebug_zval_dump($x);\n?>\n```\n\n### Дивіться також\n\n-   [win32\\_delete\\_service()](function.win32-delete-service.md) \\- Видалення запису служби з бази даних SCM\n-   [Базові класи пріоритету Win32](win32service.constants.basepriorities.md)\n-   [Дії відновлення Win32](win32service.constants.recovery-action.md)\n-   [Коди помилок Win32](win32service.constants.errors.md)\n","title":"win32\\_create\\_service","contentType":2,"navigation":[{"function.win32-continue-service.md":"« win32\\_continue\\_service"},{"function.win32-delete-service.md":"win32\\_delete\\_service »"},{"index.md":"PHP Manual"},{"ref.win32service.md":"win32service"}]}},"__N_SSG":true}