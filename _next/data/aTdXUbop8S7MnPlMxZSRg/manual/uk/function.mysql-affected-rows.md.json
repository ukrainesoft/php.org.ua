{"pageProps":{"page":{"slug":"function.mysql-affected-rows.md","content":"# mysql\\_affected\\_rows\n\n(PHP 4, PHP 5)\n\nmysql\\_affected\\_rows - Повертає число порушених минулою операцією рядів\n\n**Увага**\n\nЦей модуль застарів, починаючи з версії PHP 5.5.0, і видалений у PHP 7.0.0. Використовуйте замість нього [MySQLi](book.mysqli.md) або [PDO\\_MySQL](ref.pdo-mysql.md)Смотрите также инструкцию[MySQL: вибір API](mysqlinfo.api.choosing.md). Альтернативи для цієї функції:\n\n-   [mysqli\\_affected\\_rows()](mysqli.affected-rows.md)\n-   [PDOStatement::rowCount()](pdostatement.rowcount.md)\n\n### Опис\n\n```methodsynopsis\nmysql_affected_rows(resource $link_identifier = NULL): int\n```\n\nПовертає кількість рядів, які торкнулися останнім INSERT, UPDATE, REPLACE або DELETE запитом, пов'язаним з дескриптором `link_identifier`\n\n### Список параметрів\n\n`link_identifier`\n\nЗ'єднання MySQL. Якщо ідентифікатор з'єднання не вказано, буде використано останнє з'єднання, відкрите [mysql\\_connect()](function.mysql-connect.md). Якщо таке з'єднання не було знайдено, функція спробує створити таке, якби [mysql\\_connect()](function.mysql-connect.md) було викликано без параметрів. Якщо з'єднання не було знайдено та не змогло бути створено, генерується помилка рівня **`E_WARNING`**\n\n### Значення, що повертаються\n\nПовертає кількість змінених записів у разі успішного виконання, і -1 якщо останній запит не вдався.\n\nЯкщо останній запит був DELETE без вказівки WHERE і, відповідно, таблицю було очищено, функція поверне нуль у всіх версіях MySQL до 4.1.2.\n\nПри використанні UPDATE MySQL не оновить колонки, що вже містять нове значення. Внаслідок цього, функція **mysql\\_affected\\_rows()** не завжди повертає кількість рядів, що підійшли під умови, лише кількість рядів, оновлених запитом.\n\nЗапит REPLACE спочатку видаляє запис із зазначеним первинним ключем, а потім вставляє новий. Ця функція повертає кількість видалених записів разом із кількістю вставлених.\n\nУ разі використання запитів типу \"INSERT ... ON DUPLICATE KEY UPDATE\", значення, що повертається, буде дорівнює у випадку, якщо була зроблена вставка, або при обновлении существующего ряда.\n\n### Приклади\n\n**Приклад #1 Приклад використання** mysql\\_affected\\_rows()\\*\\*\\*\\*\n\n```php\n<?php\n$link = mysql_connect('localhost', 'mysql_user', 'mysql_password');\nif (!$link) {\n    die('Ошибка соединения: ' . mysql_error());\n}\nmysql_select_db('mydb');\n\n/* здесь функция вернёт корректное число удалённых записей */\nmysql_query('DELETE FROM mytable WHERE id < 10');\nprintf(\"Удалено записей: %d\\n\", mysql_affected_rows());\n\n/* если WHERE всегда возвращает false, то функция возвращает 0 */\nmysql_query('DELETE FROM mytable WHERE 0');\nprintf(\"Удалено записей: %d\\n\", mysql_affected_rows());\n?>\n```\n\nВисновок наведеного прикладу буде схожим на:\n\n```\nУдалено записей: 10\nУдалено записей: 0\n```\n\n**Приклад #2 Приклад використання** mysql\\_affected\\_rows()\\*\\* з транзакціями\\*\\*\n\n```php\n<?php\n$link = mysql_connect('localhost', 'mysql_user', 'mysql_password');\nif (!$link) {\n    die('Ошибка соединения: ' . mysql_error());\n}\nmysql_select_db('mydb');\n\n/* Обновляем ряды */\nmysql_query(\"UPDATE mytable SET used=1 WHERE id < 10\");\nprintf (\"Обновлено записей: %d\\n\", mysql_affected_rows());\nmysql_query(\"COMMIT\");\n?>\n```\n\nВисновок наведеного прикладу буде схожим на:\n\n```\nОбновлено записей: 10\n```\n\n### Примітки\n\n> **Зауваження** **Транзакції**\n> \n> При использовании транзакций**mysql\\_affected\\_rows()** потрібно викликати після запитів INSERT, UPDATE, DELETE, але з COMMIT.\n\n> **Зауваження** **Запити SELECT**\n> \n> Щоб отримати кількість рядів, повернутих SELECT-запитом, використовуйте функцію [mysql\\_num\\_rows()](function.mysql-num-rows.md)\n\n> **Зауваження** **Каскадні зовнішні ключі**\n> \n> **mysql\\_affected\\_rows()** не підраховує ряди, неявно змінені обмеженнями ON DELETE CASCADE та/або ON UPDATE CASCADE.\n\n### Дивіться також\n\n-   [mysql\\_num\\_rows()](function.mysql-num-rows.md) \\- Повертає кількість рядів результату запиту\n-   [mysql\\_info()](function.mysql-info.md) \\- Повертає інформацію про останній запит\n","title":"mysql\\_affected\\_rows","contentType":2,"navigation":[{"ref.mysql.md":"« MySQL"},{"function.mysql-client-encoding.md":"mysql\\_client\\_encoding »"},{"index.md":"PHP Manual"},{"ref.mysql.md":"MySQL"}]}},"__N_SSG":true}