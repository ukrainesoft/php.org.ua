- [« Опції](features.commandline.options.md)
- [Потоки введення/виводу »](features.commandline.io-streams.md)

- [PHP Manual](index.md)
- [Використання PHP у командному рядку](features.commandline.md)
- Виконання PHP-файлів

## Виконання PHP-файлів

У CLI SAPI є три різні способи запуску PHP-коду:

1. Вказує конкретний файл для запуску.

$php my_script.php

$php -f my_script.php

Обидва способи (із зазначенням опції **-f** або без) запустять файл
`my_script.php`. Немає обмежень, який файл запускати; зокрема,
файли повинні мати розширення `.php`.

2. Надіслати PHP-код безпосередньо в командному рядку.

$ php -r 'print_r(get_defined_constants());'

Необхідно бути особливо обережним при використанні цього способу,
т.к. може статися підстановка змінних оболонок при
використання подвійних лапок.

> **Примітка**:
>
> Уважно прочитайте приклад: у ньому немає тих, що відкривають і закривають
> тегів! Опція **-r** просто їх не потребує, та їх використання
> призведе до помилки аналізу.

3. Передати PHP-код, що запускається, через стандартний потік введення
(`stdin`).

Це дає потужну можливість створювати PHP-код та передавати його
файлу, що запускається, як показано в цьому (вигаданому) прикладі:

$some_application | some_filter | php | sort -u > final_output.txt

Ви не можете комбінувати будь-який із цих трьох способів запуску коду.

Як і будь-яка інша консольна програма, бінарний файл PHP приймає
аргументи, але PHP-скрипт може отримувати аргументи. PHP не
обмежує кількість аргументів, що передаються в скрипт (оболонка
консолі встановлює деякий поріг кількості символів, які можуть
бути передані; зазвичай цього ліміту вистачає). Передані аргументи
доступні в глобальному масиві $argv. Перший індекс (нуль) завжди
містить ім'я скрипта з командного рядка. Врахуйте, що якщо
код викликається на льоту з командного рядка за допомогою опції **-r**,
значенням $argv[0]` буде "Стандартний потік" (Standard input
code"); до PHP 7.2.0 це був дефіс (`"-"`). Те саме вірно і для
коду, переданого через конвеєр із `STDIN`.

Друга зареєстрована глобальна змінна - це $argc,
містить кількість елементів у масиві `$argv` (а *не* кількість
аргументів, переданих скрипту).

Якщо аргументи, що передаються, не починаються з символу `-`, то особливих
проблем не повинно бути. Передається в скрипт аргумент, який
починається з `-` створить проблеми, т.к. PHP вирішить, що він сам винен його
обробити. Для запобігання такій поведінці використовуйте
роздільник списку аргументів `--`. Після того, як цей роздільник
буде проаналізовано PHP, всі наступні аргументи будуть передані в
скрипт незайманими.

# Ця команда не запустить цей код, але покаже інформацію про використання PHP
$ php -r 'var_dump($argv);' -h
Usage: php [options] [-f] <file> [args...]
[...]

# Ця команда передасть аргумент '-h' у скрипт, запобігши показу довідки PHP
$ php -r 'var_dump($argv);' ---h
array(2) {
[0]u003d>
string(1) "-"
[1]u003d>
string(2) "-h"
}

Однак, в Unix-системах є ще один спосіб використання PHP для
консольних скриптів. Можна написати скрипт, перший рядок якого буде
починатися з `#!/usr/bin/php` (або інший коректний шлях до бінарного
файлу PHP CLI). Після цього рядка можна помістити звичайний PHP-код,
укладений в теги PHP, що відкривають і закривають. Як тільки будуть
встановлені коректні атрибути запуску на файл (наприклад, **chmod+x
test**), скрипт може бути запущений як звичайний консольний або
perl-скрипт:

**Приклад #1 Запуск PHP-скрипту як консольного**

` #!/usr/bin/php<?phpvar_dump($argv);?> `

Припускаючи, що цей файл названий `test` і знаходиться в поточній
директорії, можна зробити таке:

$chmod +x test
$ ./test -h -- foo
array(4) {
[0]u003d>
string(6) "./test"
[1]u003d>
string(2) "-h"
[2]u003d>
string(2) "--"
[3]u003d>
string(3) "foo"
}

Як можна побачити, у цьому випадку не потрібно дбати про передачу
параметрів, що починаються з `-`.

PHP-файл, що виконується, може використовуватися для запуску PHP-скриптів
незалежно від веб-сервера. У разі роботи в Unix-подібній системі,
необхідно додати в перший рядок файлу `#!` (названий також
"shebang") щоб вказати, яка програма повинна запускати скрипт. На
Windows-платформи можна призначити обробник `php.exe` для файлів з
розширеннями `.php` або створити пакетний (.bat) файл для запуску
скриптів за допомогою PHP. Рядок, що додається на початку скрипту для
Unix-систем, що не впливає на їх роботу в ОС Windows, таким чином можна
створювати кросплатформні скрипти. Нижче наведено простий приклад
скрипта, що виконується з командного рядка:

**Приклад #2 Скрипт, призначений для запуску з командного рядка
(script.php)**

` #!/usr/bin/php<?phpif ($argc !u003d 2 || in_array($argv[1], array('--help', '-help', '-h', '-?') ))) {?>Це консольний PHP-скрипт, приймає один аргумент. Використання:  <?php echo $argv[0]; ?> <option>  <option> Будь-яке слово, яке ви хотіли би  надрукувати. Опції  --help, -help, -h,  або -? покажуть поточну довідкову інформацію.

У наведеному вище скрипті в першому рядку міститься shebang,
що вказує, що цей файл повинен запускатися PHP. Робота ведеться з
CLI-версія, тому не буде виведено жодного HTTP-заголовка.

Скрипт спочатку перевіряє наявність обов'язкового одного аргументу (у
доповнення до імені скрипта, який також підраховується). Якщо їх нема,
або якщо переданий аргумент був **--help**, **-help**, **-h** або
**-?**, виводиться довідкове повідомлення з використанням `$argv[0]`,
яке містить ім'я скрипта. Інакше просто
виводиться отриманий аргумент.

Для запуску наведеного прикладу в Unix-системі потрібно зробити його
виконуваним і просто виконати в консолі **script.php echothis** або
**script.php -h**. У Windows-системі можна створити пакетний файл:

**Приклад #3 Пакетний файл для запуску PHP-скрипту з командного рядка
(script.bat)**

`` shellcode
@echo OFF
"C:\php\php.exe" script.php %*
````

Припускаючи, що наведений вище скрипт називається `script.php`, а
повний шлях до CLI `php.exe` знаходиться в `C:\php\php.exe`, цей пакетний
файл запустить його з переданими параметрами: **script.bat echothis** або
**script.bat -h**.

Також можна ознайомитись з модулем [Readline](ref.readline.md) для
отримання додаткових функцій, які можна використовувати для
покращення консольного PHP-скрипту.

У Windows запуск PHP можна настроїти без необхідності вказувати
`C:\php\php.exe` або розширення `.php`. Докладніше ця тема описана в
розділ [Запуск PHP з командного рядка в Microsoft
Windows](install.windows.commandline.md).

> **Примітка**:
>
> У Windows рекомендується запускати PHP під актуальним обліковим записом
> користувача. Під час роботи в мережній службі деякі операції не будуть
> виконані, оскільки "порівняння імен облікових записів і
> ідентифікаторів безпеки не виконано.
