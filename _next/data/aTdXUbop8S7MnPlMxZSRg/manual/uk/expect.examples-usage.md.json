{"pageProps":{"page":{"slug":"expect.examples-usage.md","content":"## Приклади використання Expect\n\n**Приклад #1 Приклад використання Expect**\n\nУ цьому прикладі ми з'єднаємося з віддаленим хостом SSH, і надрукуємо час безперервної роботи сервера.\n\n```php\n<?php\nini_set(\"expect.loguser\", \"Off\");\n\n$stream = fopen(\"expect://ssh root@remotehost uptime\", \"r\");\n\n$cases = array (\n    array (0 => \"password:\", 1 => PASSWORD)\n);\n\nswitch (expect_expectl ($stream, $cases)) {\n    case PASSWORD:\n        fwrite ($stream, \"password\\n\");\n        break;\n\n    default:\n        die (\"Ошибка соединения с удалённым сервером!\\n\");\n}\n\nwhile ($line = fgets($stream)) {\n      print $line;\n}\nfclose ($stream);\n?>\n```\n\nУ наступному прикладі ми з'єднаємося з віддаленим сервером, дізнаємося про розрядність його операційної системи і запустимо оновлення зазначеного пакета.\n\n**Приклад #2 Ще один приклад використання Expect**\n\n```php\n<?php\nini_set(\"expect.timeout\", -1);\nini_set(\"expect.loguser\", \"Off\");\n\n$stream = expect_popen(\"ssh root@remotehost\");\n\nwhile (true) {\n    switch (expect_expectl ($stream, array (\n            array (\"password:\", PASSWORD), // SSH запрашивает пароль\n            array (\"yes/no)?\", YESNO), // SSH спрашивает, сохранять ли запись хоста\n            array (\"~$ \", SHELL, EXP_EXACT), // Мы получили доступ к коммандной оболочке!\n    ))) {\n        case PASSWORD:\n            fwrite ($stream, \"secret\\n\");\n            break;\n\n        case YESNO:\n            fwrite ($stream, \"yes\\n\");\n            break;\n\n        case SHELL:\n            fwrite ($stream, \"uname -a\\n\");\n            while (true) {\n                    switch (expect_expectl ($stream, array (\n                            array (\"~$ \", SHELL, EXP_EXACT), // Мы получили доступ к коммандной оболочке!\n                            array (\"^Linux.*$\", UNAME, EXP_REGEXP), // вывод uname -a\n                    ), $match)) {\n                        case UNAME:\n                            $uname .= $match[0];\n                            break;\n\n                        case SHELL:\n                            // Run update:\n                            if (strstr ($uname, \"x86_64\")) {\n                                    fwrite ($stream, \"rpm -Uhv http://mirrorsite/somepath/some_64bit.rpm\\n\");\n                            } else {\n                                    fwrite ($stream, \"rpm -Uhv http://mirrorsite/somepath/some_32bit.rpm\\n\");\n                            }\n                            fwrite ($stream, \"exit\\n\");\n                            break 2;\n\n                        case EXP_TIMEOUT:\n                        case EXP_EOF:\n                            break 2;\n\n                        default:\n                            die (\"Случилась ошибка!\\n\");\n                    }\n            }\n            break 2;\n\n        case EXP_TIMEOUT:\n        case EXP_EOF:\n            break 2;\n\n        default:\n            die (\"Случилась ошибка!\\n\");\n    }\n}\n\nfclose ($stream);\n?>\n```\n","title":"Приклади використання Expect","contentType":2,"navigation":[{"expect.examples.md":"« Приклади"},{"ref.expect.md":"Опції Expect »"},{"index.md":"PHP Manual"},{"expect.examples.md":"Приклади"}]}},"__N_SSG":true}