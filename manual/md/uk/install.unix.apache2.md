- [« Установка для Unix-системи](install.unix.md)
- [Встановлення Nginx 1.4.x на Unix »](install.unix.nginx.md)

- [PHP Manual](index.md)
- [Установка для Unix-системи](install.unix.md)
- Apache 2.x на Unix системах

## Apache 2.x на Unix системах

Цей розділ описує інсталяцію PHP з Apache 2.x на Unix системах.

**Увага**

Ми не рекомендуємо використовувати потоковий MPM у промисловому середовищі разом
з Apache 2. Натомість, використовуйте prefork MPM, використовуваний по
замовчуванням в Apache 2.0 та 2.2. Детальну інформацію з цього питання ви
можете знайти у відповідному розділі FAQ [Apache2 та потоковий
MPM](faq.installation.md#faq.installation.apache2)

Найавторитетнішим джерелом інформації по Apache 2.x є
[» документація Apache](http://httpd.apache.org/docs/current/). Більше
Детальна інформація про налаштування під час встановлення може бути знайдена там.

Остання версія Apache Http Server може бути отримана на
[» сторінці завантаження Apache](http://httpd.apache.org/), а адреса
відповідної версії PHP було зазначено вище. Це короткий посібник
визначає лише базову установку Apache 2.x і PHP. Для отримання більш
детальну інформацію прочитайте [» документацію
Apache](http://httpd.apache.org/docs/current/). В інструкції нижче
опущені номери версій - замініть 'NN' на номер, що відповідає
завантаженої вами версії Apache.

На даний момент є дві версії Apache 2.x – 2.4 та 2.2. Хоча для вибору
кожної з них існують окремі доводи, 2.4 є найсвіжішою
та рекомендованою версією, якщо вас влаштовує такий вибір. Проте,
ці інструкції будуть працювати як для 2.4, так і для 2.2. Зверніть
увагу, що Apache httpd 2.2 офіційно більше не підтримується,
тому подальша технологія не буде продовжуватися, так само як і
приймати нові патчі.

1. Завантажте Apache HTTP server як було зазначено вище та розпакуйте його:

tar -xzf httpd-2.x.NN.tar.gz

2. Аналогічно, скачайте та розпакуйте вихідні коди PHP:

tar-xzf php-NN.tar.gz

3. Скомпілюйте та встановіть Apache. Більш детальну інформацію щодо
Складання Apache дивіться в його документації.

cd httpd-2_x_NN
./configure --enable-so
make
make install

4. Тепер ваш Apache 2.x.NN доступний як /usr/local/apache2,
налаштований за допомогою підвантажуваних модулів і стандартним
мульти-процесним модулем (MPM) prefork. Щоб протестувати
правильність установки використовуйте стандартну процедуру запуску
Apache, таку як:

/usr/local/apache2/bin/apachectl start

Потім зупиніть сервер, щоб налаштувати та встановити PHP:

/usr/local/apache2/bin/apachectl stop

5. Тепер ми конфігуруємо та зберемо PHP. Тут ви можете налаштувати
установку PHP за допомогою різних опцій, що вказують, наприклад,
які модулі потрібно увімкнути. Перегляньте виведення команди ./configure
--help щоб отримати повний список параметрів конфігурації. В нашому
прикладі ми конфігуруємо PHP дуже просто - за допомогою Apache і
MySQL.

Якщо ви збирали Apache з вихідних джерел, як було описано вище, то
використовуйте шлях до apxs як зазначено в наступному прикладі, інакше,
коригуйте цей шлях відповідно до вашої установки чином.
Врахуйте також, що деякі дистрибутиви apxs можуть мати ім'я
apxs2.

cd ../php-NN
./configure --with-apxs2u003d/usr/local/apache2/bin/apxs --with-pdo-mysql
make
make install

Якщо ви вирішите змінити параметри конфігурації після встановлення, вам
треба буде повторити лише три останні кроки (configure, make,
make install). Вам потрібно буде лише перезапустити Apache, щоб
нові модулі підвантажилися та почали працювати. Перекомпіляція Apache
для цього не потрібне.

Зверніть увагу, що якщо не вказано зворотне, то 'make install' встановить
так само PEAR, різні інструменти PHP – такі як phpize, версію
PHP для командного рядка (PHP CLI) та ін.

6. Налаштування вашого php.ini

cp php.ini-development /usr/local/lib/php.ini

Ймовірно, ви захочете змінити деякі налаштування у php.ini. Якщо
ви волієте тримати файл php.ini в іншому місці, використовуйте
параметр --with-config-file-pathu003d/some/path у кроці 5.

Якщо ж ви використовуєте php.ini-production, прочитайте його, щоб
знати які зміни у поведінці PHP це спричинить.

7. Відредагуйте httpd.conf, щоб Apache завантажував модуль PHP.
Шлях у правій частині інструкції LoadModule повинен вказувати на модуль
PHP. Команда make install може додати цю інструкцію
автоматично, але цього може і не статися, тому перевірте,
щоб переконатися.

Для PHP 8:

`` apache-confcode
LoadModule php_module modules/libphp.so
````

Для PHP 7:

`` apache-confcode
LoadModule php7_module modules/libphp7.so
````

8. Тепер слід налаштувати Apache, щоб він передавав файли з
деякими розширеннями на обробку модулю PHP. У нашому прикладі
зробимо це для файлів .php. Замість звичайного використання директиви
Apache AddType, ми хочемо уникнути інтерпретації як PHP потенційно
небезпечних завантажень та файлів на зразок exploit.php.jpg. За допомогою
даного прикладу можна вказати для інтерпретації PHP будь-які
розширення, просто додавши в кінець списку. Продемонструємо це
на розширенні .php.

`` apache-confcode
<FilesMatch \.php$>
SetHandler application/x-httpd-php
</FilesMatch>
````

Або, якщо ми хочемо додати розширення .php, .php2, .php3, .php4,
.php5, .php6 і .phtml, це можна записати так:

`` apache-confcode
<FilesMatch "\.ph(p[2-6]?|tml)$">
SetHandler application/x-httpd-php
</FilesMatch>
````

Щоб PHP відображав вміст .phps з підсвічуванням синтаксису,
потрібно внести відповідну директиву

`` apache-confcode
<FilesMatch "\.phps$">
SetHandler application/x-httpd-php-source
</FilesMatch>
````

Можна використовувати mod_rewrite для відображення будь-якого .php файлу з
підсвічуванням синтаксису, без потреби його перейменування в .phps:

`` apache-confcode
RewriteEngine On
RewriteRule (.*\.php)s$ $1 [Hu003dapplication/x-httpd-php-source]
````

Цей фільтр, що відображає вихідний код, повинен бути вимкнений у
промисловому використанні, оскільки він може відкрити
конфіденційну або іншу важливу інформацію, включену до вихідного
код.

9. Використовуйте стандартну процедуру запуску Apache, наприклад:

/usr/local/apache2/bin/apachectl start

АБО

service httpd restart

Якщо ви дотримувалися інструкцій вище, то на даному етапі повинні мати
запущений веб-сервер Apache2 з підтримкою PHP, як модуля SAPI.
Звичайно, для PHP та Apache доступно набагато більше параметрів
Зміни. Використовуйте **./configure --help** у відповідній папці
з вихідними кодами, щоб отримати повний список параметрів конфігурації.

Якщо ви хочете зібрати багатопотокову версію Apache, то при збиранні вам
слід вказати модуль MPM `worker` замість стандартного модуля MPM
`prefork`. Щоб зробити це, потрібно додати наступний аргумент до
./configure на кроці 3:

--with-mpmu003dworker

Не слід бездумно використовувати це налаштування, використовуйте його тільки
якщо ви знаєте всі наслідки цього рішення. Документація Apache з
[» модулям MPM](http://httpd.apache.org/docs/current/mpm.md)
значно глибше розкриває цю тему.

> **Примітка**:
>
> Якщо ви хочете використовувати залежний контент (content negotiation),
> прочитайте [Apache MultiViews
> FAQ](faq.installation.md#faq.installation.apache.multiviews).

> **Примітка**:
>
> Для складання багатопотокової версії Apache, ваша система повинна
> підтримувати потоки. Це так само передбачає складання PHP з
> експериментальної підтримки Zend Thread Safety (ZTS). І як
> наслідок, не всі модулі PHP можуть працювати. Рекомендується встановлення
> Apache з модулем MPM за замовчуванням – `prefork`.
