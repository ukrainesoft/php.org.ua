{"pageProps":{"page":{"slug":"function.win32-start-service-ctrl-dispatcher.md","content":"# win32\\_start\\_service\\_ctrl\\_dispatcher\n\n(PECL win32service >=0.1.0)\n\nwin32\\_start\\_service\\_ctrl\\_dispatcher — Додає до Диспетчера служб скрипт, який може бути використаний, як служба із заданим ім'ям\n\n### Опис\n\n```methodsynopsis\nwin32_start_service_ctrl_dispatcher(string $name, bool $gracefulMode = true): void\n```\n\nПри запуску за допомогою диспетчера служб, процесу служби необхідно звірятися з ним для моніторингу служби та зв'язку з нею. Ця функція виконує звіряння шляхом створення потоку для обробки низькорівневого зв'язку з диспетчером служб.\n\nПісля запуску процес служби має здійснити дві дії. Перше – повідомити диспетчеру служб, що службу запущено. Це здійснюється шляхом виклику [win32\\_set\\_service\\_status()](function.win32-set-service-status.md) з константою **`WIN32_SERVICE_RUNNING`**. Якщо вам необхідно виконати тривалий процес перед запуском служби, то ви можете використовувати константу **`WIN32_SERVICE_START_PENDING`**. Друге – продовжити звіряння з диспетчером служб, щоб визначити необхідність відключення. Це здійснюється за допомогою періодичного виклику [win32\\_get\\_last\\_control\\_message()](function.win32-get-last-control-message.md)и обработки кода возврата соответствующим образом.\n\n**Застереження**\n\nПочинаючи з версії 0.2.0, ця функція працює лише у \"cli\" SAPI. В інших SAPI функцію вимкнено.\n\n### Список параметрів\n\n`name`\n\nКоротке ім'я служби, як при додаванні за допомогою [win32\\_create\\_service()](function.win32-create-service.md)\n\n`gracefulMode`\n\n**`true`** для \"елегантного\" виходу. . **`false`** для виходу із помилкою. Дивіться [win32\\_set\\_service\\_exit\\_mode()](function.win32-set-service-exit-mode.md) для отримання детальної інформації.\n\n### Значення, що повертаються\n\nФункція не повертає значення після виконання.\n\nДо версії 1.0.0, Повертає **`WIN32_NO_ERROR`** у разі успішного завершення **`false`** якщо була виявлена ​​проблема з параметрами або [код помилки Win32](win32service.constants.errors.md) при невдалому завершенні роботи.\n\n### Помилки\n\nДо версії 1.0.0, якщо SAPI не є `\"cli\"`, дана функція викликає помилку рівня **`E_ERROR`**\n\nПочинаючи з версії 1.0.0, викидає виняток [Win32ServiceException](class.win32serviceexception.md), якщо SAPI не є `\"cli\"`\n\n### список змін\n\n| Версия | Опис |\n| --- | --- |\n| PECL win32service 1.0.0 | Викидає [ValueError](class.valueerror.md) при некоректних даних у параметрах, що раніше поверталося **`false`** |\n| PECL win32service 1.0.0 | Викидає [Win32ServiceException](class.win32serviceexception.md) у разі виникнення помилки, раніше повертався [Код помилки Win32](win32service.constants.errors.md) |\n| PECL win32service 1.0.0 | Тип значення, що повертається void, раніше був [mixed](language.types.declarations.md#language.types.declarations.mixed) |\n| PECL win32service 0.4.0 | Добавлен параметр`gracefulMode` |\n| PECL win32service 0.2.0 | Ця функція працює тільки з `\"cli\"`SAPI. |\n\n### Приклади\n\n**Приклад #1 Приклад**win32\\_start\\_service\\_ctrl\\_dispatcher()\\*\\*\\*\\*\n\nПеревірте, чи запущено сервіс у диспетчері служб.\n\n```php\n<?php\nif (!win32_start_service_ctrl_dispatcher('dummyphp')) {\n\n  die(\"Я, вероятно, не запущен в диспетчере служб\");\n}\n\nwin32_set_service_status(WIN32_SERVICE_START_PENDING);\n\n// Некий длительный процесс для обработки и запуска службы.\n\nwin32_set_service_status(WIN32_SERVICE_RUNNING);\n\nwhile (WIN32_SERVICE_CONTROL_STOP != win32_get_last_control_message()) {\n  # здесь производятся какие-то действия, не занимающие больше чем 30 секунд\n  # перед соответствующим переходом в цикл.\n}\n?>\n```\n\n### Дивіться також\n\n-   [win32\\_set\\_service\\_status()](function.win32-set-service-status.md) \\- Оновлює статус служби\n-   [win32\\_get\\_last\\_control\\_message()](function.win32-get-last-control-message.md) \\- Повертає останнє керуюче повідомлення, яке було надіслано цій службі\n-   [win32\\_set\\_service\\_exit\\_mode()](function.win32-set-service-exit-mode.md) \\- Визначає або повертає режим виходу для поточної запущеної служби\n-   [win32\\_set\\_service\\_exit\\_code()](function.win32-set-service-exit-code.md) \\- Визначає чи повертає код виходу для поточної запущеної служби\n-   [Коди Помилок Win32](win32service.constants.errors.md)\n","title":"win32\\_start\\_service\\_ctrl\\_dispatcher","contentType":2,"navigation":[{"function.win32-set-service-status.md":"« win32\\_set\\_service\\_status"},{"function.win32-start-service.md":"win32\\_start\\_service »"},{"index.md":"PHP Manual"},{"ref.win32service.md":"win32service"}]}},"__N_SSG":true}