{"pageProps":{"page":{"slug":"session.upload-progress.md","content":"# Відстеження прогресу завантаження файлів за допомогою сесій\n\nPHP може відслідковувати прогрес завантаження окремих файлів при включеній опції [session.upload\\_progress.enabled](session.configuration.md#ini.session.upload-progress.enabled). Ця інформація не дуже корисна для запиту, що безпосередньо закачує файл, проте протягом даного завантаження програма може посилати POST-запити на окрему сторінку (наприклад, за допомогою XHR) для перевірки статусу.\n\nПрогресс закачки будет доступен в суперглобальной переменной[$\\_SESSION](reserved.variables.session.md) під час виконання завантаження, а також при відправці POST-запитом змінної з ім'ям, що дорівнює значенню опції [session.upload\\_progress.name](session.configuration.md#ini.session.upload-progress.name). Як тільки PHP виявить такий POST-запит, він створить масив у [$\\_SESSION](reserved.variables.session.md), ключем якого буде конкатенація значень опцій [session.upload\\_progress.prefix](session.configuration.md#ini.session.upload-progress.prefix) і [session.upload\\_progress.name](session.configuration.md#ini.session.upload-progress.name). Ключ зазвичай можна отримати прочитавши ці опції, тобто:\n\n```php\n<?php\n$key = ini_get(\"session.upload_progress.prefix\") . $_POST[ini_get(\"session.upload_progress.name\")];\nvar_dump($_SESSION[$key]);\n?>\n```\n\nТакож можливо *скасувати* файл, що завантажується в даний момент, встановивши ключ `$_SESSION[$key][\"cancel_upload\"]`в значение\\*\\*`true`**. При завантаженні кількох файлів за один раз, ця дія скасує тільки поточний завантажуваний файл і всі наступні за ним, але не видалити вже завантажені до цього часу файли. Якщо закачування було скасовано цим способом, то елемент із ключем `error` у масиві [$\\_FILES](reserved.variables.files.md)будет установлен в**`UPLOAD_ERR_EXTENSION`\\*\\*\n\nОпції [session.upload\\_progress.freq](session.configuration.md#ini.session.upload-progress.freq) і [session.upload\\_progress.min\\_freq](session.configuration.md#ini.session.upload-progress.min-freq) контролюють частоту оновлення інформації про прогрес завантаження. При розумних значеннях цих двох налаштувань накладні витрати цієї функції практично невідчутні.\n\n**Приклад #1 Приклад**\n\nПриклад структури масиву прогресу завантаження.\n\n\" value=\"123\" />\n\nДані у сесії виглядатимуть приблизно так:\n\n```php\n<?php\n$_SESSION[\"upload_progress_123\"] = array(\n \"start_time\" => 1234567890,   // Время начала запроса\n \"content_length\" => 57343257, // Длина содержимого POST\n \"bytes_processed\" => 453489,  // Количество полученных и обработанных байт\n \"done\" => false,              // true при завершении обработки POST, успешно или нет\n \"files\" => array(\n  0 => array(\n   \"field_name\" => \"file1\",       // Имя поля <input/>\n   // Следующие 3 элемента аналогичны соответствующим элементам массива $_FILES\n   \"name\" => \"foo.avi\",\n   \"tmp_name\" => \"/tmp/phpxxxxxx\",\n   \"error\" => 0,\n   \"done\" => true,                // True, если обработчик POST закончил обработку данного файла\n   \"start_time\" => 1234567890,    // Время начала обработки этого файла\n   \"bytes_processed\" => 57343250, // Число полученных и обработанных байт этого файла\n  ),\n  // И ещё один файл, загрузка которого ещё не закончена в том же запросе\n  1 => array(\n   \"field_name\" => \"file2\",\n   \"name\" => \"bar.avi\",\n   \"tmp_name\" => NULL,\n   \"error\" => 0,\n   \"done\" => false,\n   \"start_time\" => 1234567899,\n   \"bytes_processed\" => 54554,\n  ),\n )\n);\n```\n\n**Увага**\n\nДля успішної роботи цієї функції необхідно вимкнути буферизацію запиту веб-сервером. Інакше PHP побачить завантаження файлу тільки тоді, коли завантаження повністю завершиться. Сервери, такі як Nginx, буферизують великі запити.\n\n**Застереження**\n\nІнформація про прогрес завантаження записується в сесію до того, як буде запущено якийсь скрипт. Тому зміна імені сесії за допомогою [ini\\_set()](function.ini-set.md) або [session\\_name()](function.session-name.md) видасть сесію без інформації про прогрес завантаження.\n","title":"Відстеження прогресу завантаження файлів за допомогою сесій","contentType":2,"navigation":[{"session.customhandler.md":"« Користувальницькі обробники сесії"},{"session.security.md":"Безпека сесій »"},{"index.md":"PHP Manual"},{"book.session.md":"Сесії"}]}},"__N_SSG":true}