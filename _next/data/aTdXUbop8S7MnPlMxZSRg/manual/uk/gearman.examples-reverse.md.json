{"pageProps":{"page":{"slug":"gearman.examples-reverse.md","content":"## Базове використання\n\n**Приклад #1 Базовий клієнт та обробник Gearman**\n\nЦей приклад демонструє базову роботу з клієнтом та його обробником. Клієнт відправляє рядок серверу завдань, обробник перевертає рядок та відсилає його назад. Операція виконується синхронно.\n\n```php\n<?php\n\n# Создание клиентского объекта\n$gmclient= new GearmanClient();\n\n# Указание сервера по умолчанию (localhost).\n$gmclient->addServer();\n\necho \"Sending job\\n\";\n\n# Отправка задания обратно\ndo\n{\n  $result = $gmclient->doNormal(\"reverse\", \"Hello!\");\n\n  # Проверка на различные возвращаемые пакеты и ошибки.\n  switch($gmclient->returnCode())\n  {\n    case GEARMAN_WORK_DATA:\n      echo \"Data: $result\\n\";\n      break;\n    case GEARMAN_WORK_STATUS:\n      list($numerator, $denominator)= $gmclient->doStatus();\n      echo \"Status: $numerator/$denominator complete\\n\";\n      break;\n    case GEARMAN_WORK_FAIL:\n      echo \"Failed\\n\";\n      exit;\n    case GEARMAN_SUCCESS:\n      echo \"Success: $result\\n\";\n      break;\n    default:\n      echo \"RET: \" . $gmclient->returnCode() . \"\\n\";\n      exit;\n  }\n}\nwhile($gmclient->returnCode() != GEARMAN_SUCCESS);\n\n?>\n```\n\n```php\n<?php\n\necho \"Starting\\n\";\n\n# Создание нового обработчика.\n$gmworker= new GearmanWorker();\n\n# Добавление сервера по умолчанию (localhost).\n$gmworker->addServer();\n\n# Регистрация функции \"reverse\" на сервере. Изменение функции обработчика на\n# \"reverse_fn_fast\" для более быстрой обработки без вывода.\n$gmworker->addFunction(\"reverse\", \"reverse_fn\");\n\nprint \"Waiting for job...\\n\";\nwhile($gmworker->work())\n{\n  if ($gmworker->returnCode() != GEARMAN_SUCCESS)\n  {\n    echo \"return_code: \" . $gmworker->returnCode() . \"\\n\";\n    break;\n  }\n}\n\nfunction reverse_fn($job)\n{\n  echo \"Received job: \" . $job->handle() . \"\\n\";\n\n  $workload = $job->workload();\n  $workload_size = $job->workloadSize();\n\n  echo \"Workload: $workload ($workload_size)\\n\";\n\n  # Этот цикл не является необходимым, но показывает как выполняется работа\n  for ($x= 0; $x < $workload_size; $x++)\n  {\n    echo \"Sending status: \" . ($x + 1) . \"/$workload_size complete\\n\";\n    $job->sendStatus($x, $workload_size);\n    sleep(1);\n  }\n\n  $result= strrev($workload);\n  echo \"Result: $result\\n\";\n\n  # Возвращаем, когда необходимо отправить результат обратно клиенту.\n  return $result;\n}\n\n# Гораздо более простая и менее подробная версия вышеприведённой функции выглядит так:\nfunction reverse_fn_fast($job)\n{\n  return strrev($job->workload());\n}\n\n?>\n```\n\nВисновок наведеного прикладу буде схожим на:\n\n```\n% php reverse_worker.php\nStarting\nWaiting for job...\nReceived job: H:foo.local:36\nWorkload: Hello! (6)\nSending status: 1/6 complete\nSending status: 2/6 complete\nSending status: 3/6 complete\nSending status: 4/6 complete\nSending status: 5/6 complete\nSending status: 6/6 complete\nResult: !olleH\n```\n\n```\n% php reverse_client.php\nStarting\nSending job\nStatus: 1/6 complete\nStatus: 2/6 complete\nStatus: 3/6 complete\nStatus: 4/6 complete\nStatus: 5/6 complete\nStatus: 6/6 complete\nSuccess: !olleH\n```\n","title":"Базове використання","contentType":2,"navigation":[{"gearman.examples.md":"« Приклади"},{"gearman.examples-reverse-bg.md":"Базовий клієнт та обробник Gearman, фоновий режим »"},{"index.md":"PHP Manual"},{"gearman.examples.md":"Приклади"}]}},"__N_SSG":true}