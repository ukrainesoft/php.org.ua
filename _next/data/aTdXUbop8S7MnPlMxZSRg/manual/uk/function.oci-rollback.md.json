{"pageProps":{"page":{"slug":"function.oci-rollback.md","content":"# oci\\_rollback\n\n(PHP 5, PHP 7, PHP 8, PECL OCI8 >= 1.1.0)\n\noci\\_rollback - Відкочує транзакції, що очікують обробки\n\n### Опис\n\n```methodsynopsis\noci_rollback(resource $connection): bool\n```\n\nЦя функція відкочує всі незафіксовані зміни з'єднання Oracle `connection` та завершує транзакцію. Вона також звільняє всі встановлені блокування. Видаляються всі Oracle `SAVEPOINTS`\n\nТранзакція починається при першому SQL-запиті, який змінює дані, який був запущений за допомогою функції [oci\\_execute()](function.oci-execute.md)и флага\\*\\*`OCI_NO_AUTO_COMMIT`\\*\\*. Наступні зміни даних від інших запитів також стають частиною цієї транзакції. Зміни, зроблені в транзакції, є тимчасовими доти, доки транзакція не буде зафіксована або буде здійснено її відкат. Інші користувачі бази даних не зможуть побачити зміни до їхньої фіксації.\n\nПри вставці або оновленні даних рекомендується використовувати транзакції для збереження цілісності даних та збільшення продуктивності.\n\n### Список параметрів\n\n`connection`\n\nІдентифікатор з'єднання Oracle, отриманий із функцій [oci\\_connect()](function.oci-connect.md) [oci\\_pconnect()](function.oci-pconnect.md) або [oci\\_new\\_connect()](function.oci-new-connect.md)\n\n### Значення, що повертаються\n\nПовертає **`true`** у разі успішного виконання або \\*\\*`false`\\*\\*в случае возникновения ошибки.\n\n### Приклади\n\n**Приклад #1 Приклад використання** oci\\_rollback()\\*\\*\\*\\*\n\n```php\n<?php\n\n// Вставка в несколько таблиц, откат изменений в случае возникновения ошибки\n\n$conn = oci_connect('hr', 'welcome', 'localhost/XE');\n\n$stid = oci_parse($conn, \"INSERT INTO mysalary (id, name) VALUES (1, 'Chris')\");\n\n// Флаг OCI_NO_AUTO_COMMIT сообщает Oracle не фиксировать запрос INSERT при его поступлении\n$r = oci_execute($stid, OCI_NO_AUTO_COMMIT);\nif (!$r) {\n    $e = oci_error($stid);\n    trigger_error(htmlentities($e['message']), E_USER_ERROR);\n}\n\n$stid = oci_parse($conn, 'INSERT INTO myschedule (startday) VALUES (12)');\n$r = oci_execute($stid, OCI_NO_AUTO_COMMIT);\nif (!$r) {\n    $e = oci_error($stid);\n    oci_rollback($conn);  // откат изменений из обоих таблиц\n    trigger_error(htmlentities($e['message']), E_USER_ERROR);\n}\n\n// Фиксация изменений в обоих таблицах\n$r = oci_commit($conn);\nif (!r) {\n    $e = oci_error($conn);\n    trigger_error(htmlentities($e['message']), E_USER_ERROR);\n}\n\n?>\n```\n\n**Приклад #2 Приклад использования отката до`SAVEPOINT`**\n\n```php\n<?php\n$stid = oci_parse($conn, 'UPDATE mytab SET id = 1111');\noci_execute($stid, OCI_NO_AUTO_COMMIT);\n\n// Создаём точку сохранения\n$stid = oci_parse($conn, 'SAVEPOINT mysavepoint');\noci_execute($stid, OCI_NO_AUTO_COMMIT);\n\n$stid = oci_parse($conn, 'UPDATE mytab SET id = 2222');\noci_execute($stid, OCI_NO_AUTO_COMMIT);\n\n// Явно используем SQL-запрос для отката к точке сохранения\n$stid = oci_parse($conn, 'ROLLBACK TO SAVEPOINT mysavepoint');\noci_execute($stid, OCI_NO_AUTO_COMMIT);\n\noci_commit($conn);  // mytab теперь содержит id равные 1111\n?>\n```\n\n### Примітки\n\n> **Зауваження** :\n> \n> Транзакції будуть автоматично відкачені під час закриття з'єднання або закінчення скрипту (залежно від того, що станеться раніше). Для фіксації транзакції необхідно явно викликати функцію [oci\\_commit()](function.oci-commit.md)\n> \n> Усі виклики [oci\\_execute()](function.oci-execute.md), явно або за замовчуванням, що використовують режим **`OCI_COMMIT_ON_SUCCESS`** зафіксують будь-яку попередню незафіксовану транзакцію.\n> \n> Будь-який DDL-запит Oracle, такий як `CREATE`или`DROP` автоматично фіксує будь-яку незафіксовану транзакцію.\n\n### Дивіться також\n\n-   [oci\\_commit()](function.oci-commit.md) \\- підтверджує транзакцію бази даних\n-   [oci\\_execute()](function.oci-execute.md) \\- Виконує підготовлений вираз\n","title":"oci\\_rollback","contentType":2,"navigation":[{"function.oci-result.md":"« oci\\_result"},{"function.oci-server-version.md":"oci\\_server\\_version »"},{"index.md":"PHP Manual"},{"ref.oci8.md":"OCI8 Функції"}]}},"__N_SSG":true}