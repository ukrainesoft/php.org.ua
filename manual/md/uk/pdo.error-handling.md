- [« Підготовлені запити та збережені
процедури](pdo.prepared-statements.md)
- [Великі об'єкти (LOB) »](pdo.lobs.md)

- [PHP Manual](index.md)
- [PDO](book.pdo.md)
- Помилки та їх обробка

# Помилки та їх обробка

PDO пропонує на вибір 3 стратегії обробки помилок залежно від
вашого стилю розробки програм.

- **`PDO::ERRMODE_SILENT`**

До PHP 8.0.0 це був режим за замовчуванням. PDO просто надасть вам
код помилки, який можна отримати методами
[PDO::errorCode()](pdo.errorcode.md) та
[PDO::errorInfo()](pdo.errorinfo.md). Ці методи реалізовані як у
об'єктах запитів, а також в об'єктах баз даних. Якщо помилка викликана
під час виконання коду об'єкта запиту, потрібно викликати метод
[PDOStatement::errorCode()](pdostatement.errorcode.md) або
[PDOStatement::errorInfo()](pdostatement.errorinfo.md) цього
об'єкт. Якщо помилка виклику об'єкта бази даних, потрібно викликати
аналогічні методи цього об'єкта.

- **`PDO::ERRMODE_WARNING`**

Крім встановлення коду помилки PDO видасть звичайне повідомлення E_WARNING.
Це може бути корисно при налагодженні або тестуванні, коли потрібно
бачити, що сталося, але не потрібно переривати роботу програми.

- **`PDO::ERRMODE_EXCEPTION`**

Починаючи з PHP 8.0.0 є стандартним режимом. Крім завдання
коду помилки PDO викидатиме виняток
[PDOException](class.pdoexception.md), властивості якого будуть
відображати код помилки та її опис. Цей режим також корисний при
налагодження, тому що відразу відомо, де в програмі сталася помилка.
Це дозволяє швидко локалізувати та вирішити проблему. (Не забувайте,
що якщо виняток є причиною завершення роботи скрипта, все
активні транзакції будуть відкачені.)

Режим виключень також корисний, тому що дає можливість
структурувати обробку помилок більш ретельно, ніж зі звичайними
попередженнями PHP, а також з меншою вкладеністю коду, ніж у
у разі роботи в тихому режимі з явною перевіркою значень, що повертаються
при кожному зверненні до бази даних.

Докладніше про виключення в PHP дивіться у розділі
[Винятки](language.exceptions.md).

PDO стандартизовано для роботи з рядковими кодами помилок SQL-92
SQLSTATE. Окремі драйвери PDO можуть ставити відповідності своїх
власних кодів кодів SQLSTATE. Метод
[PDO::errorCode()](pdo.errorcode.md) повертає одиночний код
SQLSTATE. Якщо потрібна специфічна інформація про помилку, PDO
пропонує метод [PDO::errorInfo()](pdo.errorinfo.md), який
повертає масив, що містить код SQLSTATE, код помилки драйвера, а також
рядок помилки драйвера.

**Приклад #1 Створення PDO об'єкта та встановлення режиму обробки помилок**

` <?php$dsn u003d 'mysql:dbnameu003dtestdb;hostu003d127.0.0.1';$user u003d 'dbuser';$password u003d 'dbpass';try {   $dbh u003d new PDO($dsn, $user password); $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);} catch (PDOException $e) {    echo 'Підключення не удалося: ' . $e->getMessage();}?> `

> **Примітка**:
>
> Метод [PDO::\_\_construct()](pdo.construct.md) завжди кидатиме
> виняток [PDOException](class.pdoexception.md), якщо з'єднання
> обірвалося, незалежно від встановленого значення
> **`PDO::ATTR_ERRMODE`**. Невпіймані винятки фатальні.

**Приклад #2 Створення екземпляра класу PDO та встановлення режиму обробки
помилок у конструкторі**

` <?php$dsn u003d 'mysql:dbnameu003dtest;hostu003d127.0.0.1';$user u003d 'googleguy';$password u003d 'googleguy';/*    Як раніше оберніть конструктор в блок , даже при установке ERRMODE в WARNING,    PDO::__construct всегда будет бросать исключение PDOException, если соединение оборвалось.*/try {    $dbh u003d new PDO($dsn, $user, $password, array(PDO::ATTR_ERRMODE u003d> PDO ::ERRMODE_WARNING));} catch (PDOException $e) {    echo 'Сполука оборвалось: ' . $e->getMessage(); exit.

Результат виконання цього прикладу:

Warning: PDO::query(): SQLSTATE[42S02]: Base table or view not found: 1146 Table 'test.wrongtable' doesn't exist in
/tmp/pdo_test.php on line 18
