- [« Робота з віддаленими файлами](features.remote-files.md)
- [Постійні з'єднання з базами даних
»](features.persistent-connections.md)

- [PHP Manual](index.md)
- [Відмінні риси](features.md)
- Робота зі з'єднаннями

# Робота зі з'єднаннями

Статус з'єднання зберігається внутрішніми механізмами PHP. Нижче
перераховані чотири можливі стани:

- 0 - NORMAL
- 1 - ABORTED
- 2 - TIMEOUT
- 3 - ABORTED та TIMEOUT

Під час штатного виконання PHP-скрипту встановлено статус NORMAL. В
у випадку, якщо віддалений клієнт розірвав з'єднання, статус змінюється на
ABORTED. Найчастіше від'єднання віддаленого клієнта відбувається за
натискання кнопки "Stop" у браузері. Якщо досягається
встановлений часовий ліміт (ознайомтеся з функцією
[set_time_limit()](function.set-time-limit.md)), буде встановлено
статус TIMEOUT.

Ви можете вирішувати, чи призводить відключення клієнта до завершення вашого
скрипт. Іноді буває необхідно, щоб скрипт виконався до кінця,
навіть якщо відсутній віддалений браузер, якому адресовано весь висновок.
За замовчуванням скрипт завершує роботу при відключенні клієнта. Це
поведінка може бути змінена за допомогою опції ignore_user_abort
конфігураційному файлі `php.ini`. Такого ж результату можна досягти,
вказавши `php_value ignore_user_abort` у конфігураційному файлі Apache
`httpd.conf` або скориставшись функцією
[ignore_user_abort()](function.ignore-user-abort.md). Якщо ви явно не
вказали на необхідність ігнорувати розрив з'єднання з клієнтом,
виконання скрипта буде перервано. Винятком є той випадок, якщо
використовуючи
[register_shutdown_function()](function.register-shutdown-function.md),
ви вказали спеціальну функцію, що викликається після завершення скрипта. В
такому випадку після того, як користувач натиснув кнопку "Stop" у своєму
браузері, при першій же спробі щось вивести PHP виявляє, що
з'єднання з клієнтом було втрачено і викликає завершальну функцію. Ця
функція також викликається при нормальному завершенні роботи вашого
скрипта, тому для того, щоб виконати деякі специфічні
дії при від'єднанні клієнта, вам знадобиться функція
[connection_aborted()](function.connection-aborted.md), яка
повертає **`true`**, якщо з'єднання було розірвано.

Виконання вашого скрипта також може бути перерване вбудованим таймером.
Стандартне обмеження часу становить 30 секунд, змінити його
можна за допомогою директиви **max_execution_time** у конфігураційному
файлі `php.ini`. Такого ж результату можна досягти, додавши
`php_value max_execution_time` у конфігураційний файл Apache
`httpd.conf` або скориставшись функцією
[set_time_limit()](function.set-time-limit.md). При досягненні
скриптом тимчасового ліміту виконання скрипту переривається та викликається
завершальна функція, якщо вона була вказана. Уточнити причину завершення
скрипта ви можете за допомогою функції
[connection_status()](function.connection-status.md), яка
повертає 2, якщо скрипт був перерваний після досягнення тимчасового
обмеження.

Єдине, що слід зауважити - що обидва статуси: ABORTED і
TIMEOUT - можуть бути встановлені одночасно. Це може статися в
тому випадку, якщо ви явно вказали на необхідність ігнорувати від'єднання
віддаленого клієнта. У такому разі після розриву з'єднання, зазначивши
цей факт, PHP продовжить виконання скрипту, і при досягненні тимчасового
ліміту буде викликана завершальна функція, якщо така була вказана. В
цій точці ви можете виявити, що
[connection_status()](function.connection-status.md) поверне значення
3.
