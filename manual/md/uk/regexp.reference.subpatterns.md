- [« Установка внутрішніх
опцій](regexp.reference.internal-options.md)
- [Повторення »](regexp.reference.repetition.md)

- [PHP Manual](index.md)
- [Опис синтаксису Perl-сумісних регулярних
виразів](reference.pcre.pattern.syntax.md)
- Підмаски

## Підмаски

Підмаски обмежуються круглими дужками, які можуть бути
вкладеними. Використання частини шаблону як підмаски має наступні
функції:

1. Локалізує набір альтернатив. Наприклад, шаблон
`cat(aract|erpillar|)` відповідає одному зі слів "cat",
"cataract" або "caterpillar". Без використання дужок він
відповідав би рядкам "cataract", "erpillar" або порожньому рядку.

2. Вказує на необхідність захоплення підрядка (як показано вище). В
тому випадку, якщо відповідність шаблону було знайдено, підрядок,
відповідна підмаску, також передається назад, що викликає при
за допомогою аргументу *ovector* функції **pcre_exec()**. Відкриваючі
круглі дужки нумеруються зліва направо (починаючи з одиниці) та їх
порядкові номери використовуються для нумерації відповідних
підрядок у результаті.

Наприклад, якщо рядок "The Red King" зіставляється з шаблоном
`the ((red|white) (king|queen))`, будуть захоплені підрядки "red king",
"red" та "king", з номерами 1, 2 та 3 відповідно.

Насправді виконання одночасно двох функцій не завжди зручне.
Бувають випадки, коли необхідне угруповання альтернатив без захоплення
рядки. У разі, якщо після відкритої круглої дужки слід "?:",
захоплення рядка немає, і поточна підмаска не нумерується. Наприклад,
якщо рядок "the white queen" зіставляється із шаблоном
`the ((?:red|white) (king|queen))`, будуть захоплені підрядки "white
queen" і "queen", і вони будуть пронумеровані 1 та 2 відповідно.
Максимальна кількість захоплюючих підмасок – 65535. Такі великі
шаблони можуть не скомпілюватися залежно від налаштувань libpcre.

У разі, якщо в незахоплюючій підмасці необхідно вказати
додаткові опції, можна скористатися зручним скороченням: символ,
позначає опцію, що встановлюється, поміщається між "?" та ":". Таким
Таким чином, наступні два шаблони

(?i:saturday|sunday)
(?:(?i)saturday|sunday)

відповідають тому самому набору рядків. Оскільки альтернативні
версії беруться ліворуч, і встановлені опції зберігають своє
дія до кінця підмаски, опція, встановлена в одній гілці, також
має ефект у всіх наступних гілках. Тому наведені вище
шаблони збігаються як із "SUNDAY", і з "Saturday".

Також можна використовувати іменовані підмаски за допомогою синтаксису
`(?P<name>pattern)`. Ця підмаска буде індексована в масиві
збігів крім звичайного числового індексу, ще й на ім'я name. Також
існують два альтернативні синтаксиси: `(?<name>pattern)` і
`(?'name'pattern)`.

Іноді буває необхідно мати кілька збігів, що виключають друг
друга. Зазвичай, кожен такий збіг отримує свій власний номер,
навіть якщо шаблон дозволяє збігтися лише з них. Синтаксис
`(?|` дозволяє обійти цю поведінку і прибрати номери, що дублюються.
Розглянемо наступне регулярне вираження, зіставлене з рядком
`Sunday`:

(?:(Sat)ur|(Sun))day

Тут `Sun` зберігається на посиланні 2, тоді як посилання 1 порожня. Якщо ж
збігається `Sat`, то вона буде поміщена в посилання 1, а посилання 2 взагалі не
буде існувати. Використання `(?|` у шаблоні вирішує цю проблему:

(?|(Sat)ur|(Sun))day

У цьому шаблоні обидві підмаски `Sun` та `Sat` будуть збережені під номером 1.
