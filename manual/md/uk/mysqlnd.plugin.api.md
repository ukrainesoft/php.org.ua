- [« Архітектура плагінів MySQL Native
Driver](mysqlnd.plugin.architecture.md)
- [Починаємо розробку плагіна mysqlnd
»](mysqlnd.plugin.developing.md)

- [PHP Manual](index.md)
- [API для плагінів до вбудованого драйвера MySQL](mysqlnd.plugin.md)
- API плагінів mysqlnd

## API плагінів mysqlnd

API плагінів `mysqlnd` надає такі функції:

- mysqlnd_plugin_register()

- mysqlnd_plugin_count()

- mysqlnd_plugin_get_plugin_connection_data()

- mysqlnd_plugin_get_plugin_result_data()

- mysqlnd_plugin_get_plugin_stmt_data()

- mysqlnd_plugin_get_plugin_net_data()

- mysqlnd_plugin_get_plugin_protocol_data()

- mysqlnd_conn_get_methods()

- mysqlnd_result_get_methods()

- mysqlnd_result_meta_get_methods()

- mysqlnd_stmt_get_methods()

- mysqlnd_net_get_methods()

- mysqlnd_protocol_get_methods()

Немає стандартних визначень того, що таке плагін та як він працює.

Часто зустрічаються в плагінах компоненти:

- Менеджер плагіна

- API плагіна

- Сервіси програми (або модулі)

- API сервісів програми (або API модулів)

Концепція плагіна `mysqlnd` експлуатує цю функціональність та, крім
того, тішить нас відкритою архітектурою.

*Немає заборон*

Плагін має повний доступ до всіх нутрощів `mysqlnd`. Ні
обмежень або заборон, пов'язаних із безпекою. Все що завгодно
можна переписати для реалізації дружніх чи ворожих алгоритмів,
так що рекомендується ставити плагіни лише з довірених джерел.

Як обговорювалося вище, плагіни можуть вільно використовувати покажчики. Ці
покажчики нічим не обмежені та можуть вказувати на дані іншого
плагіна. Найпростіша арифметична операція дозволить отримати доступ до
даним іншого плагіна.

Рекомендується писати співпрацюючі плагіни, які можуть працювати
спільно з іншими плагінами і завжди викликати батьківські методи.
Плагіни ніколи не повинні поводитися вороже до самого `mysqlnd`.

[TABLE]

**Проблеми: приклад співпраці та побудови ланцюжка**

У цьому сценарії завантажені плагіни кеша (`ext/mysqlnd_cache`) та
моніторингу (`ext/mysqlnd_monitor`). Обидва успадковують клас
`Connection::query()`. реєстрація плагінів відбувається на етапі `MINIT`
відповідно до описаної вище логіки. PHP, за замовчуванням, викликає
модулі за абеткою. Плагіни не знають один про одного і не
накладають будь-яких залежностей.

За умовчанням, плагіни викликають батьківський метод query зі своєї,
перевизначеної версії цього методу.

*Резюме по модулю PHP*

Повторення пройденого матеріалу з прикладу поведінки плагіна
`ext/mysqlnd_plugin`, що використовує API плагінів `mysqlnd` для PHP:

- Будь-яка програма PHP, що використовує MySQL намагається встановити
з'єднання за адресою 192.168.2.29

- Додаток використовує один із наступних модулів `ext/mysql`,
`ext/mysqli` або `PDO_MYSQL`. Всі три модулі використовують `mysqlnd`
для з'єднання з 192.168.2.29.

- `Mysqlnd` викликає метод з'єднання, який успадковується плагіном
`ext/mysqlnd_plugin`.

- `ext/mysqlnd_plugin` викликає зареєстрований користувачем метод
`proxy::connect()`.

- Цей метод підміняє IP адресу з'єднання з 192.168.2.29 на 127.0.0.1
і повертає встановлену `parent::connect()` з'єднання.

- `ext/mysqlnd_plugin` робить те саме, що і
`parent::connect(127.0.0.1)`, викликаючи оригінальний метод `mysqlnd`
для з'єднання.

- `ext/mysqlnd` встановлює з'єднання та повертає його
`ext/mysqlnd_plugin`. `ext/mysqlnd_plugin`, у свою чергу, передає
його далі.

- Без різниці, який модуль був використаний, він все одно отримає
з'єднання 127.0.0.1. Після цього модуль повертає це
з'єднання з додатком. Коло замкнулося.
