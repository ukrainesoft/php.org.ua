- [«PDO_INFORMIX DSN](ref.pdo-informix.connection.md)
- [PDO_MYSQL DSN »](ref.pdo-mysql.connection.md)

- [PHP Manual](index.md)
- [Драйвери PDO](pdo.drivers.md)
- Функції MySQL (PDO_MYSQL)

# Функції MySQL (PDO_MYSQL)

## Вступ

PDO_MYSQL – це драйвер, що реалізує інтерфейс [PHP Data Objects
(PDO)](intro.pdo.md) і надає доступ з PHP до баз даних
MySQL.

PDO_MYSQL за замовчуванням використовує емульовану підготовку.

*MySQL 8*

При запуску PHP до версії 7.1.16 або PHP 7.2 до 7.2.4 встановіть плагін
пароля за замовчуванням MySQL 8 Server в *mysql_native_password*, інакше ви
побачите помилки, схожі на *The server requested authentication method
unknown to the client \[caching_sha2_password\]*, навіть коли
*caching_sha2_password* не використовується.

Це пов'язано з тим, що MySQL 8 за замовчуванням використовує
caching_sha2_password, і плагін не розпізнається старими версіями PHP
(Mysqlnd). Натомість змініть це, встановивши
`default_authentication_pluginu003dmysql_native_password` в `my.cnf`. Плагін
*caching_sha2_password* буде підтримуватись у майбутній версії PHP. Бувай
А модуль [mysql_xdevapi](book.mysql-xdevapi.md) підтримує його.

**Увага**

Обережно: Деякі типи MySQL таблиць (механізми зберігання, двигунів) не
підтримують транзакції. При написанні коду з використанням транзакцій
стосовно таблиць, які їх не підтримують, MySQL буде
вважати, що транзакцію було розпочато успішно. Крім того, виконання
будь-якого DDL-запиту завершить усі відкриті транзакції, а також виконає
весь стек незавершених запитів.

> **Примітка**:
>
> Драйвер MySQL не підтримує належним чином
> **`PDO::PARAM_INPUT_OUTPUT`** через
> [PDOStatement::bindParam()](pdostatement.bindparam.md); хоча
> параметр можна використовувати, він не оновлюється (тобто фактичний висновок
> ігнорується).

## Установка

Зазвичай інсталяційні пакети Unix мають у своєму складі бінарні пакети
PHP. Незважаючи на те, що ці бінарні пакети зазвичай зібрані за допомогою
модуля MySQL, може знадобитися встановлення бібліотек модулів окремо.
Перевірте свій дистрибутив на наявність потрібних бібліотек через пакетний
менеджер.

Наприклад, на Ubuntu установка пакета `php5-mysql` встановлює модулі
ext/mysql, ext/mysqli, та PDO_MYSQL. На CentOS пакет `php-mysql` також
встановлює ці три модулі.

Також ви завжди можете скомпілювати необхідні модулі самостійно.
Складання PHP з вихідних кодів дозволить вам зібрати саме ті модулі
MySQL, які вам потрібні, а також вибрати потрібну клієнтську бібліотеку
для кожного модуля.

Використовуйте **--with-pdo-mysql\[u003dDIR\]** для встановлення модуля PDO MySQL,
де необов'язковий параметр `[u003dDIR]` вказує директорію, де
встановлена MySQL. За замовчуванням використовується бібліотека
[mysqlnd](book.mysqlnd.md). Більш детальний розбір на вибір
бібліотеки можна почитати у розділі "[Вибір бібліотеки
MySQL](mysqlinfo.library.choosing.md)".

Додатковий параметр **--with-mysql-sock\[u003dDIR\]** вказує
розташування unix-сокету MySQL для всіх MySQL модулів, включаючи
PDO_MYSQL Якщо параметр не вказано, пошук здійснюється в директоріях з
замовчуванням.

Додатковий параметр **--with-zlib-dir\[u003dDIR\]** використовується як
префікс шляху до libz.

$ ./configure --with-pdo-mysql --with-mysql-socku003d/var/mysql/mysql.sock

Підтримка SSL включається, використовуючи відповідну [константу
PDO_MySQL](ref.pdo-mysql.md#pdo-mysql.constants), яка еквівалентна
виклику [» API MySQL-функції mysql_ssl_set() в
C](http://dev.mysql.com/doc/mysql/en/mysql-ssl-set.md). До того ж SSL
не може бути включений за допомогою **PDO::setAttribute**, тому що
з'єднання вже існує. Дивіться документацію MySQL про [» підключення
до MySQL з
SSL](https://dev.mysql.com/doc/en/using-encrypted-connections.md).

## Зумовлені константи

Наведені нижче константи визначені даним драйвером і будуть
доступні лише у випадку, якщо PHP був зібраний за допомогою цього модуля,
або цей модуль був динамічно завантажений під час виконання.
До того ж, ці залежні від драйвера константи мають бути використані
тільки разом із цим драйвером. Використання атрибутів, специфічних
для деякого драйвера з іншим драйвером може спричинити несподіване
поведінка. Якщо ваш код виконується з кількома драйверами, можна
використовувати функцію [PDO::getAttribute()](pdo.getattribute.md) для
отримання атрибута **`PDO::ATTR_DRIVER_NAME`** для перевірки драйвера.

**`PDO::MYSQL_ATTR_USE_BUFFERED_QUERY`** (int)
Якщо цей атрибут встановлено в **`true`**
[PDOStatement](class.pdostatement.md), MySQL-драйвер буде
використовувати буферизовані версії API MySQL. Якщо ви пишете переносимий
на інші бібліотеки код, ви повинні використовувати
[PDOStatement::fetchAll()](pdostatement.fetchall.md).

**Приклад #1 Буферизація запитів у MySQL**

` <?phpif ($db->getAttribute(PDO::ATTR_DRIVER_NAME) u003du003d 'mysql') {   $stmt u003d$$db->prepare('select *fromfou': ;} else {    die("додаток працює тільки з mysql; Слід використовувати \$stmt->fetchAll() замість цього");}?> `

**`PDO::MYSQL_ATTR_LOCAL_INFILE`** (int)
Включити `LOAD LOCAL INFILE`.

Зверніть увагу, що ця константа може бути використана тільки в
масиві `driver_options` при створенні дескриптора нової бази даних.

**`PDO::MYSQL_ATTR_LOCAL_INFILE_DIRECTORY`** (string)
Дозволяє обмежити завантаження LOCAL DATA файлами, розташованими в
вказаному каталозі. Доступно з версії PHP 8.1.0.

Зверніть увагу, що ця константа може використовуватися тільки в
масиві `driver_options` при створенні нового дескриптора бази даних.

**`PDO::MYSQL_ATTR_INIT_COMMAND`** (string)
Команда, яку потрібно виконати при підключенні до MySQL-сервера.
Також буде автоматично виконано під час перепідключення.

Зверніть увагу, що ця константа може бути використана тільки в
масиві `driver_options` при створенні дескриптора нової бази даних.

**`PDO::MYSQL_ATTR_READ_DEFAULT_FILE`** (int)
Читання іменованих параметрів із файлу `my.cnf`. Ця опція недоступна,
якщо використовується mysqlnd, тому що mysqlnd не читає файли
Зміни MySQL.

**`PDO::MYSQL_ATTR_READ_DEFAULT_GROUP`** (int)
Читання іменованої групи параметрів із файлу `my.cnf` або з файлу,
визначеного у константі **`MYSQL_READ_DEFAULT_FILE`**. Ця опція
недоступна, якщо використовується mysqlnd, тому що mysqlnd не читає
файли конфігурації MySQL.

**`PDO::MYSQL_ATTR_MAX_BUFFER_SIZE`** (int)
Максимальний розмір буфера. За промовчанням дорівнює 1 Мб. Ця константа не
підтримується при компіляції разом із mysqlnd.

**`PDO::MYSQL_ATTR_DIRECT_QUERY`** (int)
Виконувати прямі запити, не використовувати підготовлені конструкції.

**`PDO::MYSQL_ATTR_FOUND_ROWS`** (int)
Повертає кількість знайдених (збіглих) рядків, а не кількість
змінених рядків.

**`PDO::MYSQL_ATTR_IGNORE_SPACE`** (int)
Дозволяє прогалини після імен функцій. Робить усі імена функцій
зарезервованими словами.

**`PDO::MYSQL_ATTR_COMPRESS`** (int)
Увімкнути стиснення мережного з'єднання.

**`PDO::MYSQL_ATTR_SSL_CA`** (int)
Шлях до файлу SSL-сертифіката.

**`PDO::MYSQL_ATTR_SSL_CAPATH`** (int)
Шлях до директорії, що містить SSL-сертифікати довірених центрів
(CA), що зберігаються у форматі PEM.

**`PDO::MYSQL_ATTR_SSL_CERT`** (int)
Шлях до файлу із SSL-сертифікатом.

**`PDO::MYSQL_ATTR_SSL_CIPHER`** (int)
Список з одного або більше допустимих шифрів для використання в
SSL-шифрування у форматі, який розуміє OpenSSL. Наприклад:
`DHE-RSA-AES256-SHA:AES128-SHA`

**`PDO::MYSQL_ATTR_SSL_KEY`** (int)
Шлях до файлу із ключем SSL.

**`PDO::MYSQL_ATTR_SSL_VERIFY_SERVER_CERT`** (int)
Надає спосіб відключення перевірки SSL-сертифіката сервера.

Існує, починаючи з PHP 7.0.18 та PHP 7.1.4.

**`PDO::MYSQL_ATTR_MULTI_STATEMENTS`** (int)
Якщо встановлено як **`false`**, забороняє запуск множинних
запитів як для [PDO::prepare()](pdo.prepare.md), так і для
[PDO::query()](pdo.query.md).

Зверніть увагу, що ця константа може бути використана тільки в
масиві `driver_options` при створенні нового дескриптора БД.

## Налаштування під час виконання

Поведінка цих функцій залежить від установок `php.ini`.

| Ім'я За замовчуванням | Місце зміни |
|------------------------------------------------- ----------------------------|-------------------|- ----------------|
| [pdo_mysql.default_socket](ref.pdo-mysql.md#ini.pdo-mysql.default-socket) | "/tmp/mysql.sock" | PHP_INI_SYSTEM |
| [pdo_mysql.debug](ref.pdo-mysql.md#ini.pdo-mysql.debug) | NULL | PHP_INI_SYSTEM |

**Опції конфігурації PDO_MYSQL**

Для детального опису констант PHP_INI\_\*, зверніться до розділу [Де
можуть бути встановлені параметри
конфігурації] (configuration.changes.modes.md).

Коротке пояснення конфігураційних директив.

`pdo_mysql.default_socket` string
Встановлює сокет домену UNIX. Цю опцію необхідно вказати під час
компіляції, якщо сокет домену знайдено під час конфігурації. Ця
налаштування лише для Unix.

`pdo_mysql.debug` bool
Дозволяє налагодження для PDO_MYSQL. Ця установка доступна лише, якщо
PDO_MYSQL скомпільований з "mysqlnd" та в режимі налагодження PDO.

## Зміст

- [PDO_MYSQL DSN](ref.pdo-mysql.connection.md) — З'єднання з базою
даних MySQL
