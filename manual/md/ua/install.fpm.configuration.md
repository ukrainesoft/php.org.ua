- [« Установка](install.fpm.install.md)
- [Встановлення модулів PECL »](install.pecl.md)

- [PHP Manual](index.md)
- [Менеджер процесів FastCGI (FPM)](install.fpm.md)
-   Налаштування

## Налаштування

FPM використовує синтаксис `php.ini` для свого конфігураційного файлу
`php-fpm.conf` та файлів конфігурації пулів.

### Список глобальних директив `php-fpm.conf`

`pid` string
Шлях до файлу PID. Типово: none.

`error_log` string
Шлях до файлу журналу помилок. За замовчуванням:
`#INSTALL_PREFIX#/log/php-fpm.log`. Якщо встановлено як "syslog",
логування буде проводитися в syslogd, а чи не в локальний файл.

`log_level` string
Рівень журналу помилок. Можливі значення: alert, error,
warning, notice, debug. Типово: notice.

`log_limit` int
Обмежити журналування для журнальних ліній, що дозволяє
записувати повідомлення довжиною понад 1024 символи без упаковки (wrapping).
Стандартне значення: 1024. Доступно з PHP 7.3.0.

`log_buffering` bool
Експериментальне журналування без додаткової буферизації.
Значення за замовчуванням: yes. Доступно з PHP 7.3.0.

`syslog.facility` string
Використовується для вказівки, який тип програм логуватиме
повідомлення. Типово: daemon.

`syslog.ident` string
Передує будь-якому повідомленню. Якщо у вас запущено кілька екземплярів
FPM, ви можете змінити значення за промовчанням на те, що вам
необхідно. Типово: php-fpm.

`emergency_restart_threshold` int
При цьому числі робочих процесів, завершених з SIGSEGV або SIGBUS за
проміжок часу, встановлений `emergency_restart_interval` FPM буде
перезавантажено. Значення 0 означає 'Off' (вимкнено). Типово: 0
(Off).

`emergency_restart_interval` [mixed](language.types.declarations.md#language.types.declarations.mixed)
Інтервал часу, який використовується `emergency_restart_interval`, щоб
визначити, коли FPM буде м'яко перезавантажено. Це корисно для
уникнення випадкових пошкоджень загальної пам'яті прискорювача (accelerator).
Доступні одиниці вимірювання: s(секунди), m(хвилини), h(години), або d(дні).
Одиниця виміру за замовчуванням: секунди. Значення за замовчуванням: 0 (Off).

`process_control_timeout` [mixed](language.types.declarations.md#language.types.declarations.mixed)
Час, протягом якого дочірні процеси чекають на відповідь на сигнали
майстер-процесу. Доступні одиниці вимірювання: s(секунди), m(хвилини),
h(годинник) або d(дні). Одиниця виміру за замовчуванням: секунди. Значення по
замовчуванням: 0.

`process.max` int
Максимальна кількість процесів може породити FPM. Це
зроблено для того, щоб контролювати глобальну кількість процесів,
коли використовується великий пул динамічного PM. Використовуйте з
обережністю. Типово: 0.

`process.priority` int
Вказує пріоритет (Unix nice(2)) майстер-процесу (тільки якщо
встановлено). Приймає значення від -19 (максимальний пріоритет) до
20(мінімальний) За замовчуванням: не встановлено.

`daemonize` bool
Запустити FPM у фоновому режимі. Встановіть значення 'no', щоб
запустити FPM у диспетчері для налагодження. Типово: yes.

`rlimit_files` int
Встановлює rlimit відкритих файлових дескрипторів для майстер-процесу.
Типово: Значення, визначене системою.

`rlimit_core` int
Встановлює rlimit максимального розміру ядра для майстер-процесу. за
замовчуванням 0.

`events.mechanism` string
Вказує, який механізм дії буде використаний FPM. Можливі
такі варіанти: select, pool, epoll, kqueue (BSD), port (Solaris). за
замовчуванням: не встановлено (автовизначення).

`systemd_interval` int
Якщо FPM зібраний з інтеграцією з systemd, вказує інтервал у секундах,
між оповіщеннями systemd про свій стан. Щоб вимкнути, встановіть 0.
Типово: 10.

### Список директив для пулів.

За допомогою FPM ви можете запускати кілька пулів процесів з різними
налаштуваннями. Ці параметри можуть бути передані пулу.

`listen` string
Адреса, яка прийматиме FastCGI-запити. Синтаксис:
'ip.add.re.ss:port', 'port', '/path/to/unix/socket'. Ця опція
обов'язкова для кожного пулу.

`listen.backlog` int
Встановлює listen(2) backlog. Значення `-1` означає максимум на
системах BSD. Значення за замовчуванням: `-1` (FreeBSD або OpenBSD) або
`511`. (Linux та інші платформи).

`listen.allowed_clients` string
Список адрес IPv4 або IPv6 клієнтів FastCGI, яким дозволено
підключення. Еквівалент змінної оточення FCGI_WEB_SERVER_ADDRS в
оригінальний PHP FastCGI (5.2.2+). Має сенс лише з TCP-сокетом.
Кожна адреса має бути розділена комою. Якщо залишити це значення
порожнім, з'єднання будуть прийматися з будь-якої IP-адреси. Значення по
замовчуванням: не задано (приймається будь-яка IP-адреса).

`listen.owner` string
Встановлює права для unix-сокету, якщо вони використовуються. У Linux для
дозволи з'єднань до веб-сервера, повинні бути встановлені права на
читання/запис. Багато заснованих на BSD-системах можливість
З'єднання не залежить від прав доступу. Значення за замовчуванням:
використовується користувач і група, від імені якої запущено сервер,
встановлений режим 0660.

`listen.group` string
Дивіться `listen.owner`.

`listen.mode` string
Дивіться `listen.owner`.

`listen.acl_users` string
Якщо підтримується список керування доступом (ACL) POSIX, ви можете
налаштувати його за допомогою цієї опції. Якщо поставлено, то `listen.owner` і
`listen.group` будуть проігноровані. Значення задається списком імен,
розділених комою.

`listen.acl_groups` string
Дивіться `listen.acl_users`. Значення задається списком імен груп,
розділених комою.

`user` string
Unix-користувач FPM-процесів. Цей параметр є обов'язковим.

`group` string
Unix-група FPM-процесів. Якщо не встановлено, група за замовчуванням
дорівнює імені користувача.

`pm` string
Вибір того, як менеджер процесів контролюватиме створення
дочірніх процесів. Можливі значення: 'static', 'ondemand', 'dynamic'.
Цей параметр є обов'язковим.

`static` - фіксована кількість дочірніх процесів (`pm.max_children`).

`ondemand` - кількість процесів, що породжуються на вимогу (коли
з'являються запити, на відміну від опції dynamic, коли стартує
певна кількість процесів, що дорівнює `pm.start_servers`, разом з
запуск служби.

`dynamic` - число дочірніх процесів, що динамічно змінюється, задається
на підставі наступних директив: `pm.max_children`, `pm.start_servers`,
`pm.min_spare_servers`, `pm.max_spare_servers`.

`pm.max_children` int
Число дочірніх процесів, які будуть створені, коли `pm` встановлено в
`static`, або максимальна кількість процесів, які будуть створені,
коли `pm` встановлений у `dynamic`. Цей параметр є обов'язковим.

Цей параметр встановлює обмеження кількості одночасних запитів,
які обслуговуватимуться. Еквівалент директиви ApacheMaxClients з
mpm_prefork та змінної оточення середовища `PHP_FCGI_CHILDREN` в
оригінальний PHP FastCGI.

`pm.start_servers` int
Число дочірніх процесів, створюваних під час запуску. Використовується, тільки
коли `pm` встановлений у `dynamic`. Значення за замовчуванням:
min_spare_servers+ (max_spare_servers – min_spare_servers)/2.

`pm.min_spare_servers` int
Бажана мінімальна кількість неактивних процесів сервера. Використовується,
тільки коли `pm` встановлено в `dynamic`. Крім того, це обов'язковий
параметр у цьому випадку.

`pm.max_spare_servers` int
Бажана максимальна кількість неактивних процесів сервера. Використовується,
тільки коли `pm` встановлений у `dynamic`. Крім того, це обов'язковий
параметр у цьому випадку.

`pm.max_spawn_rate` int
Кількість одночасних породжень дочірніх процесів. Використовується
тільки тоді, коли у параметра `pm` встановлено значення `dynamic`.
Значення за замовчуванням: 32

`pm.process_idle_timeout` [mixed](language.types.declarations.md#language.types.declarations.mixed)
Число секунд, після закінчення яких процес, що простоює, буде завершений.
Використовується лише якщо `pm` встановлено як `ondemand`. Допустимі
одиниці: s(econds)(за замовчуванням), m(inutes), h(ours) або d(ays). за
замовчуванням: 10s.

`pm.max_requests` int
Число запитів дочірнього процесу, після якого процес буде
перезапущено. Це корисно для запобігання витоку пам'яті під час використання
сторонніх бібліотек. Для нескінченної обробки запитів вкажіть '0'.
Еквівалент `PHP_FCGI_MAX_REQUESTS`. Значення за промовчанням: 0.

`pm.status_listen` string
Адреса, за якою прийматиметься запит стану FastCGI. Створює
новий невидимий пул, який може самостійно обробляти запити.
Корисно, якщо основний пул зайнятий запитами, що довго виконуються, так як
все ще можна отримати [сторінку стану FPM](fpm.status.md) до
завершення тривалих запитів. Синтаксис такий самий, як і для
директиви [listen](install.fpm.configuration.md#listen). Значення по
замовчуванням: none.

`pm.status_path` string
Посилання, за яким можна переглянути [сторінку стану
FPM] (fpm.status.md). Значення має починатися зі сліша (/). Якщо
значення не встановлено, сторінка статусу не відображатиметься.
Значення за замовчуванням: none.

`ping.path` string
Посилання на Ping-сторінку моніторингу FPM. Якщо значення не встановлено,
ping-сторінка не відображатиметься. Може бути використаний для
тестування ззовні, щоб переконатися, що FPM живий та відповідає. Зверніть
увагу, що значення має починатися з косої межі (/).

`ping.response` string
Ця директива може бути використана для налаштування відповіді на
ping-запит. Відповідь формується як text/plain з кодом відповіді 200.
Значення за замовчуванням pong.

`process.priority` int
Задає пріоритет nice(2) для працюючого процесу (тільки якщо заданий).
Значення від -19 (найвищий пріоритет) до 20 (найнижчий). Значення по
замовчуванням: не встановлено.

`process.dumpable` bool
Встановити прапор процесу dumpable (PR_SET_DUMPABLE prctl), навіть якщо the
користувач процесу або група відрізняється від користувача
майстер-процесу. Це дозволяє створювати дамп ядра процесу та виконати
ptrace процесу для користувача пулу. Значення за промовчанням: no.
Доступно з PHP 7.0.29, 7.1.17 та 7.2.5.

`prefix` string
Задає префікс для обчислення колії

`request_terminate_timeout` [mixed](language.types.declarations.md#language.types.declarations.mixed)
Час очікування обслуговування одного запиту, після чого робочий процес
буде завершено. Цей варіант слід використовувати, коли опція
'max_execution_time' у php.ini не зупиняє виконання скрипту за
якихось причин. Значення '0' означає 'вимкнено'. Доступні одиниці
вимірювання: s(econds), m(inutes), h(ours) або d(ays). Значення по
замовчуванням: 0.

`request_terminate_timeout_track_finished` bool
Час очікування, встановлений за допомогою
[request_terminate_timeout](install.fpm.configuration.md#request-terminate-timeout),
не включається після
[fastcgi_finish_request](function.fastcgi-finish-request.md) або коли
програма завершена та викликаються внутрішні функції завершення роботи.
Ця директива дозволить беззастережно застосовувати обмеження часу.
очікування навіть у таких випадках. Значення за замовчуванням: ні, починаючи з
Версія PHP 7.3.0.

`request_slowlog_timeout` [mixed](language.types.declarations.md#language.types.declarations.mixed)
Час очікування обслуговування одного запиту, після чого PHP backtrace
буде збережено у файл 'slowlog'. Значення '0' означає 'вимкнено'.
Доступні одиниці вимірювання: s(econds), m(inutes), h(ours) або d(ays).
Значення за промовчанням: 0.

`request_slowlog_trace_depth` int
Глибина трасування стека журналу slowlog. Значення за замовчуванням: 20,
починаючи з PHP 7.2.0.

`slowlog` string
Лог файл для повільних запитів. Значення за замовчуванням:
`#INSTALL_PREFIX#/log/php-fpm.log.slow`.

`rlimit_files` int
Встановлює ліміт дескрипторів відкритих файлів rlimit для дочірніх
процесів у цьому пулі. Значення за замовчуванням: визначається значенням
системи.

`rlimit_core` int
Встановлює максимальну кількість використовуваних ядер rlimit для
дочірніх процесів у цьому пулі. Можливі значення: 'unlimited' або
ціле число більше або дорівнює 0. Значення за замовчуванням: визначається
значенням системи.

`chroot` string
Директорія chroot оточення у старті. Це значення має бути
визначено як абсолютний шлях. Якщо значення не встановлено, chroot не
використовується.

`chdir` string
Chdir змінює поточну директорію у старті. Це значення має бути
визначено як абсолютний шлях. Значення за замовчуванням: поточна
директорія або при використанні chroot.

`catch_workers_output` bool
Перенаправлення STDOUT і STDERR робочого процесу на головний лог помилок.
Якщо не встановлено, STDOUT і STDERR будуть перенаправлені в /dev/null
відповідно до специфікації FastCGI. Значення за промовчанням: no.

`decorate_workers_output` bool
Увімкніть оформлення виходу (output decoration) для виводу
worker-процесу коли опція
[catch_workers_output](install.fpm.configuration.md#catch-workers-output)
увімкнено. Значення за замовчуванням: yes. Доступно з PHP 7.3.0.

`clear_env` bool
Очищає оточення у worker-процесах FPM. Запобігає влученню
довільних змінних оточення в worker-процесах FPM, очищаючи
оточення у worker-процесах до того, як змінні оточення,
вказані в цій конфігурації пула будуть додані. Типово: Yes.

`security.limit_extensions` string
Обмежує модулі, які FPM аналізуватиме. Це може
запобігти помилкам конфігурації на стороні веб-сервера. Ви повинні
обмежити FPM тільки розширеннями .php для запобігання виконанню
PHP-коду зловмисниками іншими розширеннями. Типово: .php .phar

`apparmor_hat` string
Якщо AppArmor увімкнено, дозволяє змінити шапку. Значення за замовчуванням:
не встановлено

`access.log` string
Лог-файл доступу. Значення за замовчуванням: не встановлено

`access.format` string
Формат файлу лог-файлу доступу. Значення за замовчуванням:
``%R - %u %t \"%m %r\" %s'`:

| Заповнювач | Опис |
|-------------|------------------------|
| **`%C`** | %CPU |
| **`%d`** | тривалість µs |
| **`%e`** | fastcgi env |
| **`%f`** | скрипт |
| **`%l`** | довжина вмісту
| **`%m`** | метод |
| **`%M`** | пам'ять
| **`%n`** | назва пулу |
| **`%o`** | виведення заголовка
| **`%p`** | PID |
| **`%q`** | строк запиту |
| **`%Q`** | GLUE між %q та %r |
| **`%r`** | URI запиту |
| **`%R`** | віддалена IP-адреса |
| **`%s`** | статус |
| **`%T`** | час |
| **`%t`** | час |
| **`%u`** | віддалений користувач |

**Допустимі значення**

Можна передати додаткові змінні оточення та оновити налаштування
PHP для певного пулу. Для цього вам необхідно додати наступні
параметри в файл налаштування пулу.

**Приклад #1 Передача змінних оточення та налаштувань PHP пулу**

`` inicode
env[HOSTNAME] u003d $HOSTNAME
env[PATH] u003d /usr/local/bin:/usr/bin:/bin
env[TMP] u003d /tmp
env[TMPDIR] u003d /tmp
env[TEMP] u003d /tmp

php_admin_value[sendmail_path] u003d /usr/sbin/sendmail -t -i -f www@my.domain.com
php_flag[display_errors] u003d off
php_admin_value[error_log] u003d /var/log/fpm-php.www.log
php_admin_flag[log_errors] u003d on
php_admin_value[memory_limit] u003d 32M
````

Налаштування PHP, передані через `php_value` або `php_flag` перезапишуть
їх попередні значення. Будь ласка, зверніть увагу, що визначення
[disable_functions](ini.core.md#ini.disable-functions) або
[disable_classes](ini.core.md#ini.disable-classes) не будуть
перезаписувати раніше визначені в php.ini значення, а додадуть нові
значення.

Налаштування, визначені через `php_admin_value` та `php_admin_flag`, не
можуть бути перезаписані через [ini_set()](function.ini-set.md).

Установки PHP можна встановити через веб-сервер.

**Приклад #2 Встановлення налаштувань PHP у nginx.conf**

`` inicode
set $php_value "pcre.backtrack_limitu003d424242";
set $php_value "$php_value
 pcre.recursion_limitu003d99999";
fastcgi_param PHP_VALUE $php_value;

fastcgi_param PHP_ADMIN_VALUE "open_basediru003d/var/www/htdocs";
````

**Застереження**

Оскільки ці налаштування передаються в php-fpm як FastCGI-заголовки,
php-fpm не повинен бути прив'язаний до загальнодоступної адреси світу. В
в іншому випадку будь-який зможе змінити налаштування PHP. Дивіться також
[listen.allowed_clients](install.fpm.configuration.md#listen-allowed-clients).

> **Примітка**: Пули не є механізмом безпеки, тому що
> вони забезпечують повного поділу; наприклад всі пули будуть
> використовувати один екземпляр OPcache.
