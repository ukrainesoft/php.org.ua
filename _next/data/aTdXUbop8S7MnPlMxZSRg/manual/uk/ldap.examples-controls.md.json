{"pageProps":{"page":{"slug":"ldap.examples-controls.md","content":"## LDAP Controls\n\nНижче наведено кілька прикладів використання LDAP Controls з використанням PHP >= 7.3.0.\n\n**Приклад #1 Прив'язка до інформації policy**\n\n```php\n<?php\n\n$user   = 'cn=admin,dc=example,dc=com';\n$passwd = 'adminpassword';\n\n$ds = ldap_connect('ldap://localhost');\n\nif ($ds) {\n  $r = ldap_bind_ext($ds, $user, $passwd, [['oid' => LDAP_CONTROL_PASSWORDPOLICYREQUEST]]);\n\n  if (ldap_parse_result($ds, $r, $errcode, $matcheddn, $errmsg, $referrals, $ctrls)) {\n    if ($errcode != 0) {\n      die(\"Ошибки: $errmsg ($errcode)\");\n    }\n    if (isset($ctrls[LDAP_CONTROL_PASSWORDPOLICYRESPONSE])) {\n      $value = $ctrls[LDAP_CONTROL_PASSWORDPOLICYRESPONSE]['value'];\n      echo \"Истекает: \".$value['expire'].\" seconds\\n\";\n      echo \"Количество оставшихся аутентификаций: \".$value['grace'].\"\\n\";\n      if (isset($value['error'])) {\n        echo \"Код ошибки Policy: \".$value['error'];\n      }\n    }\n  }\n} else {\n  die(\"Невозможно подключиться к серверу LDAP\");\n}\n?>\n```\n\n**Приклад #2 Зміна опису, якщо воно не порожнє**\n\n```php\n<?php\n  // $link - это LDAP-соединение\n\n  $result = ldap_mod_replace_ext(\n    $link,\n    'o=test,dc=example,dc=com',\n    ['description' => 'New description'],\n    [\n      [\n        'oid'         => LDAP_CONTROL_ASSERT,\n        'iscritical'  => TRUE,\n        'value'       => ['filter' => '(!(description=*))']\n      ]\n    ]\n  );\n\n  // Затем используйте ldap_parse_result\n?>\n```\n\n**Приклад #3 Читання певних значень перед видаленням**\n\n```php\n<?php\n  // $link - это LDAP-соединение\n\n  $result = ldap_delete_ext(\n    $link,\n    'o=test,dc=example,dc=com',\n    [\n      [\n        'oid'         => LDAP_CONTROL_PRE_READ,\n        'iscritical'  => TRUE,\n        'value'       => ['attrs' => ['o', 'description']]\n      ]\n    ]\n  );\n\n  // Затем используйте ldap_parse_result\n?>\n```\n\n**Приклад #4 Видалення посилання**\n\n```php\n<?php\n  // $link - это LDAP-соединение\n\n  // Без управления он удалит ссылочный узел\n  // Обязательно настройте управление так, чтобы избежать этого.\n  $result = ldap_delete_ext(\n    $link,\n    'cn=reference,dc=example,dc=com',\n    [['oid' => LDAP_CONTROL_MANAGEDSAIT, 'iscritical' => TRUE]]\n  );\n\n  // Затем используйте ldap_parse_result\n?>\n```\n\n**Приклад #5 Використання пагінації для пошуку**\n\n```php\n<?php\n  // $link - это LDAP-соединение\n\n  $cookie = '';\n\n  do {\n    $result = ldap_search(\n      $link, 'dc=example,dc=base', '(cn=*)', ['cn'], 0, 0, 0, LDAP_DEREF_NEVER,\n      [['oid' => LDAP_CONTROL_PAGEDRESULTS, 'value' => ['size' => 2, 'cookie' => $cookie]]]\n    );\n    ldap_parse_result($link, $result, $errcode , $matcheddn , $errmsg , $referrals, $controls);\n    // Чтобы сохранить Приклад, короткие ошибки не проверяются\n    $entries = ldap_get_entries($link, $result);\n    foreach ($entries as $entry) {\n      echo \"cn: \".$entry['cn'][0].\"\\n\";\n    }\n    if (isset($controls[LDAP_CONTROL_PAGEDRESULTS]['value']['cookie'])) {\n      // Вам необходимо передать cookie с последнего вызова на следующий\n      $cookie = $controls[LDAP_CONTROL_PAGEDRESULTS]['value']['cookie'];\n    } else {\n      $cookie = '';\n    }\n    // Пустой cookie означает последнюю страницу\n  } while (strlen($cookie) > 0);\n?>\n```\n","title":"LDAP Controls","contentType":2,"navigation":[{"ldap.examples-basic.md":"« Базове використання"},{"ref.ldap.md":"Функції LDAP »"},{"index.md":"PHP Manual"},{"ldap.examples.md":"Приклади"}]}},"__N_SSG":true}