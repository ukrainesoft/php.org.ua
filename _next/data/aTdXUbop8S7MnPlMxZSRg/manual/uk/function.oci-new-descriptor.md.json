{"pageProps":{"page":{"slug":"function.oci-new-descriptor.md","content":"# oci\\_new\\_descriptor\n\n(PHP 5, PHP 7, PHP 8, PECL OCI8 >= 1.1.0)\n\noci\\_new\\_descriptor — Ініціалізує новий дескриптор об'єкта LOB чи FILE\n\n### Опис\n\n```methodsynopsis\noci_new_descriptor(resource $connection, int $type = OCI_DTYPE_LOB): ?OCILob\n```\n\nРезервує ресурси, необхідні зберігання дескриптора об'єкта чи LOB-локатора.\n\n### Список параметрів\n\n`connection`\n\nІдентифікатор з'єднання з сервером Oracle, який повертається функцією [oci\\_connect()](function.oci-connect.md) або [oci\\_pconnect()](function.oci-pconnect.md)\n\n`type`\n\nДопустимі значення параметра `type` **`OCI_DTYPE_FILE`** **`OCI_DTYPE_LOB`** і **`OCI_DTYPE_ROWID`**\n\n### Значення, що повертаються\n\nПовертає новий LOB або дескриптор FILE у разі успішного виконання або \\*\\*`null`\\*\\*в случае возникновения ошибки.\n\n### Приклади\n\n**Приклад #1 Приклад використання** oci\\_new\\_descriptor()\\*\\*\\*\\*\n\n```php\n<?php\n/* Приведённый скрипт разработан для использования с HTML формами.\n * Это подразумевает, что $user, $password, $table, $where, и $commitsize\n * получены из формы. Скрипт удаляет записи с использованием\n * ROWID и закрывает транзакцию после каждого\n * $commitsize записей. (Используйте осторожно, откат изменений невозможен)\n */\n$conn = oci_connect($user, $password);\n$stmt = oci_parse($conn, \"select rowid from $table $where\");\n$rowid = oci_new_descriptor($conn, OCI_D_ROWID);\noci_define_by_name($stmt, \"ROWID\", $rowid);\noci_execute($stmt);\nwhile (oci_fetch($stmt)) {\n    $nrows = oci_num_rows($stmt);\n    $delete = oci_parse($conn, \"delete from $table where ROWID = :rid\");\n    oci_bind_by_name($delete, \":rid\", $rowid, -1, OCI_B_ROWID);\n    oci_execute($delete);\n    echo \"$nrows\\n\";\n    if (($nrows % $commitsize) == 0) {\n        oci_commit($conn);\n    }\n}\n$nrows = oci_num_rows($stmt);\necho \"$nrows deleted...\\n\";\noci_free_statement($stmt);\noci_close($conn);\n?>\n```\n\n```php\n<?php\n    /* Данный скрипт реализует загрузку файлов в LOB-столбцы\n     * HTML-форма для скрипта выглядит Прикладно так:\n     * <form action=\"upload.php\" method=\"post\" enctype=\"multipart/form-data\">\n     * <input type=\"file\" name=\"lob_upload\" />\n     * ...\n     */\n  if (!isset($lob_upload) || $lob_upload == 'none'){\n?>\n<form action=\"upload.php\" method=\"post\" enctype=\"multipart/form-data\">\nЗагрузить файл: <input type=\"file\" name=\"lob_upload\" /><br />\n<input type=\"submit\" value=\"Загрузить\" /> - <input type=\"reset\" value=\"Сбросить\" />\n</form>\n<?php\n  } else {\n\n     // $lob_upload содержит временное имя загруженного файла\n\n     // смотрите также раздел особенностей загрузки файлов,\n     // если необходимо реализовать безопасную загрузку\n\n     $conn = oci_connect($user, $password);\n     $lob = oci_new_descriptor($conn, OCI_D_LOB);\n     $stmt = oci_parse($conn, \"insert into $table (id, the_blob)\n               values(my_seq.NEXTVAL, EMPTY_BLOB()) returning the_blob into :the_blob\");\n     oci_bind_by_name($stmt, ':the_blob', $lob, -1, OCI_B_BLOB);\n     oci_execute($stmt, OCI_DEFAULT);\n     if ($lob->savefile($lob_upload)){\n        oci_commit($conn);\n        echo \"Blob успешно загружен\\n\";\n     }else{\n        echo \"Не удалось загрузить Blob\\n\";\n     }\n     $lob->free();\n     oci_free_statement($stmt);\n     oci_close($conn);\n  }\n?>\n```\n\n**Приклад #2 Приклад використання** oci\\_new\\_descriptor()\\*\\*\\*\\*\n\n```php\n<?php\n/* Вызов хранимой процедуры PL/SQL, параметрами которой являются объекты CLOB\n * Приклад PL/SQL процедуры:\n *\n * PROCEDURE save_data\n *   Имя аргумента                    Тип                     In/Out По умолчанию?\n *   ------------------------------ ----------------------- ------ ------------\n *   KEY                            NUMBER(38)              IN\n *   DATA                           CLOB                    IN\n *\n */\n\n$conn = oci_connect($user, $password);\n$stmt = oci_parse($conn, \"begin save_data(:key, :data); end;\");\n$clob = oci_new_descriptor($conn, OCI_D_LOB);\noci_bind_by_name($stmt, ':key', $key);\noci_bind_by_name($stmt, ':data', $clob, -1, OCI_B_CLOB);\n$clob->write($data);\noci_execute($stmt, OCI_DEFAULT);\noci_commit($conn);\n$clob->free();\noci_free_statement($stmt);\n?>\n```\n\n### Дивіться також\n\n-   [oci\\_bind\\_by\\_name()](function.oci-bind-by-name.md) \\- Прикріплює змінну PHP до відповідної мітки у SQL-вираженні\n","title":"oci\\_new\\_descriptor","contentType":2,"navigation":[{"function.oci-new-cursor.md":"« oci\\_new\\_cursor"},{"function.oci-num-fields.md":"oci\\_num\\_fields »"},{"index.md":"PHP Manual"},{"ref.oci8.md":"OCI8 Функції"}]}},"__N_SSG":true}