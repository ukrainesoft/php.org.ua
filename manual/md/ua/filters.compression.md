- [« Перетворюючі фільтри](filters.convert.md)
- [Шифруючі фільтри »](filters.encryption.md)

- [PHP Manual](index.md)
- [Список доступних фільтрів](filters.md)
- компресійні фільтри

## Компресійні фільтри

В той час, як [Компресійні обгортки](wrappers.compression.md)
забезпечують спосіб створення gzip- та bz2-сумісних файлів у локальній
файлової системи, вони не надають загальних засобів для компресії в
мережевих потоках, як і не надають коштів для створення потоку без
компресії з подальшим перетворенням на компресований. Для цих цілей
до будь-яких потокових ресурсів у будь-який час можуть застосовуватися
компресійні фільтри.

> **Примітка**: Компресійні фільтри *не* генерують заголовки та
> закінчень, які використовують утиліти командного рядка, такі як
> `gzip`. Вони просто компресують (стискають) та декомпресують
> (розтискають) порції даних у потіку даних, що компресується.

## zlib.deflate та zlib.inflate

`zlib.deflate` (компресія) та `zlib.inflate` (декомпресія) є
реалізаціями методів стиснення, описаних у [» RFC
1951](http://www.faqs.org/rfcs/rfc1951). Фільтр `deflate` приймає три
аргументи, передані у вигляді асоціативного масиву. `level` визначає,
який рівень компресії використати (1-9). Підвищення цього значення
призведе до зменшення обсягів даних за рахунок збільшення часу
обробки. Існують також два спеціальні рівні компресії: 0 (для
відключення компресії) та -1 (внутрішнє значення за замовчуванням бібліотеки
zlib - на даний момент одно 6). `window` - це логарифм із основою
2 від розміру вікна діапазону стиснення. Високі значення (аж до 15 -
32768 байт) призводять до покращення компресії за рахунок зростання необхідної
пам'яті, у той час як низькі значення (аж до 9 - 512 байт)
призводять до погіршення компресії рахунок зменшення необхідної пам'яті.
Значенням аргументу `window` за замовчуванням на даний момент є
**`15`**. `memory` визначає масштаб пам'яті, що резервується. Допустимі
значення знаходяться в діапазоні від 1 (мінімальне резервування) до 9
(максимальне резервування). Таке резервування пам'яті впливає лише
на швидкість і не впливає на розмір даних, що генеруються.

> **Примітка**: Оскільки рівень компресії є найчастіше
> використовуваним аргументом, ви можете передати лише його як
> звичайного цілого числа (integer), замість передавати масив
> з одного елемента.

Компресійні фільтри zlib.\* доступні, якщо активовано підтримку
[zlib](ref.zlib.md).

**Приклад #1 `zlib.deflate` та `zlib.inflate`**

` <?php$params u003d array('level' u003d> 6, 'window' u003d> 15, 'memory' u003d> 9);$original_text u003d "This is a test.
This is only a test.
This is not an important string.
";echo "Оригінальний текст довжиною " . strlen($original_text) . " символів.
";$fp u003d fopen('test.deflated', 'w');stream_filter_append($fp, 'zlib.deflate', STREAM_FILTER_WRITE, $params);fwrite($fp, $original_text);fclose$ echo "Стиснутий файл розміром " . filesize('test.deflated') . " байт.
";echo "Оригінальний текст:
";/* Використання readfile і zlib.inflate для декомпресії на льоту */readfile('php://filter/zlib.inflate/resourceu003dtest.deflated');/* Генерує висновок:Оригінальний текст й| розміром 56 байт.Оригінальний текст:This is a test.This is only a test.This is not an important string. */?>

**Приклад #2 Спрощене використання `zlib.deflate`**

` <?php$original_text u003d "This is a test.
This is only a test.
This is not an important string.
";echo "Оригінальний текст довжиною " . strlen($original_text) . " символів.
";$fp u003d fopen('test.deflated', 'w');/* Тут "6" вказує рівень компресії 6 */stream_filter_append($fp, 'zlib.deflate', STREAM_FILTER_$ , $original_text);fclose($fp);echo "Стиснутий файл розміром " . filesize('test.deflated') . " байт.
";/* Генерує висновок:Оригінальний текст довжиною 70 символів.Стиснутий файл розміром 56 байт. */?> `

## bzip2.compress та bzip2.decompress

`bzip2.compress` і `bzip2.decompress` працюють так само, як і
фільтри zlib, описані вище. Фільтр `bzip2.compress` приймає два
аргументу у вигляді елементів асоціативного масиву: `blocks` є
цілим (integer) значенням в діапазоні від 1 до 9 і вказує на
кількість 100-кілобайтових блоків пам'яті для резервування як
робочого простору. `work` - це так само ціле (integer)
значення в діапазоні від 0 до 250, що визначає скільки зусиль потрібно
витратити на простий спосіб компресії перед перемиканням на повільний,
але найбільш надійний спосіб. Зміна цього параметра впливає лише на
швидкість компресії. Ні розмір стисненого результату, ні обсяг, що використовується
пам'яті не змінюються за допомогою цієї установки. Значення 0 вказує
бібліотеці bzip використовувати власне внутрішнє значення по
замовчуванням. Фільтр `bzip2.decompress` приймає лише один аргумент,
який може бути переданий або як звичайне boolean-значення, або як
елемент `small` асоціативного масиву. Коли `small` встановлений у
**`true`**, бібліотека bzip зробить декомпресію з мінімальною витратою
пам'яті рахунок зниження швидкості.

Компресійні фільтри bzip2.\* доступні, якщо активовано підтримку
[bz2](ref.bzip2.md).

**Приклад #3 `bzip2.compress` та `bzip2.decompress`**

` <?php$param u003d array('blocks' u003d> 9, 'work' u003d> 0);echo "Оригінальний файл розміром " . filesize('LICENSE') . "Байт.
";$fp u003dfopen('LICENSE.compressed', 'w');stream_filter_append($fp, 'bzip2.compress', STREAM_FILTER_WRITE, $param);fwrite($fp, file_get_contents('LICEN') $fp);echo "Стиснутий файл розміром " . filesize('LICENSE.compressed') . " байт.
";/* Генерує висновок:Оригінальний файл розміром 3288 байт.Стиснутий файл розміром 1488 байт. */?> `
