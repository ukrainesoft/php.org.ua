{"pageProps":{"page":{"slug":"parle.examples.parser.md","content":"## Приклад використання парсеру\n\n**Приклад #1 Простий калькулятор**\n\n```php\n<?php\n\nuse Parle\\{Parser, ParserException, Lexer, Token};\n\n$p = new Parser;\n$p->token(\"INTEGER\");\n$p->left(\"'+' '-' '*' '/'\");\n\n$p->push(\"start\", \"exp\");\n$prod_add = $p->push(\"exp\", \"exp '+' exp\");\n$prod_sub = $p->push(\"exp\", \"exp '-' exp\");\n$prod_mul = $p->push(\"exp\", \"exp '*' exp\");\n$prod_div = $p->push(\"exp\", \"exp '/' exp\");\n$p->push(\"exp\", \"INTEGER\"); /* Индекс производства не используется. */\n\n$p->build();\n\n$lex = new Lexer;\n$lex->push(\"[+]\", $p->tokenId(\"'+'\"));\n$lex->push(\"[-]\", $p->tokenId(\"'-'\"));\n$lex->push(\"[*]\", $p->tokenId(\"'*'\"));\n$lex->push(\"[/]\", $p->tokenId(\"'/'\"));\n$lex->push(\"\\\\d+\", $p->tokenId(\"INTEGER\"));\n$lex->push(\"\\\\s+\", Token::SKIP);\n\n$lex->build();\n\n$exp = array(\n    \"1 + 1\",\n    \"33 / 10\",\n    \"100 * 45\",\n    \"17 - 45\",\n);\n\nforeach ($exp as $in) {\n    if (!$p->validate($in, $lex)) {\n        throw new ParserException(\"Не удалось проверить ввод\");\n    }\n\n    $p->consume($in, $lex);\n\n    while (Parser::ACTION_ERROR != $p->action && Parser::ACTION_ACCEPT != $p->action) {\n        switch ($p->action) {\n            case Parser::ACTION_ERROR:\n                throw new ParserException(\"Parser error\");\n                break;\n            case Parser::ACTION_SHIFT:\n            case Parser::ACTION_GOTO:\n            case Parser::ACTION_ACCEPT:\n                break;\n            case Parser::ACTION_REDUCE:\n                switch ($p->reduceId) {\n                    case $prod_add:\n                        $l = $p->sigil(0);\n                        $r = $p->sigil(2);\n                        echo \"$l + $r = \" . ($l + $r) . \"\\n\";\n                        break;\n                    case $prod_sub:\n                        $l = $p->sigil(0);\n                        $r = $p->sigil(2);\n                        echo \"$l - $r = \" . ($l - $r) . \"\\n\";\n                        break;\n                    case $prod_mul:\n                        $l = $p->sigil(0);\n                        $r = $p->sigil(2);\n                        echo \"$l * $r = \" . ($l * $r) . \"\\n\";\n                        break;\n                    case $prod_div:\n                        $l = $p->sigil(0);\n                        $r = $p->sigil(2);\n                    echo \"$l / $r = \" . ($l / $r) . \"\\n\";\n                        break;\n            }\n            break;\n        }\n        $p->advance();\n    }\n}\n```\n\n**Приклад #2 Розібрати слова з речення**\n\n```php\n<?php\n\nuse Parle\\{Lexer, Token, Parser, ParserException};\n\n$p = new Parser;\n$p->token(\"WORD\");\n$p->push(\"START\", \"SENTENCE\");\n$p->push(\"SENTENCE\", \"WORDS\");\n$prod_word_0 = $p->push(\"WORDS\", \"WORDS WORD\");\n$prod_word_1 = $p->push(\"WORDS\", \"WORD\");\n$p->build();\n\n$lex = new Lexer;\n$lex->push(\"[^\\s]{-}[\\.,\\:\\;\\?]+\", $p->tokenId(\"WORD\"));\n$lex->push(\"[\\s\\.,\\:\\;\\?]+\", Token::SKIP);\n$lex->build();\n\n$in = \"Dis-moi où est ton papa?\";\n$p->consume($in, $lex);\ndo {\n    switch ($p->action) {\n    case Parser::ACTION_ERROR:\n        throw new ParserException(\"Error\");\n        break;\n    case Parser::ACTION_SHIFT:\n    case Parser::ACTION_GOTO:\n        /* var_dump($p->trace());*/\n        break;\n    case Parser::ACTION_REDUCE:\n        $rid = $p->reduceId();\n        if ($rid == $prod_word_1) {\n            var_dump($p->sigil(0));\n        } if ($rid == $prod_word_0) {\n            var_dump($p->sigil(1));\n        }\n        break;\n    }\n    $p->advance();\n} while (Parser::ACTION_ACCEPT != $p->action);\n```\n","title":"Приклад використання парсеру","contentType":2,"navigation":[{"parle.examples.lexer.md":"« Приклади використання лексера"},{"class.parle-lexer.md":"Parle\\\\Lexer »"},{"index.md":"PHP Manual"},{"parle.examples.md":"Приклади"}]}},"__N_SSG":true}