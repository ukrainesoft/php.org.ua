- [« preg_last_error](function.preg-last-error.md)
- [preg_match »] (function.preg-match.md)

- [PHP Manual](index.md)
- [Функції PCRE](ref.pcre.md)
- Виконує глобальний пошук шаблону у рядку

# preg_match_all

(PHP 4, PHP 5, PHP 7, PHP 8)

preg_match_all — Виконує глобальний пошук шаблону в рядку

### Опис

**preg_match_all**(
string `$pattern`,
string `$subject`,
array `&$matches` u003d **`null`**,
int `$flags` u003d 0,
int `$offset` u003d 0
): int\|false

Шукає в рядку `subject` всі збіги із шаблоном `pattern` і поміщає
результат у масив `matches` у порядку, що визначається комбінацією прапорів
`flags`.

Після знаходження першої відповідності наступні пошуки будуть
здійснюватися не з початку рядка, а від кінця останнього знайденого
входження.

### Список параметрів

`pattern`
Шуканий шаблон у вигляді рядка.

`subject`
Вхідний рядок.

`matches`
Масив відповідних значень, відсортований відповідно до параметра
`flags`.

`flags`
Може бути комбінацією наступних прапорів (необхідно розуміти, що
використання **`PREG_PATTERN_ORDER`** одночасно з
**`PREG_SET_ORDER`** безглуздо):

**`PREG_PATTERN_ORDER`**
Впорядковує результати так, що елемент $matches[0] містить масив
повних входжень шаблону, елемент `$matches[1]` містить масив
входжень першої підмаски і т.д.

` <?phppreg_match_all("|<[^>]+>(.*)</[^>]+>|U",    "<b>приклад: </b><div alignu003dleft>це тест</ div>",   $out, PREG_PATTERN_ORDER);echo $out[0][0] . ", " . $out[0][1] . "
";echo $out[1][0] . ", " . $out[1][1] . "
";?> `

Результат виконання цього прикладу:

<b>приклад: </b>, <div alignu003dleft>це тест</div>
приклад: , це тест

Таким чином, $out[0] містить масив повних входжень шаблону, а
$out[1] містить масив підрядків, що містяться в тегах.

Якщо шаблон містить іменовані підшаблони, `$matches` додатково
міститиме записи для ключів з іменами цих підшаблонів.

Якщо шаблон містить задубльовані іменовані підшаблони, лише
найправіший підшаблон буде збережений у $matches[NAME].

` <?phppreg_match_all(    '/(?J)(?<match>foo)|(?<match>bar)/',   'foo bar',   $matches,    PREG_PATTERN_ORDER);' ;?> `

Результат виконання цього прикладу:

Array
(
[0] u003d>
[1] u003d> bar
)

**`PREG_SET_ORDER`**
Впорядковує результати так, що елемент $matches[0] містить перший
набір входжень, елемент `$matches[1]` містить другий набір входжень,
і т.д.

` <?phppreg_match_all("|<[^>]+>(.*)</[^>]+>|U",    "<b>приклад: </b><div alignu003d\"left\"> це тест</div>",   $out, PREG_SET_ORDER);echo $out[0][0] . ", " . $out[0][1] . "
";echo $out[1][0] . ", " . $out[1][1] . "
";?> `

Результат виконання цього прикладу:

<b>приклад: </b>, приклад:
<div alignu003d"left">це тест</div>, це тест

**`PREG_OFFSET_CAPTURE`**
У випадку, якщо цей прапор вказаний, для кожного знайденого підрядку буде
вказано її позицію (в байтах) у вихідному рядку. Необхідно пам'ятати, що
цей прапор змінює формат повертається масиву `matches` в масив, кожен
елемент якого містить масив, що містить в індексі з номером `0`
знайдений підрядок, а зміщення цього підрядка в параметрі `subject` - в
індексі `1`.

` <?phppreg_match_all('/(foo)(bar)(baz)/', 'foobarbaz', $matches, PREG_OFFSET_CAPTURE);print_r($matches);?> `

Результат виконання цього прикладу:

Array
(
[0] u003d> Array
(
[0] u003d> Array
(
[0] u003d> foobarbaz
[1] u003d> 0
)

)

[1] u003d> Array
(
[0] u003d> Array
(
[0] u003d> foo
[1] u003d> 0
)

)

[2] u003d> Array
(
[0] u003d> Array
(
[0] u003d> bar
[1] u003d> 3
)

)

[3] u003d> Array
(
[0] u003d> Array
(
[0] u003d> baz
[1] u003d> 6
)

)

)

**`PREG_UNMATCHED_AS_NULL`**
Якщо цей прапор передано, несупадні підмаски будуть представлені
значеннями **`null`**; в іншому випадку вони відображаються у вигляді порожніх
рядків (string).

Якщо прапори не були вказані, використовується за замовчуванням
**`PREG_PATTERN_ORDER`**.

`offset`
Зазвичай пошук здійснюється ліворуч, з початку рядка.
Додатковий параметр `offset` може бути використаний для вказівки
альтернативної початкової позиції для пошуку.

> **Примітка**:
>
> Використання параметра `offset` не еквівалентне заміні порівнянної
> рядки виразом `substr($subject, $offset)` під час виклику функції
> **preg_match_all()**, оскільки шаблон `pattern` може містити такі
> умови як *^*, *$* чи *(?\<u003dx)*. Ви можете знайти відповідні
> приклади у описі функції [preg_match()](function.preg-match.md).

### Значення, що повертаються

Повертає кількість знайдених входжень шаблону (яка може бути і
нулем) або **`false`** у разі виникнення помилки.

### Помилки

Якщо переданий шаблон регулярного виразу не компілюється
допустиме регулярне вираження, видається помилка рівня **`E_WARNING`**.

### Список змін

| Версія | Опис |
|--------|---------------------------------------- ----------------------------------------------|
| 7.2.0 | Тепер константа **`PREG_UNMATCHED_AS_NULL`** підтримується для параметра `$flags`. |

### Приклади

**Приклад #1 Отримання всіх телефонних номерів із тексту.**

` <?phppreg_match_all("/\(?  (\d{3})?  \)?  (?(1) [\-\s] ) \d{3}-\d{4}/x",           | 555-1212 або 1-800-555-1212", $phones);?> `

**Приклад #2 Жадібний пошук збігів з HTML-тегами**

`<?php// Запис \2 є прикладом використання посилань на підмаски. так як використовуються подвійні лапки.$html u003d "<b>напівжирний текст</b><a hrefu003dhowdy.md>натисні</a>";preg_match_all("/(<([\w]+)[^> ]*>)(.*?)(<\/\2>)/", $html, $matches, PREG_SET_ORDER);foreach ($matches as $val) {   echo "збіг: " . $val[0] . "
";    echo "частина 1: " . $val[1] . "
";    echo "частина 2: " . $val[2] . "
";    echo "частина 3: " . $val[3] . "
";    echo "частина 4: " . $val[4] . "

";}?> `

Результат виконання цього прикладу:

збіг: <b>напівжирний текст</b>
частина 1: <b>
частина 2: b
частина 3: напівжирний текст
частина 4: </b>

matched: <a hrefu003dhody.md>натисніть</a>
частина 1: <a hrefu003dhowdy.md>
частина 2: a
частина 3: натисні
частина 4: </a>

**Приклад #3 Використання іменованих підмасок**

` <?php$str u003d <<<<FOOa: 1b: 2c: 3FOO;preg_match_all('/(?P<name>\w+): (?P<digit>\d+)/', $str, $matches) ;/* Альтернативний варіант */// preg_match_all('/(?<name>\w+): (?<digit>\d+)/', $str, $matches);print_r($matches);?> `

Результат виконання цього прикладу:

Array
(
[0] u003d> Array
(
[0] u003d> a: 1
[1] u003d> b: 2
[2] u003d> c: 3
)

[name] u003d> Array
(
[0] u003d> a
[1] u003d> b
[2] u003d> c
)

[1] u003d> Array
(
[0] u003d> a
[1] u003d> b
[2] u003d> c
)

[digit] u003d> Array
(
[0] u003d> 1
[1] u003d> 2
[2] u003d> 3
)

[2] u003d> Array
(
[0] u003d> 1
[1] u003d> 2
[2] u003d> 3
)

)

### Дивіться також

- [Регулярні висловлювання PCRE](pcre.pattern.md)
- [preg_quote()](function.preg-quote.md) - Екранує символи в
регулярних виразах
- [preg_match()](function.preg-match.md) - Виконує перевірку на
відповідність регулярному виразу
- [preg_replace()](function.preg-replace.md) - Пошук та
заміну за регулярним виразом
- [preg_split()](function.preg-split.md) - Розбиває рядок по
регулярному виразу
- [preg_last_error()](function.preg-last-error.md) - Повертає код
помилки виконання останнього регулярного вираження PCRE
