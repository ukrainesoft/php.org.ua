- [« Одноразові підмаски](regexp.reference.onlyonce.md)
- [Коментарі »](regexp.reference.comments.md)

- [PHP Manual](index.md)
- [Опис синтаксису Perl-сумісних регулярних
виразів](reference.pcre.pattern.syntax.md)
- Умовні підмаски

## Умовні підмаски

У PCRE реалізована можливість підпорядковувати шаблон умові чи вибирати з
двох умовних підмасок залежно від успіху зіставлення попередньої
підмаски. Умовні підмаски мають дві допустимі форми використання:

(?(condition)yes-pattern)
(? (condition) yes-pattern | no-pattern)

У разі успішного зіставлення умови condition, використовується
підмаска yes-pattern, інакше no-pattern (якщо він
присутній). Якщо вказано більше двох альтернатив, виникне помилка
час компіляції.

Умови бувають двох видів. Якщо між дужками укладені
цифри, умова буде виконуватися в тому випадку, якщо підмаска з
відповідним номером було успішно зіставлено. Розглянемо наступний
шаблон (він містить незначний пробіл для зручності читання,
мається на увазі використання модифікатора
[PCRE_EXTENDED](reference.pcre.pattern.modifiers.md)), розділивши його
для зручності на три смислові частини:

( \( )? [^()]+ (?(1) \) )

Перша частина відповідає опціональній відкритій дужці, і у випадку
якщо вона є, захоплює її як значення першої підмаски.
Наступна частина відповідає одному або більше символам, відмінним від
круглої дужки. Третя частина є умовною підмаскою, яка залежить від
результату зіставлення першої підмаски. У випадку, якщо на початку
оброблюваних даних була виявлена кругла дужка, що відкриває,
умова буде інтерпретована як істина, і, отже, для
успішного зіставлення третьої частини шаблону необхідна
кругла скобка. В іншому випадку, оскільки не вказана друга гілка
умовного шаблону, третина буде зіставлена з порожнім рядком.
Підсумовуючи все вищесказане, наведений шаблон збігається з
послідовністю не-дужок, можливо, укладеної в круглі дужки.

Якщо умовою є рядок `(R)`, воно буде виконано, якщо буде
здійснено рекурсивний виклик до шаблону або підмаски. На "найвищому
рівні" умова хибно.

Якщо умова не є послідовністю цифр або (R), вона повинна
бути твердженням. Це може бути позитивна або негативна
перевірка наступного чи попереднього тексту. Розглянемо цей шаблон,
знову містить незначні прогалини, з двома альтернативами на другий
рядку:

(?(?u003d[^a-z]*[a-z])
\d{2}-[a-z]{3}-\d{2} | \d{2}-\d{2}-\d{2} )

Наведено приклад із затверджувальною умовою щодо попереднього
тексту, який виконується для необов'язкової послідовності
не-літер з наступною літерою. Іншими словами, зазначена умова
перевіряє наявність хоча б однієї попередньої літери. У разі якщо
літера знайдена, виконується зіставлення з першою альтернативою,
в іншому випадку - з другою альтернативою. Наведений шаблон
відповідає рядкам двох видів: dd-aaa-dd або dd-dd-dd, де aaaa -
це букви, а dd – цифри.
