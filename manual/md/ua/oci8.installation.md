- [« Вимоги](oci8.requirements.md)
- [Тестування »](oci8.test.md)

- [PHP Manual](index.md)
- [Встановлення та налаштування](oci8.setup.md)
- Встановлення

## Установка

## Складання PHP спільно з OCI8

Перед збиранням OCI8 вивчіть попередній розділ
"[Вимоги](oci8.requirements.md)".

Перед стартом веб-сервера, OCI8 зазвичай потрібно кілька змінних
оточення Oracle (дивіться нижче) для виявлення бібліотек,
конфігураційних файлів та встановлення деяких базових властивостей, таких як
кодування, яке використовується бібліотеками Oracle. Ці змінні мають бути
встановлені *перед* запуском будь-якого PHP-процесу.

Бінарний файл PHP повинен використовувати ту ж, або свіжу основну
версію бібліотек Oracle, ніж ту, з якою він був зібраний. Наприклад, якщо
ви зібрали OCI8 з бібліотеками Oracle 19, то PHP також повинен працювати з
бібліотеками Oracle 19. Програми PHP можуть підключатися до інших
версіям Oracle Database, оскільки Oracle має клієнт-серверну
сумісність різних версій.

## Установка OCI8 з PECL

Модуль OCI8 може бути включений до поточної установки PHP як
автоматично, так і вручну за допомогою
[»PECL](https://pecl.php.net/package/oci8).

- Якщо ваш комп'ютер знаходиться за фаєрволом, встановіть проксі для
PEAR, наприклад:

pear config-set http_proxy http://my-proxy.example.com:80/

- Запустіть

pecl install oci8

Для PHP 7, використовуйте `pecl install oci8-2.2.0`

При запиті введіть значення $ORACLE_HOME або
`instantclient,/path/to/instant/client/lib`.

Зверніть увагу: Не вводьте ім'я змінної, такої як
`$ORACLE_HOME` або `$HOME` вона не буде розгорнута. Замість
цього введіть повний шлях. Наприклад
`/opt/oracle/product/19c/dbhome_1` або
`instantclient,/Users/myname/Downloads/instantclient_19_8`.

- Помилка `oci8_dtrace_gen.h: No such file or directory`
означає, що PHP було зібрано з підтримкою [DTrace Dynamic
Tracing] (features.dtrace.md). У такому разі встановлюйте так:

$ export PHP_DTRACEu003dyes
$ pecl install oci8

- Додайте в `php.ini` наступний рядок:

extensionu003doci8.so

Переконайтеся, що `oci8.so` встановлено в директорію, задану в
директиві [extension_dir](ini.core.md#ini.extension-dir) файлу
`php.ini`.

## Установка OCI8 із PECL за допомогою phpize

Якщо з якихось причин немає можливості скористатися командою
`pecl`, можна самостійно завантажити пакет із сайту
[»PECL](https://pecl.php.net/package/oci8). Наприклад `oci8-3.0.0.tgz`.

- Розархівуйте пакет:

tar-zxf oci8-3.0.0.tgz
cd oci8-3.0.0

- Підготуйте його:

phpize

- Конфігуруйте використовуючи `$ORACLE_HOME` або Instant Client

./configure -with-oci8u003dshared,$ORACLE_HOME

or

./configure -with-oci8u003dshared,instantclient,/path/to/instant/client/lib

- Проінсталюйте:

make install

- Помилка `oci8_dtrace_gen.h: No such file or directory` означає,
що PHP був зібраний за допомогою [DTrace Dynamic
Tracing] (features.dtrace.md). У такому разі перезапустіть
`configure` та `make`, попередньо встановивши змінну оточення:

$ export PHP_DTRACEu003dyes

- Додайте в `php.ini` наступний рядок:

extensionu003doci8.so

Переконайтеся, що `oci8.so` встановлено в директорію, задану в
директиві [extension_dir](ini.core.md#ini.extension-dir) файлу
`php.ini`.

## Установка OCI8 у вигляді модуля, що підвантажується (shared) під час складання PHP

Вказівка опції конфігурації `shared` дозволяє зібрати OCI8 у вигляді
динамічно підвантажується бібліотеки. Складання у вигляді модуля, що підвантажується.
дозволяє легко оновлювати OCI8 без перескладання PHP.

Зберіть OCI8 за допомогою однієї з наведених нижче опцій.

- При використанні безкоштовних бібліотек [» Oracle Instant
Client](https://www.oracle.com/database/technologies/instant-client.md):

./configure --with-oci8u003dshared,instantclient,/шлях/до/instant/client/lib

Якщо Instant Client 12.2 (або раніше) встановлено з
ZIP-архіву, не забудьте насамперед створити символічну
посилання на бібліотеку, наприклад, так:
`ln -s libclntsh.so.12.1 libclntsh.so`.

Якщо Oracle Instant Client було встановлено за допомогою RPM, команда
конфігурації виглядатиме так:

./configure --with-oci8u003dshared,instantclient,/usr/lib/oracle/<version>/client/lib

Наприклад,
**--with-oci8u003dshared,instantclient,/usr/lib/oracle/19.9/client/lib**

Врахуйте, що підтримка Oracle Instant Client з'явилася лише починаючи
з версій PHP 4.3.11 та 5.0.4 і раніше використовувалася з опцією
**--with-oci8-instant-client**.

- При використанні бази даних Oracle database або повної установки
Oracle Client:

./configure --with-oci8u003dshared,$ORACLE_HOME

Переконайтеся, що користувач, під яким запущено веб-сервер,
(`nobody`, `www`) має доступ до бібліотек, файлів ініціалізації та
`tnsnames.ora` (якщо використовується) у папці `$ORACLE_HOME`. При
використання Oracle 10*g*R2, може знадобитися запуск утиліти
`$ORACLE_HOME/install/changePerm.sh` для отримання доступу до цієї
папці.

Після налаштування дотримуйтесь звичайної процедури складання PHP, наприклад *make
install*, після чого буде створено бібліотеку `oci8.so`.
Можливо, вам потрібно буде вручну перенести її в папку модулів PHP,
вказану опцією [extension_dir](ini.core.md#ini.extension-dir) вашого
`php.ini`.

Для завершення установки OCI8 додайте наступний рядок у `php.ini`:

extensionu003doci8.so

## Установка OCI8 у вигляді статично скомпілюваного модуля

Складання PHP зі статичним підключенням OCI8, використовуючи одну з наступних
конфігураційних опцій.

- При використанні Oracle Instant Client:

./configure --with-oci8u003dinstantclient,/шлях/до/instant/client/lib

- У разі використання бази даних Oracle або повної установки Oracle
Client:

./configure --with-oci8u003d$ORACLE_HOME

Після налаштування дотримуйтесь звичайної процедури встановлення PHP, наприклад,
*make install*. Після успішного складання немає необхідності додавати
`oci8.so` у файл `php.ini`. Ніяких додаткових кроків збирання більше
не вимагається.

## Встановлення OCI8 у Windows

Модуль OCI8 можна додати до PHP за допомогою бібліотек з репозиторію
[»PECL](https://pecl.php.net/package/oci8) або з директорії `ext`,
що міститься у вашій інсталяції PHP.

Для бібліотек Oracle 12*c* (і вище), розкоментуйте відповідну
рядок в `php.ini`: `extensionu003dphp_oci8_12c.dll`,
`extensionu003dphp_oci8_11g.dll` або `extensionu003dphp_oci8.dll`. Одноразово
можна використовувати лише одну з цих бібліотек. Нові бібліотеки
можуть містити більш сучасний функціонал. Склад доступних бібліотек
може змінюватись в залежності від версії PHP. Впевніться, що
[extension_dir](ini.core.md#ini.extension-dir) вказує на
директорію, що містить бібліотеки модулів PHP.

При використанні Instant Client, встановіть системну змінну
оточення `PATH` на папку з бібліотекою Oracle.

## Встановлення оточення Oracle

Перед використанням цього модуля переконайтеся, що змінні оточення
Oracle правильно налаштовані для користувача, під яким працює
веб-сервер. Якщо ваш веб-сервер автоматично стартує під час завантаження, то
переконайтеся, що оточення завантаження також налаштовано коректно.

> **Примітка**:
>
> Не встановлюйте змінні оточення Oracle через
> [putenv()](function.putenv.md) у PHP-скрипті, тому що бібліотеки
> Oracle можуть бути завантажені та проініціалізовані до запуску вашого
> Скрипт. Змінні, встановлені через
> [putenv()](function.putenv.md) можуть викликати конфлікти,
> падіння та інше непередбачуване поведінка. Деякі функції можуть
> працювати, у той час як інші дають дрібні помилки. Необхідно
> встановлювати ці змінні *до* запуску веб-сервера.

У Red Hat Linux та його варіантах експортуйте змінні в кінці файлу
`/etc/sysconfig/httpd`. Інші системи з Apache 2 можуть використовувати
скрипт `envvars` з папки `bin` у дистрибутиві Apache. Третім варіантом
є директива Apache `SetEnv` у файлі `httpd.conf`, на якихось
системах вона може працювати, однак відомо, що на деяких її
недостатньо.

Щоб переконатися в коректному налаштуванні змінних оточення,
використовуйте функцію [phpinfo()](function.phpinfo.md) та перевірте, що
розділ *Environment* (не *Apache Environment*) містить очікувані
змінні.

Наступна таблиця містить змінні, які можуть знадобитися.
За подробицями про всі доступні змінні звертайтесь до
документації Oracle.

| Назва | Ціль |
|-----------------|------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------|
| ORACLE_HOME | Вказує на папку з повністю встановленою базою даних Oracle. Не встановлюйте цю змінну, використовуючи Oracle Instant Client, т.к. в цьому немає потреби і може викликати проблеми при встановленні. |
| ORACLE_SID | Містить назву бази даних на локальній машині, до якої йде підключення. Немає необхідності встановлювати цю змінну під час використання Oracle Instant Client або завжди передавати у параметрах з'єднання у функцію [oci_connect()](function.oci-connect.md). |
| LD_LIBRARY_PATH | Встановіть цю змінну (або її еквівалент на використовуваній платформі, наприклад, `LIBPATH` або `SHLIB_PATH`) у місцезнаходження бібліотек Oracle, наприклад, `$ORACLE_HOME/lib` або `/usr/lib/oracle/18.5/client/lib`. Зверніть увагу, що для ZIP архівів Instant Client в Linux надійніше використовувати `ldconfig`. Зверніться до інструкції з встановлення Instant Client. Для RPM пакетів Instant Client 19 (і старше), `ldconfig`, буде запущено автоматично. Хтось використовує `LD_PRELOAD` замість `LD_LIBRARY_PATH`. |
| NLS_LANG | Це основна змінна, яка використовується для вказівки кодування та настроювання глобалізації в бібліотеках Oracle. |
| ORA_SDTZ | Встановлює часовий пояс сесії Oracle. |
| TNS_ADMIN | Містить папку, в якій зберігаються конфігураційні файли Oracle Net Services, такі як tnsnames.ora і sqlnet.ora. У ній немає необхідності, якщо рядок з'єднання функції [oci_connect()](function.oci-connect.md) використовує синтаксис Easy Connect, такий як, наприклад, `localhost/XE`. У ній також немає необхідності, якщо мережні конфігураційні файли містяться в місцях зберігання за промовчанням, таких як `/usr/lib/oracle/VERSION/client/lib/network/admin`, `$ORACLE_HOME/network/admin` або `/etc `. |

**Загальні змінні оточення Oracle**

Менш використовувані змінні оточення Oracle включають
`TWO_TASK`, `ORA_TZFILE`, а також різні установки глобалізації
Oracle на кшталт змінних `NLS*` та `ORA_NLS_*`.

## Вирішення проблем

Найчастішою проблемою при встановленні OCI8 є неправильна
встановлення оточення Oracle. Зазвичай це виявляється у проблемі при
використання функцій [oci_connect()](function.oci-connect.md) або
[oci_pconnect()](function.oci-pconnect.md). Помилка може виявлятися в
вигляді помилок PHP, наприклад, *Call to undefined function oci_connect()*,
помилок Oracle, таких як ORA-12705, або навіть аварії Apache. Перевірте
лог-файли Apache на наявність помилок запуску та вищеописані розділи для
вирішення цієї проблеми.

Незважаючи на те, що мережеві помилки, на кшталт ORA-12154 або ORA-12514
сигналізують про помилку в іменуванні або конфігурації мережі Oracle,
реальною причиною може бути некоректно встановлене оточення PHP,
через що бібліотеки Oracle не можуть знайти конфігураційний файл
`tnsnames.ora`.

У Windows використання кількох версій Oracle на одній машині може
легко викликати їх конфлікти, яких можна уникнути при дотриманні особливих
запобіжних заходів, що передбачають, що PHP використовує коректну
версія Oracle.

Утиліта, що допомагає визначити шукані та завантажені в результаті бібліотеки,
може допомогти у разі проблем при відсутніх або конфліктуючих
бібліотеки, особливо в Windows.

> **Примітка**: **Якщо веб-сервер не стартує або падає під час старту**
>
> Перевірте, що Apache зібрано з бібліотекою pthread:
>
> # ldd /www/apache/bin/httpd
> libpthread.so.0 u003d> /lib/libpthread.so.0 (0x4001c000)
> libm.so.6 u003d> /lib/libm.so.6 (0x4002f000)
> libcrypt.so.1 u003d> /lib/libcrypt.so.1 (0x4004c000)
> libdl.so.2 u003d> /lib/libdl.so.2 (0x4007a000)
> libc.so.6 u003d> /lib/libc.so.6 (0x4007e000)
> /lib/ld-linux.so.2 u003d> /lib/ld-linux.so.2 (0x40000000)
>
> Якщо libpthread немає у списку, переустановіть Apache:
>
> # cd /usr/src/apache_1.3.xx
> # make clean
> # LIBSu003d-lpthread ./config.status
> # make
> # make install
>
> Майте на увазі, що на деяких системах, як UnixWare,
> libpthread називається libthread. Таким чином, PHP та Apache повинні
> бути настроєні за допомогою EXTRA_LIBSu003d-lthread.
