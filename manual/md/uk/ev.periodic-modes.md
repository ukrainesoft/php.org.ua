- [« Watcher callbacks](ev.watcher-callbacks.md)
- [Ev »](class.ev.md)

- [PHP Manual](index.md)
- [Ev] (book.ev.md)
- Режими роботи періодичних спостерігачів

# Режими роботи періодичних спостерігачів

Спостерігачі [EvPeriodic](class.evperiodic.md) працюють у різних
режимах в залежності від значення параметрів `offset`, `interval` та
`reschedule_cb`.

1. * Абсолютний таймер *. У цьому режимі `interval` u003d **`0`**,
`reschedule_cb` u003d **`null`**. Таймер просто спрацює один раз у
заданий в `offset` час. Він не компенсує стрибки часу і якщо
вказано спрацювати в *1 Січня 2014*, то він спрацює коли
системний час дорівнює або більше цього значення.

2. *Таймер із фіксованим інтервалом*. У цьому режимі `interval` \>
**`0`**, а `reschedule_cb` u003d **`null`**. Кожне наступне
спрацьовування буде рівне через `offset` + **`N`** \* `interval` (де
**`N`** - ціле число), незважаючи на стрибки часу.

Це можна використовувати для створення таймерів, які не розходяться
із системним часом:

` <?php$hourly u003d EvPeriodic(0, 3600, NULL, function () { echo "один раз в година
";});?> `

Це не означає, що між спрацьовуваннями завжди буде рівно
**`3600`** секунд. Це означає, що callback-функція буде викликана
тільки коли системний годинник покаже повну годину (*UTC*).

У цьому режимі [EvPeriodic](class.evperiodic.md) намагатиметься
запустити callback-функцію в наступний доступний час, коли `time`
u003d `offset` (`mod` `interval`), незалежно від стрибків часу.

3. *Режим ручного перевизначення часу спрацьовування*. У цьому режимі
`reschedule_cb` є коректним параметром типу
[callable](language.types.callable.md).

`interval` та `offset` ігноруються. Натомість, при кожному
спрацьовуванні, спостерігач запускає callback-функцію
(`reschedule_cb`) з двома аргументами, посиланням на спостерігача та
часом.

Ця callback-функція ніколи не повинна зупиняти або
знищувати цей або будь-який інший періодичний спостерігач і
*не повинна* викликати функції та методи подієвого циклу. Для
зупинки можна повернути дуже велике число, наприклад, **`1e30`**, та
зупинити спостерігач поза цієї функції. Для цього можна
використовувати спостерігачів [EvPrepare](class.evprepare.md).

Ця функція повинна повернути наступний час спрацьовування, ґрунтуючись
на переданому значенні часу (тобто найменше значення
часу більше або дорівнює другому аргументу). Зазвичай вона викликається
перед тим, як буде викликана основна callback-функція спостерігача,
але може і пізніше.

**Приклад #1 Використання спостерігача з ручним перевизначенням
часу спрацьовування**

`<?php// Спрацьовувати кожні 10.5 секундfunction reschedule_cb ($watcher, $now) {   return $now + (10.5. - fmod($now, 10.5))    reschedule_cb", function ($w, $revents) {  echo time(), PHP_EOL;});Ev::run();?> `
