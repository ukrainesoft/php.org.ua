- [«msg_queue_exists](function.msg-queue-exists.md)
- [msg_remove_queue »](function.msg-remove-queue.md)

- [PHP Manual](index.md)
- [Функції семафорів](ref.sem.md)
- Отримання повідомлення з черги повідомлень

#msg_receive

(PHP 4 \>u003d 4.3.0, PHP 5, PHP 7, PHP 8)

msg_receive — Отримання повідомлення з черги повідомлень

### Опис

**msg_receive**(
[SysvMessageQueue](class.sysvmessagequeue.md) `$queue`,
int `$desired_message_type`,
int `&$received_message_type`,
int `$max_message_size`,
[mixed](language.types.declarations.md#language.types.declarations.mixed)
`&$message`,
bool `$unserialize` u003d **`true`**,
int `$flags` u003d 0,
int `&$error_code` u003d **`null`**
): bool

**msg_receive()** отримує перше повідомлення з параметром, що задається
`queue` черги повідомлень з типом, вказаним у `desired_message_type`.

### Список параметрів

`queue`
Черга повідомлень.

`desired_message_type`
Якщо `desired_message_type` вказано 0, повертається перше повідомлення
із черги. Якщо `desired_message_type` більше 0, то повертається перше
повідомлення із зазначеним типом. Якщо `desired_message_type` менше 0, то
повертається перше повідомлення з типом, меншим або рівним за модулем
вказаному в `desired_message_type`. Якщо немає повідомлень, які відповідають
критеріям, ваш скрипт очікує їх появи у черзі. Ви можете змінити
це поведінка, вказавши **`MSG_IPC_NOWAIT`** у параметрі `flags`.

`received_message_type`
Цей параметр зберігає тип отриманого повідомлення.

`max_message_size`
Максимальний розмір повідомлення задається в
`max_message_size`; якщо повідомлення в черзі більше за цей розмір, то
функція завершується помилкою (якщо ви не встановите `flags` як описано
нижче).

`message`
Отримане повідомлення зберігається в `message`, якщо не було помилок при
отриманні.

`unserialize`
Якщо встановлено в **`true`**, повідомлення розглядається як
серіалізоване з використанням того ж механізму, що і в модулі
сесій. Повідомлення десеріалізується, а потім повертається до вашого скрипту.
Це дозволяє вам легко отримувати масиви та складні об'єкти з інших.
PHP-скриптів, або, якщо ви використовуєте WDDX-серіалізатор, з будь-яких
сумісних із WDDX джерел.

Якщо в `unserialize` вказано **`false`**, повідомлення повертається у вигляді
бінарно-безпечного рядка.

`flags`
Необов'язковий параметр `flags` дозволяє передати прапорці в
низькорівневий системний дзвінок msgrcv. За замовчуванням значення 0,
однак ви можете вказати одне або кілька наступних значень
(складаючи їх або виконуючи операцію бінарного АБО).

| | |
|----------------------|-------------------------- -------------------------------------------------- -------------------------------------------------- -------------------------------------------------- ------------------|
| **`MSG_IPC_NOWAIT`** | Якщо немає повідомлень, які відповідають умовам `desired_message_type`, повертатися негайно, а не чекати. Функція завершується помилкою та повертає ціле значення **`MSG_ENOMSG`**. |
| **`MSG_EXCEPT`** | Використання цього прапора в комбінації із зазначеним у `desired_message_type` позитивним значенням, дозволяє отримати перше повідомлення, тип якого не дорівнює значенню `desired_message_type`. |
| **`MSG_NOERROR`** | Якщо розмір повідомлення перевищує `max_message_size`, то встановлення цього прапора призводить до усічення повідомлення до `max_message_size` без сигналізації про помилку. |

**Flag values for msg_receive**

`error_code`
Якщо функція завершується аварійно, необов'язковий параметр `error_code`
міститиме значення системної змінної errno.

### Значення, що повертаються

Повертає **`true`** у разі успішного виконання або **`false`** у
у разі виникнення помилки.

При успішному завершенні структура даних черги повідомлень оновлюється
наступним чином: `msg_lrpid` містить ідентифікатор викликаного
процесу, `msg_qnum` зменшується на 1 і `msg_rtime` встановлюється
відповідно до поточного часу.

### Список змін

| Версія | Опис |
|--------|---------------------------------------- -------------------------------------------------- ------------------------------------|
| 8.0.0 | Параметр `queue` тепер очікує на екземпляр [SysvMessageQueue](class.sysvmessagequeue.md); раніше очікували ресурс (resource). |

### Дивіться також

- [msg_remove_queue()](function.msg-remove-queue.md) - Видалення
черги повідомлень
- [msg_send()](function.msg-send.md) - Надсилання повідомлення в чергу
повідомлень
- [msg_stat_queue()](function.msg-stat-queue.md) - Отримання
інформації із структури даних черги повідомлень
- [msg_set_queue()](function.msg-set-queue.md) - Встановлення
інформації у структурі даних черги повідомлень
