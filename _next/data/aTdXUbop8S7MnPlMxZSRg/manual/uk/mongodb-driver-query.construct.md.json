{"pageProps":{"page":{"slug":"mongodb-driver-query.construct.md","content":"# MongoDB\\\\Driver\\\\Query::\\_\\_construct\n\n(mongodb >=1.0.0)\n\nMongoDB\\\\Driver\\\\Query::\\_\\_construct — Створює новий запит\n\n### Опис\n\n```methodsynopsis\nfinal public MongoDB\\Driver\\Query::__construct(array|object $filter, ?array $queryOptions = null)\n```\n\nСтворює новий [MongoDB\\\\Driver\\\\Query](class.mongodb-driver-query.md)який є об'єктом незмінного значення, що представляє запит до бази даних. Потім запит може бути виконаний за допомогою [MongoDB\\\\Driver\\\\Manager::executeQuery()](mongodb-driver-manager.executequery.md)\n\n### Список параметрів\n\n`filter`(array|object)\n\n[» Предикат запиту](https://www.mongodb.com/docs/manual/tutorial/query-documents/). Порожній предикат збігатиметься з усіма елементами колекції.\n\n> **Зауваження**: При обчисленні критеріїв запиту MongoDB порівнює типи та значення відповідно до власних [» правилами порівняння типів BSON](https://www.mongodb.com/docs/manual/reference/bson-type-comparison-order/), відмінних від правил [порівняння](types.comparisons.md) і [приведення типів](language.types.type-juggling.md) PHP. Коли вказано спеціальний тип BSON, критерій запиту має відповідати [класу BSON](book.bson.md) (тобто використовувати [MongoDB\\\\BSON\\\\ObjectId](class.mongodb-bson-objectid.md) для вибірки по [» ObjectId](https://www.mongodb.com/docs/manual/reference/bson-types/#objectid)\n\n`queryOptions`\n\n**queryOptions**\n\n| Опция | Тип | Опис |\n| --- | --- | --- |\n| allowDiskUse | bool |  |\n| Дозволяє MongoDB використовувати тимчасові файли на диску для зберігання даних, що перевищують межу системної пам'яті 100 мегабайт, при обробці операції сортування блокування. |  |  |\n\n| | allowPartialResults | bool |\n\nДля запитів до ізольованої колекції повертає часткові результати з mongos, якщо деякі шарди недоступні замість видачі помилки.\n\nВозврат к устаревшей`\"partial\"` опції, якщо вона не вказана.\n\n| | awaitData | bool | Використовуйте разом із опцією `\"tailable\"`тимчасово заблокувати операцію getMore для курсору, якщо в кінці даних, а не повертати жодних даних. Після закінчення часу очікування запит повертається, як завжди. | | batchSize | int |\n\nКількість документів для повернення у першому пакеті. За замовчуванням – 101. Розмір пакета 0 означає, що курсор буде встановлений, але жодні документи не будуть повернуті у першому пакеті.\n\nУ версіях MongoDB до 3.2, де запити використовують застарілий дротовий протокол OP\\_QUERY, розмір пакета, що дорівнює 1, буде закривати курсор незалежно від кількості документів, що збігаються.\n\n| | collation | array|object |\n\n[» Зіставлення](https://www.mongodb.com/docs/upcoming/reference/collation/) дозволяє користувачам вказувати специфічні для конкретної мови правила для порівняння рядків, такі як реакцію на регістр літер та надрядкові знаки. Якщо поставлено зіставлення, то поле `\"locale\"`также обязательно. Опис полей смотрите в разделе[» Зіставлення](https://www.mongodb.com/docs/upcoming/reference/collation/#collation-document)\n\nЯкщо зіставлення не задано явно, але в колекції визначено зіставлення за умовчанням, буде використано воно. Якщо немає ні того, то MongoDB буде використовувати просте бінарне порівняння рядків.\n\nЦя опція доступна у MongoDB 3.4+ і, якщо буде використана для більш старих версій, викличе виняток під час виконання.\n\n| | comment |[mixed](language.types.declarations.md#language.types.declarations.mixed)\n\nДовільний коментар, що допомагає відстежити операцію за допомогою профільника бази даних, виводу CurrentOp та журналів.\n\nКоментар може бути будь-яким типом BSON для MongoDB 4.4+. Більш ранні версії сервера підтримують лише строкові значення.\n\nВозврат к устаревшему модификатору`\"$comment\"`якщо він не вказаний.\n\n| | exhaust | bool |\n\nПотокова передача даних на повну потужність в декількох \"додаткових\" пакетах за умови, що клієнт повністю прочитає всі дані, що запитуються. Швидше, коли ви отримуєте багато даних і знаєте, що ви хочете все це перенести. Примітка: клієнт не має права не читати всі дані, якщо не закриває з'єднання.\n\nЦя опція не підтримується командою find у MongoDB 3.2+ і змусить драйвер використовувати застарілу версію проводового протоколу (тобто OP\\_QUERY).\n\n| | explain | bool |\n\nЯкщо **`true`**, повернутий [MongoDB\\\\Driver\\\\Cursor](class.mongodb-driver-cursor.md) міститиме один документ, який описує процес та індекси, що використовуються для повернення запиту.\n\nВозврат к устаревшему модификатору`\"$explain\"`якщо він не вказаний.\n\nЦя опція не підтримується командою find в MongoDB 3.2+ і враховуватиметься лише при використанні застарілої версії проводового протоколу (тобто OP\\_QUERY). Команда[» explain](https://www.mongodb.com/docs/manual/reference/command/explain/) має використовуватися на MongoDB 3.0+.\n\n| | hint | string|array|object |\n\nІндекс специфікації. Вкажіть або назву індексу у вигляді рядка, або шаблон ключа індексу. Якщо вказано, то система запитів розглядатиме плани лише з використанням індексу хінтованого.\n\nОткат к устаревшей опции`\"hint\"`якщо вона не вказана.\n\n| | let | array|object |\n\nКарта імен та значень параметрів. Значення мають бути константами або закритими виразами, які посилаються на поля документа. До параметрів можна звертатися як до змінних у контексті агрегованого виразу (наприклад, `$$var`\n\nОпція доступна в MongoDB 5.0+ і призведе до виключення під час виконання, якщо вказана для старої версії сервера.\n\n| | limit | int |\n\nМаксимальна кількість документів для повернення. Якщо не вказано, використовується за умовчанням без обмежень. Значення 0 еквівалентне встановленню без обмеження.\n\nНегативне значення інтерпретуватиметься як позитивне значення з параметром `\"singleBatch\"`, встановленим у значення **`true`**. Ця поведінка підтримується для зворотної сумісності, але її слід вважати застарілою.\n\n| | max | array|object |\n\n*Ексклюзивна* верхня межа для певного індексу.\n\nВозврат к устаревшему модификатору`\"$max\"`якщо він не вказаний.\n\n| | maxAwaitTimeMS | int |\n\nПозитивне ціле число, що означає обмеження часу в мілісекундах для сервера, щоб заблокувати операцію getMore, якщо дані недоступні. Ця опція повинна використовуватися лише у поєднанні з опціями `\"tailable\"`и`\"awaitData\"`\n\n| | maxScan | int |\n\n**Увага**\n\nЦя опція застаріла і не повинна використовуватись.\n\nЦіла позитивна кількість, що позначає максимальну кількість документів або індексних ключів для сканування при виконанні запиту.\n\nВозврат к устаревшему модификатору`\"$maxScan\"`якщо він не вказаний.\n\n| | maxTimeMS | int |\n\nНакопичений ліміт часу у мілісекундах для операцій обробки на курсорі. MongoDB перериває операцію в найближчій точці переривання.\n\nВозврат к устаревшему модификатору`\"$maxTimeMS\"`якщо він не вказаний.\n\n| | min | array|object |\n\n*Включає* нижня межа для певного індексу.\n\nВозврат к устаревшему модификатору`\"$min\"`якщо він не вказаний.\n\n| | modifiers | array |[» Метаоператори](https://www.mongodb.com/docs/manual/reference/operator/query-modifier/), що змінюють виведення чи поведінку запиту. Використання цих операторів не рекомендується на користь іменованих опцій. | | noCursorTimeout | bool | Забороняє серверу синхронізувати незайняті курсори після періоду бездіяльності (10 хвилин). | | oplogReplay | bool |\n\nВнутрішнє використання для реплік наборів. Щоб використовувати oplogReplay, ви повинні включити до фільтра наступну умову:\n\n\\[ 'ts' => \\[ '$gte' => \\] \\]\n\n> **Зауваження**: Опція застаріла з версії 1.8.0\n\n| | projection | array|object |\n\n[» Специфікація проекції](https://www.mongodb.com/docs/manual/tutorial/project-fields-from-query-results/) для визначення полів, які необхідно включити до документів, що повертаються.\n\nЯкщо ви використовуєте [функцію ODM](mongodb.persistence.deserialization.md) для десеріалізації документів як їх вихідний клас PHP, переконайтеся, що ви включили поле \\_\\_pclass у проекцію. Це необхідно для роботи десеріалізації, і без неї драйвер поверне (за умовчанням) об'єкт [stdClass](class.stdclass.md)\n\n| | readConcern |[MongoDB\\\\Driver\\\\ReadConcern](class.mongodb-driver-readconcern.md)\n\nГарантії читання застосувати до операції. За промовчанням будуть використовуватися гарантії читання з [URI підключення MongoDB](mongodb-driver-manager.construct.md#mongodb-driver-manager.construct-uri)\n\nЦя опція доступна в MongoDB 3.2+ і призведе до виключення під час виконання, якщо вказано для старої версії сервера.\n\n| | returnKey | bool |\n\nЯкщо **`true`**, повертає лише індексні ключі у результуючих документах. Значення за умовчанням є **`false`**. Якщо **`true`** і команда find не використовують індекс, повернуті документи будуть порожніми.\n\nВозврат к устаревшему модификатору`\"$returnKey\"`якщо він не вказаний.\n\n| | showRecordId | bool |\n\nВизначає, чи повертати ідентифікатор запису для кожного документа. Якщо **`true`**, добавляет поле`\"$recordId\"` верхнього рівня до повернутих документів.\n\nВозврат к устаревшему модификатору`\"$showDiskLoc\"`якщо він не вказаний.\n\n| | singleBatch | bool | Визначає, чи закривати курсор після першого пакета. За замовчуванням **`false`**| | skip | int | Количество документов для пропуска. По умолчанию 0. | | snapshot | bool |\n\n**Увага**\n\nЦя опція застаріла і не повинна використовуватись.\n\nЗабороняє курсору повертати документ більше одного разу через проміжну операцію запису.\n\nВозврат к устаревшему модификатору`\"$snapshot\"`якщо він не вказаний.\n\n| | sort | array|object |\n\nСпецифікація сортування для впорядкування результатів.\n\nВозврат к устаревшему модификатору`\"$orderby\"`якщо він не вказаний.\n\n| | tailable | bool | Повертає курсор для обмеженої колекції. |\n\n### Помилки\n\n-   При помилці парсингу аргумент кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)\n\n### список змін\n\n| Версия | Опис |\n| --- | --- |\n| PECL mongodb 1.14.0 |  |\n| Добавлена опция`\"let\"`Опция`\"comment\"` тепер приймає будь-який тип. |  |\n\n| | PECL mongodb 1.8.0 |\n\nДобавлен параметр`\"allowDiskUse\"`\n\nПараметр`\"oplogReplay\"` оголошено застарілим.\n\n| | PECL mongodb 1.5.0 |\n\nПараметри `\"maxScan\"`и`\"snapshot\"`устарели.\n\n| | PECL mongodb 1.3.0 |\n\nДобавлен параметр`\"maxAwaitTimeMS\"`\n\n| | PECL mongodb 1.2.0 |\n\nДобавлен параметр`\"allowPartialResults\"` `\"collation\"` `\"comment\"` `\"hint\"` `\"max\"` `\"maxScan\"` `\"maxTimeMS\"` `\"min\"` `\"returnKey\"` `\"showRecordId\"`, и`\"snapshot\"`\n\nПереименован параметр`\"partial\"`в`\"allowPartialResults\"`. Для зворотної сумісності, `\"partial\"` все одно буде прочитаний, якщо `\"allowPartialResults\"` не вказано.\n\nВидалено застарілий параметр `\"secondaryOk\"`. Для запитів, які використовують застарілий дротовий протокол OP\\_QUERY, драйвер установит бит`secondaryOk` при необхідності відповідно до [» Специфікацією вибору сервера](https://github.com/mongodb/specifications/blob/master/source/server-selection/server-selection.rst)\n\n| | PECL mongodb 1.1.0 | Добавлен параметр`\"readConcern\"`.\n\n### Приклади\n\n**Приклад #1 Приклад використання** MongoDB\\\\Driver\\\\Query::\\_\\_construct()\\*\\*\\*\\*\n\n```php\n<?php\n/* Выберите только документы, автором которых является \"bjori\" с не менее 100 просмотров */\n$filter = [\n    'author' => 'bjori',\n    'views' => [\n        '$gte' => 100,\n    ],\n];\n\n$options = [\n    /* Вернуть только следующие поля в соответствующих документах */\n    'projection' => [\n        'title' => 1,\n        'article' => 1,\n    ],\n    /* Вернуть документы в порядке убывания просмотров */\n    'sort' => [\n        'views' => -1\n    ],\n];\n\n$query = new MongoDB\\Driver\\Query($filter, $options);\n\n$manager = new MongoDB\\Driver\\Manager('mongodb://localhost:27017');\n$readPreference = new MongoDB\\Driver\\ReadPreference(MongoDB\\Driver\\ReadPreference::RP_PRIMARY);\n$cursor = $manager->executeQuery('databaseName.collectionName', $query, $readPreference);\n\nforeach($cursor as $document) {\n    var_dump($document);\n}\n\n?>\n```\n\n### Дивіться також\n\n-   [MongoDB\\\\Driver\\\\Manager::executeQuery()](mongodb-driver-manager.executequery.md) \\- Виконує запит до бази даних\n-   [MongoDB\\\\Driver\\\\Cursor](class.mongodb-driver-cursor.md)\n","title":"MongoDB\\\\Driver\\\\Query::\\_\\_construct","contentType":2,"navigation":[{"class.mongodb-driver-query.md":"« MongoDB\\\\Driver\\\\Query"},{"class.mongodb-driver-bulkwrite.md":"MongoDB\\\\Driver\\\\BulkWrite »"},{"index.md":"PHP Manual"},{"class.mongodb-driver-query.md":"MongoDB\\\\Driver\\\\Query"}]}},"__N_SSG":true}