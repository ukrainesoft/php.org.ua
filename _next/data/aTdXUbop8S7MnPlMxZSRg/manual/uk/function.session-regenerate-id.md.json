{"pageProps":{"page":{"slug":"function.session-regenerate-id.md","content":"# session\\_regenerate\\_id\n\n(PHP 4 >= 4.3.2, PHP 5, PHP 7, PHP 8)\n\nsession\\_regenerate\\_id — Генерує та оновлює ідентифікатор поточної сесії\n\n### Опис\n\n```methodsynopsis\nsession_regenerate_id(bool $delete_old_session = false): bool\n```\n\n**session\\_regenerate\\_id()** замінює ідентифікатор поточної сесії знову згенерованим, при цьому зберігає інформацію про поточну сесію.\n\nПри ввімкненій опції [session.use\\_trans\\_sid](session.configuration.md#ini.session.use-trans-sid), висновок має здійснюватися після виклику **session\\_regenerate\\_id()**. В іншому випадку використовуватиметься старий ідентифікатор сесії.\n\n**Увага**\n\nПоточна реалізація **session\\_regenerate\\_id()** погано працює з мережами з нестабільним з'єднанням, такими як мобільні та WiFi-мережі. Таким чином, є можливість втратити сесію через виклик **session\\_regenerate\\_id()**\n\nВи не повинні знищувати дані старої сесії негайно, а використовувати тимчасові мітки видалення і контролювати доступ до старої сесії. В іншому випадку конкуруючий доступ до сторінки може призвести до неузгодженого стану, втрати сесії або стану гонки на стороні клієнта (браузера), що, у свою чергу, призведе до створення безлічі ідентифікаторів сесії без необхідності. Негайне видалення сесії також унеможливлює виявлення та запобігання атакам при перехопленні сесії.\n\n### Список параметрів\n\n`delete_old_session`\n\nВизначає, чи видаляти старий пов'язаний файл із сесією чи ні. Не слід видаляти стару сесію, якщо потрібно уникати стану гонки через видалення або виявляти/уникати атак під час перехоплення сесії.\n\n### Значення, що повертаються\n\nПовертає **`true`** у разі успішного виконання або \\*\\*`false`\\*\\*в случае возникновения ошибки.\n\n### Приклади\n\n**Приклад #1 Приклад використання** session\\_regenerate\\_id()\\*\\*\\*\\*\n\n```php\n<?php\n// ЗАМЕЧАНИЕ: Это не полностью работающий код, а только Приклад!\n\nsession_start();\n\n// Проверяем временную метку удаления\nif (isset($_SESSION['destroyed'])\n    && $_SESSION['destroyed'] < time() - 300) {\n    // Обычно это не должно происходить. Это может быть атакой или результатом нестабильной сети.\n    // Удаляем все статусы аутентификации пользователей этой сессии.\n    remove_all_authentication_flag_from_active_sessions($_SESSION['userid']);\n    throw(new DestroyedSessionAccessException);\n}\n\n$old_sessionid = session_id();\n\n// Устанавливаем временную метку удаления\n$_SESSION['destroyed'] = time(); // session_regenerate_id() сохраняет данные старой сессии\n\n// Просто вызов session_regenerate_id() может привести к потере сессии и т.д.\n// Смотрите следующий Приклад.\nsession_regenerate_id();\n\n// Новой сессии не требуется временная метка удаления.\nunset($_SESSION['destroyed']);\n\n$new_sessionid = session_id();\n\necho \"Старая сессия: $old_sessionid<br />\";\necho \"Новая сессия: $new_sessionid<br />\";\n\nprint_r($_SESSION);\n?>\n```\n\nПоточний модуль сесії не працює добре з мережами з нестабільним з'єднанням. Ви повинні керувати ідентифікатором сесії, щоб уникнути втрати сесії в результаті виклику **session\\_regenerate\\_id()**\n\n**Приклад #2 Как избежать потери сессии при использовании**session\\_regenerate\\_id()\\*\\*\\*\\*\n\n```php\n<?php\n// ЗАМЕЧАНИЕ: Это не полностью работающий код, а только Приклад!\n// my_session_start() и my_session_regenerate_id() избегают потери\n// сессии из-за нестабильной сети. В дополнение, данный код может предотвращать\n// использование украденных сессий злоумышленниками.\n\nfunction my_session_start() {\n    session_start();\n    if (isset($_SESSION['destroyed'])) {\n       if ($_SESSION['destroyed'] < time()-300) {\n           // Обычно это не должно происходить. Это может быть атакой или результатом нестабильной сети.\n           // Удаляем все статусы аутентификации пользователей этой сессии.\n           remove_all_authentication_flag_from_active_sessions($_SESSION['userid']);\n           throw(new DestroyedSessionAccessException);\n       }\n       if (isset($_SESSION['new_session_id'])) {\n           // Срок действия ещё не полностью истёк. Cookie могли быть потеряны из-за нестабильной сети.\n           // Заново пытаемся установить правильный cookie идентификатора сессиии.\n           // ЗАМЕЧАНИЕ: Не пытайтесь заново установить идентификатор сессии если, вы предпочитаете\n           // удалить флаг аутентификации.\n           session_commit();\n           session_id($_SESSION['new_session_id']);\n           // Новый идентификатор сессии должен существовать.\n           session_start();\n           return;\n       }\n   }\n}\n\nfunction my_session_regenerate_id() {\n    // Новый идентификатор сессии необходим для установки правильного идентификатора сессии,\n    // когда идентификатор сессии не был установлен из-за нестабильной сети.\n    $new_session_id = session_create_id();\n    $_SESSION['new_session_id'] = $new_session_id;\n\n    // Устанавливаем временную метку удаления.\n    $_SESSION['destroyed'] = time();\n\n    // Записываем и закрываем текущую сессию.\n    session_commit();\n\n    // Стартуем сессию с новым идентификатором.\n    session_id($new_session_id);\n    ini_set('session.use_strict_mode', 0);\n    session_start();\n    ini_set('session.use_strict_mode', 1);\n\n    // Новой сессии не нужно это.\n    unset($_SESSION['destroyed']);\n    unset($_SESSION['new_session_id']);\n}\n?>\n```\n\n### Дивіться також\n\n-   [session\\_id()](function.session-id.md) \\- Отримує та/або встановлює ідентифікатор поточної сесії\n-   [session\\_create\\_id()](function.session-create-id.md) \\- створює новий ідентифікатор сесії\n-   [session\\_start()](function.session-start.md) \\- Стартує нову сесію, або відновлює існуючу\n-   [session\\_destroy()](function.session-destroy.md) \\- Знищує всі дані сесії\n-   [session\\_reset()](function.session-reset.md) \\- реініціалізує сесію оригінальними значеннями\n-   [session\\_name()](function.session-name.md) \\- Отримати чи встановити ім'я поточної сесії\n","title":"session\\_regenerate\\_id","contentType":2,"navigation":[{"function.session-name.md":"« session\\_name"},{"function.session-register-shutdown.md":"session\\_register\\_shutdown »"},{"index.md":"PHP Manual"},{"ref.session.md":"Функції для роботи із сесіями"}]}},"__N_SSG":true}