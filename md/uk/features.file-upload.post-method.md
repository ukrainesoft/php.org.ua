- [« Завантаження файлів на сервер](features.file-upload.md)
- [Пояснення повідомлень про помилки
»](features.file-upload.errors.md)

- [PHP Manual](index.md)
- [Завантаження файлів на сервер](features.file-upload.md)
- Завантаження файлів методом POST

## Завантаження файлів методом POST

Ця можливість дозволяє завантажувати як текстові, так і бінарні.
файли. За допомогою PHP-функцій автентифікації та роботи з файлами ви маєте
повний контроль над тим, кому дозволено завантажувати файли та що робити з
файлом після завантаження.

PHP здатний отримувати завантажені файли з будь-якого браузера, сумісного
із стандартом RFC-1867.

> **Зауваження**: **Суміжні зауваження щодо конфігурації**
>
> Також ознайомтеся з описом директив
> [file_uploads](ini.core.md#ini.file-uploads),
> [upload_max_filesize](ini.core.md#ini.upload-max-filesize),
> [upload_tmp_dir](ini.core.md#ini.upload-tmp-dir),
> [post_max_size](ini.core.md#ini.post-max-size) та
> [max_input_time](info.configuration.md#ini.max-input-time)
> конфігураційного файлу `php.ini`

Також слід зазначити, що PHP підтримує завантаження файлів методом
PUT, який використовується у клієнтах Netscape Composer та W3C Amaya. Для
більш детальну документацію зверніться до розділу [підтримка
методу PUT] (features.file-upload.put-method.md).

**Приклад #1 Форма для завантаження файлів**

Сторінка для завантаження файлів може бути реалізована за допомогою
спеціальної форми, яка виглядає приблизно так:

```htmlcode
<!-- Тип кодування даних, enctype, ПОВИНЕН БУТИ вказаний САМЕ так -->
<form enctypeu003d"multipart/form-data" actionu003d"__URL__" methodu003d"POST">
<!-- Поле MAX_FILE_SIZE має бути вказано до поля завантаження файлу -->
<input typeu003d"hidden" nameu003d"MAX_FILE_SIZE" valueu003d"30000" />
<!-- Назва елемента input визначає ім'я в масиві $_FILES -->
Надіслати цей файл: <input nameu003d"userfile" typeu003d"file" />
<input typeu003d"submit" valueu003d"Надіслати файл" />
</form>
````

У наведеному вище прикладі `__URL__` необхідно замінити посиланням на
PHP-скрипт.

Приховане поле `MAX_FILE_SIZE` (значення необхідно вказувати у байтах)
має передувати полю для вибору файлу, і його значення є
максимально допустимим розміром файлу в PHP. Рекомендується
завжди використовувати цю змінну, тому що вона запобігає тривожному
очікування користувачів при передачі величезних файлів, тільки для того,
щоб дізнатися, що файл занадто великий і передача фактично не
відбулася. Майте на увазі, що обійти це обмеження на стороні
браузера досить просто, отже, ви не повинні покладатися на
те, що всі файли більшого розміру будуть блоковані за допомогою цієї
можливості. Це здебільшого зручна можливість для користувачів
клієнтської частини вашої програми. Однак налаштування PHP (на сервері)
щодо максимального розміру обійти неможливо.

> **Примітка**:
>
> Також слід переконатися, що форма завантаження має атрибут
> `enctypeu003d"multipart/form-data"`, інакше завантаження файлів на
> сервер не станеться.

Глобальний масив `$_FILES` містить всю інформацію про завантажені
файли. Його вміст для нашого прикладу наведено нижче. Зверніть
увагу, що тут передбачається використання імені *userfile* для
поля вибору файлу, як і у наведеному вище прикладі. Насправді ім'я
поля може бути будь-яким.

`$_FILES['userfile']['name']`
Оригінальна назва файлу на комп'ютері клієнта.

`$_FILES['userfile']['type']`
Mime-тип файлу, якщо браузер надав таку інформацію. В
як приклад можна навести ``image/gif'`. Цей mime-тип не
перевіряється на стороні PHP, тому не покладайтеся на його значення без
перевірки.

`$_FILES['userfile']['size']`
Розмір у байтах прийнятого файла.

`$_FILES['userfile']['tmp_name']`
Тимчасове ім'я, з яким файл було збережено на сервері.

`$_FILES['userfile']['error']`
[Код помилки](features.file-upload.errors.md), яка може виникнути
під час завантаження файлу.

`$_FILES['userfile']['full_path']`
Повний шлях представлений браузером. Це значення не завжди містить
реальну структуру каталогів і не можна довіряти. Доступно, починаючи з
PHP 8.1.0.

За промовчанням прийняті файли зберігаються на сервері у стандартній
тимчасовій папці доти, доки не буде задана інша директорія при
допомоги директиви [upload_tmp_dir](ini.core.md#ini.upload-tmp-dir)
конфігураційного файлу `php.ini`. Директорію сервера за промовчанням можна
змінити, встановивши змінну `TMPDIR` для оточення, в якому
виконується PHP. Встановлення цієї змінної за допомогою функції
[putenv()](function.putenv.md) всередині PHP-скрипту працювати не буде.
Ця змінна оточення також може використовуватися для того, щоб
переконатися, що інші операції також працюють із прийнятими файлами.

**Приклад #2 Перевірка файлів, що завантажуються на сервер**

Для отримання більш детальної інформації ви можете ознайомитись з
описом функцій [is_uploaded_file()](function.is-uploaded-file.md) та
[move_uploaded_file()](function.move-uploaded-file.md). Наступний
приклад приймає та обробляє завантажений за допомогою форми файл.

` <?php$uploaddir u003d '/var/www/uploads/';$uploadfile u003d $uploaddir . basename($_FILES['userfile']['name']);echo '<pre>';if (move_uploaded_file($_FILES['userfile']['tmp_name'],$uploadfile)) {    echo "Файл коректний і був успішно завантажений.
";} else {    echo "Можлива атака з допомогою файлового завантаження!
";}echo 'Деяка налагоджувальна інформація:';print_r($_FILES);print "</pre>";?> `

PHP-скрипт, який приймає завантажений файл, повинен реалізовувати логіку,
необхідну визначення подальших дій над прийнятим файлом.
Наприклад, ви можете перевірити змінну `$_FILES['userfile']['size']`,
щоб відсікти надто великі або надто маленькі файли. Також ви
можете використовувати змінну `$_FILES['userfile']['type']` для
виключення файлів, які не задовольняють критерію щодо типу
файлу, однак, беріть до уваги, що це поле повністю
контролюється клієнтом, використовуйте його тільки як першу з
серії перевірок. Також ви можете використати
`$_FILES['userfile']['error']` та [коди
помилок](features.file-upload.errors.md) під час реалізації вашої логіки.
Незалежно від того, яку модель поведінки ви вибрали, ви повинні видалити
файл з тимчасової папки або перемістити його до іншої директорії.

У разі, якщо під час надсилання форми файл обраний не був, PHP встановить
змінну `$_FILES['userfile']['size']` значенням 0, а змінну
`$_FILES['userfile']['tmp_name']` - none.

Після закінчення роботи скрипта, якщо завантажений файл не було перейменовано
або переміщений, він буде видалено автоматично з тимчасової папки.

**Приклад #3 Завантаження масиву файлів**

PHP підтримує [можливість передачі масиву з
HTML](faq.md.md#faq.md.arrays) у тому числі і з файлами.

```htmlcode
<form actionu003d"" methodu003d"post" enctypeu003d"multipart/form-data">
<p>Зображення:
<input typeu003d"file" nameu003d"pictures[]" />
<input typeu003d"file" nameu003d"pictures[]" />
<input typeu003d"file" nameu003d"pictures[]" />
<input typeu003d"submit" valueu003d"Надіслати" />
</p>
</form>
````

` <?phpforeach ($_FILES["pictures"]["error"] as $key u003d> $error) {   if ($error u003du003du003dUPLOAD_ERR_OK) {         $$tmp [$ key]; // basename() може врятувати від атак на файлову систему; // може потрібно додаткова перевірка/очищення імені файла        $name u003d basename($_FILES["pictures"]["name"][$key]); move_uploaded_file($tmp_name, "data/$name"); }}?> `

Смуга прогресу завантаження файлів може бути реалізована за допомогою
"[відстеження прогресу завантаження файлів за допомогою
сесій](session.upload-progress.md)".
