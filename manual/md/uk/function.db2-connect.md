- [«db2_conn_errormsg](function.db2-conn-errormsg.md)
- [db2_cursor_type »](function.db2-cursor-type.md)

- [PHP Manual](index.md)
- [Функції IBM DB2](ref.ibm-db2.md)
- Повертає з'єднання з базою даних

#db2_connect

(PECL ibm_db2 \>u003d 1.0.0)

db2_connect — Повертає з'єднання з базою даних

### Опис

**db2_connect**(
string `$database`,
string `$username`,
string `$password`,
array `$options` u003d ?
): resource

Створює нове з'єднання з базою даних IBM DB2 Universal Database, IBM
Cloudscape чи Apache Derby database.

### Список параметрів

`database`
Для каталогізованого з'єднання з базою даних `database`
є псевдонім бази даних у клієнтському каталозі DB2.

Для некаталогізованого підключення до бази даних `database`
є повним рядком підключення в наступному форматі:

``` literallayout
DATABASEu003ddatabase;HOSTNAMEu003dhostname;PORTu003dport;PROTOCOLu003dTCPIP;UIDu003dusername;PWDu003dpassword;
````

де параметри становлять такі значення:

`database`
Назва бази даних.

`hostname`
Ім'я хоста або IP-адреса сервера бази даних.

`port`
Порт TCP/IP, який використовується базою даних для прийняття запитів.

`username`
Ім'я користувача, під яким відбувається підключення до бази даних.

`password`
Пароль, з яким відбувається підключення до бази даних.

`username`
Ім'я користувача, під яким відбувається підключення до бази даних.

Для некаталогізованих з'єднань необхідно передати значення
**`null`** або порожній рядок.

`password`
Пароль, з яким відбувається підключення до бази даних.

Для некаталогізованих з'єднань необхідно передати значення
**`null`** або порожній рядок.

`options`
Асоціативний масив параметрів підключення, які впливають на поведінку
підключення, де допустимі ключі масиву включають:

`autocommit`
Передача значення DB2_AUTOCOMMIT_ON включає автоматичну фіксацію
(Autocommit) для цього дескриптора з'єднання.

Передача значення `DB2_AUTOCOMMIT_OFF` вимикає автоматичну фіксацію
(Autocommit) для цього дескриптора з'єднання.

`DB2_ATTR_CASE`
Передача значення DB2_CASE_NATURAL вказує, що імена стовпців
повертаються у природному регістрі.

Передача значення DB2_CASE_LOWER вказує, що імена стовпців
повертаються у нижньому регістрі.

Передача значення DB2_CASE_UPPER вказує, що імена стовпців
повертаються у верхньому регістрі.

`CURSOR`
Передача значення DB2_FORWARD_ONLY задає курсор, який рухається
тільки вперед для ресурсу оператора. Цей тип курсору використовується по
замовчуванням, він підтримується усіма серверами баз даних.

Передача значення `DB2_SCROLLABLE` задає курсор, що прокручується
ресурс оператора. Цей режим включає довільний доступ до рядків
набір результатів, але в даний час підтримується лише IBM DB2
Universal Database.

Ця нова опція доступна в ibm_db2 версії 1.7.0 та новішої.

`trustedcontext`
Передача значення DB2_TRUSTED_CONTEXT_ENABLE містить довірений
контекст для цього дескриптора з'єднання. Цей параметр не можна
встановити за допомогою [db2_set_option()](function.db2-set-option.md).

Цей ключ працює тільки в тому випадку, якщо база даних
каталогізована (навіть якщо база даних є локальною) або якщо
буде вказано повний DSN під час створення з'єднання.

Щоб каталогізувати базу даних, використовуйте такі команди:

``` literallayout
db2 catalog tcpip node loopback remote <SERVERNAME> server <SERVICENAME>
db2 catalog database <LOCALDBNAME> as <REMOTEDBNAME> at node loopback
db2 "update dbm cfg using svcename <SERVICENAME>"
db2set DB2COMMu003dTCPIP
````

Дані нові опції i5/OS доступні в ibm_db2 версії 1.5.1 та новіші.

`i5_lib`
Символьне значення, яке вказує бібліотеку за умовчанням, яка буде
використовуватись для дозволу некваліфікованих посилань на файли. Це
неприпустимо, якщо з'єднання використовує режим назви системи.

`i5_naming`
Значення `DB2_I5_NAMING_ON` включає режим іменування системи DB2 UDB
CLI iSeries. Файли кваліфікуються за допомогою косої риси (/) як
роздільника. Некваліфіковані файли дозволяються за допомогою
список бібліотек для роботи.

Значення DB2_I5_NAMING_OFF вимикає режим іменування за замовчуванням DB2
UDB CLI, який є іменем SQL. Файли кваліфікуються з
використанням точки (.) як роздільник. Некваліфіковані
файли дозволяються з використанням бібліотеки за замовчуванням, або
поточний ідентифікатор користувача.

`i5_commit`
Атрибут `i5_commit` має бути встановлений перед викликом
**db2_connect()**. Якщо значення змінюється після з'єднання
було встановлено, і з'єднання встановлено з віддаленим джерелом
даних, зміна не набуде чинності до наступного успішного виклику
**db2_connect()** для дескриптора з'єднання.

> **Примітка**:
>
> Параметр php.ini `ibm_db2.i5_allow_commit`u003du003d0 або
> `DB2_I5_TXN_NO_COMMIT` використовується за замовчуванням, але може бути
> змінено за допомогою параметра i5_commit.

`DB2_I5_TXN_NO_COMMIT` - Контроль транзакцій не використовується.

`DB2_I5_TXN_READ_UNCOMMITTED` - Можливі брудні читання, що не повторюються
читання та фантоми.

`DB2_I5_TXN_READ_COMMITTED` - Брудне читання неможливе. Можливі
неповторні читання та фантоми

`DB2_I5_TXN_REPEATABLE_READ` - Брудні читання та неповторні читання
неможливі. Можливі фантоми.

`DB2_I5_TXN_SERIALIZABLE` - Транзакції серіалізуються. Брудні читання,
неповторні читання і фантоми неможливі.

`i5_query_optimize`
`DB2_FIRST_IO` - Всі запити оптимізовані з метою максимально швидкого
повернення першої сторінки виводу. Ця мета добре працює, коли висновок
контролюється користувачем, який, швидше за все, скасує запит
після перегляду першої сторінки вихідних даних. Запити, закодовані
з пропозицією OPTIMIZE FOR nnn ROWS, враховують мету, вказану в
реченні.

DB2_ALL_IO - Всі запити оптимізовані з метою виконати весь запит
до завершення у найкоротші терміни. Це гарний варіант, коли вихідні
дані запиту записуються у файл або звіт, або коли інтерфейс ставить
вихідні дані у чергу. Запити, закодовані з пропозицією
OPTIMIZE FOR nnn ROWS, враховують мету, вказану у реченні. Це
значення за замовчуванням.

`i5_dbcs_alloc`
Значення `DB2_I5_DBCS_ALLOC_ON` включає схему розподілу DB2 6X для
збільшення розміру шпальти перетворення DBCS.

Значення DB2_I5_DBCS_ALLOC_OFF відключає схему розподілу DB2 6X
збільшення розміру стовпця перетворення DBCS.

Примітка: параметр php.ini `ibm_db2.i5_dbcs_alloc`u003du003d 0 або
DB2_I5_DBCS_ALLOC_OFF є значенням за замовчуванням, але його можна
змінити за допомогою параметра i5_dbcs_alloc.

`i5_date_fmt`
`DB2_I5_FMT_ISO` - Використовується формат дати Міжнародної організації з
стандартизації (ISO) (yyyy-mm-dd). Це значення за промовчанням.

`DB2_I5_FMT_USA` - Використовується формат дати США (mm/dd/yyyy).

`DB2_I5_FMT_EUR` - Використовується європейський формат дати (dd.mm.yyyy).

`DB2_I5_FMT_JIS` - Використовується формат дати японського промислового
стандарту (yyyy-mm-dd).

`DB2_I5_FMT_MDY` - Використовується формат дати mm/dd/yyyy.

`DB2_I5_FMT_DMY` - Використовується формат дати dd/mm/yyyy.

`DB2_I5_FMT_YMD` - Використовується формат дати yy/mm/dd.

`DB2_I5_FMT_JUL` - Використовується юліанський формат дати (yy/ddd).

`DB2_I5_FMT_JOB` - Використовується стандартне завдання.

`i5_date_sep`
`DB2_I5_SEP_SLASH` - Як роздільник дати використовується коса
характеристика (/). Це значення за промовчанням.

`DB2_I5_SEP_DASH` - Як роздільник дати використовується тире ( - ).

`DB2_I5_SEP_PERIOD` - Як роздільник дати використовується точка ( .
).

`DB2_I5_SEP_COMMA` - Як роздільник дати використовується кома (
, ).

`DB2_I5_SEP_BLANK` - В якості роздільника дати використовується пробіл.

`DB2_I5_SEP_JOB` - Використовується стандартне завдання.

`i5_time_fmt`
`DB2_I5_FMT_ISO` - Використовується формат часу Міжнародної організації
стандартизації (ISO) (hh.mm.ss). Це значення за промовчанням.

`DB2_I5_FMT_USA` - Використовується формат часу США (hh:mmxx, де xx -
це AM чи PM).

`DB2_I5_FMT_EUR` - Використовується європейський формат часу (hh.mm.ss).

`DB2_I5_FMT_JIS` - Використовується японський промисловий стандартний формат
часу (hh: mm: ss).

`DB2_I5_FMT_HMS` - Використовується формат hh:mm:ss.

`i5_time_sep`
`DB2_I5_SEP_COLON` - Як розділювач часу використовується
двокрапка ( : ). Це значення за промовчанням.

`DB2_I5_SEP_PERIOD` - Як розділювач часу використовується точка
( . ).

`DB2_I5_SEP_COMMA` - Як роздільник часу використовується кома
( , ).

`DB2_I5_SEP_BLANK` - Як розділювач часу використовується пробіл.

`DB2_I5_SEP_JOB` - Використовується стандартне завдання.

`i5_decimal_sep`
`DB2_I5_SEP_PERIOD` - Як десятковий роздільник використовується
крапка ( . ). Це значення за промовчанням.

`DB2_I5_SEP_COMMA` - Як десятковий роздільник використовується
кома ( , ).

`DB2_I5_SEP_JOB` - Використовується стандартне завдання.

Ця нова опція i5/OS доступна в ibm_db2 версії 1.8.0 та новішої.

`i5_libl`
Символьне значення, що вказує на список бібліотек, який буде
використовуватись для дозволу некваліфікованих посилань на файли.
Вкажіть елементи списку бібліотек, розділені пробілами
'i5_libl'u003d\>"MYLIB YOURLIB ANYLIB".

> **Примітка**:
>
> `i5_libl` викликає qsys2/qcmdexc('cmd',cmdlen), який доступний
> тільки в i5/OS V5R4 і більше.

### Значення, що повертаються

Повертає ресурс дескриптора підключення, якщо спроба підключення
успішна. Якщо спроба підключення зазнала невдачі, **db2_connect()**
повертає **`false`**.

### Приклади

**Приклад #1 Створення каталогізованого з'єднання**

Каталогізовані з'єднання вимагають, щоб цільова база даних була
попередньо каталогізована за допомогою DB2 Command Line Processor
(CLP) або DB2 Configuration Assistant.

` <?php$database u003d 'SAMPLE';$user u003d 'db2inst1';$password u003d 'ibmdb2';$conn u003d db2_connect($database, $user, $password);if ($conn) {    ."; db2_close($conn);}else {    echo "Connection failed.";}?> `

Результат виконання цього прикладу:

Connection succeeded.

**Приклад #2 Створення некаталогізованого з'єднання**

Некаталогізоване з'єднання дозволяє динамічно підключатися до
базі даних.

` <?php$database u003d 'SAMPLE';$user u003d 'db2inst1';$password u003d 'ibmdb2';$hostname u003d 'localhost';$port u003d 50000;$conn_string u003d "DRIVERu003d{IBM DB DATABASEu003d$database;" . "HOSTNAMEu003d$hostname;PORTu003d$port;PROTOCOLu003dTCPIP;UIDu003d$user;PWDu003d$password;";$conn u003d db2_connect($conn_string, '', '');if ($conn) {    echo " Connection succeeded."; db2_close($conn);}else {    echo "Connection failed.";}?> `

Результат виконання цього прикладу:

Connection succeeded.

**Приклад #3 Створення з'єднання з відключеним автокоммітом по
замовчуванням**

Передача масиву параметрів **db2_connect()** дозволяє змінювати
поведінка дескриптора з'єднання за умовчанням.

` <?php$database u003d 'SAMPLE';$user u003d 'db2inst1';$password u003d 'ibmdb2';$options u003d array('autocommit' u003d> DB2_AUTOCOMMIT_OFF);$conn u003d db2_connect$ password, $options);if ($conn) {   echo "Connection succeeded.
";    if (db2_autocommit($conn)) {         echo "Autocommit is on.
";    }   else {         echo "Autocommit is off.
";    }    db2_close($conn);}else {   echo "Connection failed.";}?> `

Результат виконання цього прикладу:

Connection succeeded.
Autocommit is off.

**Приклад #4 Найкраща продуктивність i5/OS**

Для досягнення максимальної продуктивності вашої програми PHP
i5/OS ibm_db2 1.5.1 використовуйте стандартний хост, ідентифікатор
користувача та пароль для **db2_connect()**.

` <?php $libraryu003du003d"ADC"; $i5 u003d db2_connect("", "", "", array("i5_lib"u003d>"qsys2")); $result u003d db2_exec($i5,        "select * from systables where table_schema u003d '$library'"); while($row u003d db2_fetch_both($result)) {    echo $row['TABLE_NAME']."</br>"; }  db2_close($i5);?> `

Результат виконання цього прикладу:

ANIMALS
NAMES
PICTURES

**Приклад #5 Використання довіреного контексту**

У цьому прикладі показано, як увімкнути довірений контекст, переключити
користувачів та отримати поточний ідентифікатор користувача.

` <?php$database u003d "SAMPLE";$hostname u003d "localhost";$port u003d 50000;$authID u003d "db2inst1";$auth_pass u003d "ibmdb2";$tc_user u003d "tcuser"; ;$dsnu003du003d"DATABASEu003d$database;HOSTNAMEu003d$hostname;PORTu003d$port; PROTOCOLu003dTCPIP;UIDu003d$authID;PWDu003d$auth_pass;";$options u003d array ("trustedcontext" u003dDDB2_TR tc_connu003du003ddb2_connect($dsn, "", "", $options);if($tc_conn) {    echo "Explicit trusted connection succeeded.
";    if(db2_get_option($tc_conn, "trustedcontext")) {        $userBefore u003d db2_get_option($tc_conn, "trusted_user");        // Выполнение работы в качестве пользователя 1        // Переключение на доверенного пользователя        $parameters u003d array("trusted_user" u003d> $tc_user,          "trusted_password" u003d> $tcuser_pass);        $res u003d db2_set_option ($tc_conn, $parameters, 1);        $userAfter u003d db2_get_option($tc_conn, "trusted_user");        // Продолжение выполнения работы в качестве доверенного пользователя if($userBefore !u003d $userAfter) {            echo "User has been switched." . "
";        }    }}   db2_close($tc_conn);}else {   echo "Explicit trusted connection failed.
";}?> `

Результат виконання цього прикладу:

Відповідний trusted connection succeeded.
User has been switched.

### Дивіться також

- [db2_close()](function.db2-close.md) - Закриває з'єднання з
базою даних
- [db2_pconnect()](function.db2-pconnect.md) - Повертає постійне
з'єднання з базою даних
