{"pageProps":{"page":{"slug":"function.flock.md","content":"# flock\n\n(PHP 4, PHP 5, PHP 7, PHP 8)\n\nflock — Портоване консультативне блокування файлів\n\n### Опис\n\n```methodsynopsis\nflock(resource $stream, int $operation, int &$would_block = null): bool\n```\n\n**flock()** дозволяє здійснити просту модель читання/запису, яка може бути використана практично на будь-якій платформі (включаючи більшість варіантів Unix та навіть Windows).\n\nБлокування також знімається за допомогою [fclose()](function.fclose.md)или когда`stream` збирається збирачем сміття.\n\nPHP підтримує портований спосіб консультативного блокування (advisory locking) повністю всього файлу (що означає, що всі програми, що здійснюють доступ до файлу, повинні використовувати той самий спосіб блокування, інакше блокування не буде працювати). За замовчуванням ця функція чекатиме на отримання блокування; цю поведінку можна змінити за допомогою наведеного нижче параметра **`LOCK_NB`**\n\n### Список параметрів\n\n`stream`\n\nВказівник (resource) на файл, який зазвичай створюється за допомогою функції [fopen()](function.fopen.md)\n\n`operation`\n\n`operation` може приймати такі значення:\n\n-   \\*\\*`LOCK_SH`\\*\\*для отримання блокування, що розділяється (читання).\n-   \\*\\*`LOCK_EX`\\*\\*для отримання ексклюзивного блокування (запис).\n-   \\*\\*`LOCK_UN`\\*\\*для зняття блокування (розділюваного або ексклюзивного).\n\nТакож можна додати константу **`LOCK_NB`** як бітова маска до будь-якої з вищевказаних операцій, якщо **flock()** не повинна блокуватись під час спроби блокування.\n\n`would_block`\n\nНеобов'язковий третій параметр буде встановлено в 1, якщо блокування буде блокуючим (код помилки EWOULDBLOCK).\n\n### Значення, що повертаються\n\nПовертає **`true`** у разі успішного виконання або \\*\\*`false`\\*\\*в случае возникновения ошибки.\n\n### Приклади\n\n**Приклад #1 Приклад використання функції** flock()\\*\\*\\*\\*\n\n```php\n<?php\n\n$fp = fopen(\"/tmp/lock.txt\", \"r+\");\n\nif (flock($fp, LOCK_EX)) { // выполняем эксклюзивную блокировку\n    ftruncate($fp, 0); // очищаем файл\n    fwrite($fp, \"Что-нибудь пишем сюда\\n\");\n    fflush($fp);        // очищаем вывод перед отменой блокировки\n    flock($fp, LOCK_UN); // снимаем блокировку\n} else {\n    echo \"Не удалось получить блокировку!\";\n}\n\nfclose($fp);\n\n?>\n```\n\n**Приклад #2 Использование**flock()**с параметром**`LOCK_NB`\\*\\*\\*\\*\n\n```php\n<?php\n$fp = fopen('/tmp/lock.txt', 'r+');\n\n/* Включаем параметр LOCK_NB в операции LOCK_EX */\nif(!flock($fp, LOCK_EX | LOCK_NB)) {\n    echo 'Не удалось получить блокировку';\n    exit(-1);\n}\n\n/* ... */\n\nfclose($fp);\n?>\n```\n\n### Примітки\n\n> **Зауваження** :\n> \n> В Windows**flock()** використовує обов'язкове (mandatory) блокування замість консультативного. Обов'язкове блокування також підтримується на Linux та операційних системах, заснованих на System V за допомогою стандартного механізму, який надає системний виклик fcntl(): тобто шуканий файл повинен мати встановлений біт доступу setgid та невстановлений біт групового виконання. Для коректної роботи цієї схеми в Linux файлова система також повинна бути змонтована з опцією mand.\n\n> **Зауваження** :\n> \n> Через те, що функції **flock()** необхідний покажчик на файл, вам може знадобитися скористатися спеціальним замикаючим файлом для того, щоб обмежити доступ до файлу, який ви маєте намір очищати, шляхом його відкриття в режимі запису (використовуючи \"w\" або \"w+\" як аргумент функції) [fopen()](function.fopen.md)\n\n> **Зауваження** :\n> \n> Може використовуватись лише на дескрипторах локальних файлів, повернутих функцією [fopen()](function.fopen.md), або файлових дескрипторах користувача потоків, що реалізують метод [streamWrapper::stream\\_lock()](streamwrapper.stream-lock.md)\n\n**Увага**\n\nПрисвоение другого значения аргументу`stream`в последующем коде отменит существующую блокировку.\n\n**Увага**\n\nУ деяких операційних системах **flock()** реалізовано лише на рівні процесів. При використанні багатопотокових серверних API, таких як ISAPI, ви не можете покладатися на **flock()** для захисту ваших файлів від інших PHP-скриптів, які працюють у паралельному потоці на тому самому сервері!\n\n**flock()** не підтримується на старих файлових системах на зразок `FAT` та її похідних, так що завжди буде повертати **`false`** у цих оточеннях.\n\n> **Зауваження** :\n> \n> У Windows, якщо процес блокування відкриває файл вдруге, він не може отримати доступ до файлу через другий дескриптор, доки він не розблокує файл.\n","title":"flock","contentType":2,"navigation":[{"function.filetype.md":"« filetype"},{"function.fnmatch.md":"fnmatch »"},{"index.md":"PHP Manual"},{"ref.filesystem.md":"Функції файлової системи"}]}},"__N_SSG":true}