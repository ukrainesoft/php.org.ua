- [« pthreads] (book.pthreads.md)
- [Встановлення та налаштування »](pthreads.setup.md)

- [PHP Manual](index.md)
- [pthreads](book.pthreads.md)
-   Вступ

# Вступ

pthreads надає об'єктно-орієнтований API для роботи з
багатопоточністю в PHP. Програми на PHP можуть створювати, читати,
записувати, запускати та виконувати синхронізацію з об'єктами Threads,
Workers та Threaded.

**Увага**

Модуль вважається непідтримуваним та мертвим.

**Підказка**

Спробуйте замість цього використати [parallel](book.parallel.md).

**Увага**

Модуль доступний лише для програм CLI. Виходячи з цього,
багатопоточність у PHP в оточенні веб-сервера недоступна.

**Увага**

pthreads (v3) може використовуватись тільки з PHP 7.2 і вище, оскільки
ZTS-режим нестабільний у 7.0 та 7.1.

Клас [Threaded](class.threaded.md) надає базовий функціонал,
Необхідний для роботи pthreads. Він надає методи синхронізації та
деякі корисні для розробника інтерфейси.

Клас [Thread](class.thread.md) дозволяє створювати потоки. Для
створення потоку необхідно створити наступні його клас і в ньому
реалізувати метод `run`. Будь-які властивості можуть бути записані та прочитані
із будь-якого контексту через посилання на потік. Також із будь-якого контексту
можуть бути викликані громадські та захищені способи. Метод run буде
запущений в окремому потоці, як тільки буде викликаний метод
[Thread::start()](thread.start.md) з контексту, в якому він був
створено. Стартувати та приєднати потік можна лише в тому контексті,
де його було створено.

Клас [Worker](class.worker.md) має постійний стан та буде
доступний з методу [Thread::start()](thread.start.md) (успадкований
метод) доки об'єкт не вийде з області видимості, або поки
не буде примусово зупинено (за допомогою
[Worker::shutdown()](worker.shutdown.md)). Будь-який контекст має
посилання на цей об'єкт може додавати завдання на стек Worker (з
за допомогою [Worker::stack()](worker.stack.md)), які будуть запущені в
окремому потоці. Метод `run` об'єкта Worker буде запущений раніше, ніж
будь-який об'єкт з його стека завдань, що дає можливість ініціалізувати
необхідні для завдання ресурси.

Клас [Pool](class.pool.md) використовується для створення групи
виконавців (worker) для розподілу між ними об'єктів
[Threaded](class.threaded.md). Це найпростіший і найефективніший варіант
використання багатопоточності в PHP.

**Застереження**

Клас [Pool](class.pool.md) не успадковує
[Threaded](class.threaded.md), таким чином є звичайним об'єктом
PHP. Об'єкти цього класу не повинні розділятися за різними контекстами.

Клас [Volatile](class.volatile.md) доданий до pthreads v3. Він
використовується для завдання змінюваних
[Threaded](class.threaded.md)-властивостей класів типу
[Threaded](class.threaded.md) (оскільки тепер вони за замовчуванням
незмінні). Також використовується для зберігання масивів PHP у контексті
[Threaded](class.threaded.md).

Синхронізація – важлива частина багатопоточності. Усі об'єкти, створені
pthreads мають вбудовані методи для забезпечення синхронізації (вони
здадуться дуже знайомими для розробників на Java):
[Threaded::wait()](threaded.wait.md) та
[Threaded::notify()](threaded.notify.md). Виклик
[Threaded::wait()](threaded.wait.md) переведе об'єкт в очікування до
того моменту, поки з іншого контексту не буде викликано
[Threaded::notify()](threaded.notify.md) для очікуваного об'єкта. Цей
механізм дозволяє здійснювати синхронізацію між об'єктами
[Threaded](class.threaded.md).

**Застереження**

Будь-які об'єкти вашої програми, які передбачається використовувати в
багатопотоковому режимі, повинні успадковувати
[Threaded](class.threaded.md).

Зберігання даних: Як правило, в об'єкті Threaded можна використовувати
будь-які дані, які можуть бути серіалізовані. Вони можуть бути записані
та прочитані з будь-якого контексту через посилання на цей об'єкт. Не кожен
тип даних зберігається у серіалізованому вигляді. Базові типи зберігаються в них
істинної форми. Складні типи, масиви та об'єкти, що не є
Threaded, зберігаються серіалізованими; вони можуть бути прочитані або
записані в Threaded-об'єкт із будь-якого контексту за посиланням. За винятком
Threaded-об'єктів, всі посилання, що використовуються для установки властивості в
Threaded-об'єкт відокремлений від посилань всередині Threaded-об'єкта. Читання тих
даних можна проводити безпосередньо з будь-якого контексту за посиланням на
Threaded-об'єкт.

Статичні властивості: Коли створюється новий контекст (Thread або
Worker), вони просто копіюються, але ресурси та об'єкти обнуляються (з
міркування безпеки). Це дозволяє використовувати їх як локальні
для потоку сховища. Наприклад, під час створення контексту, для
класу, статичні властивості якого зберігають інформацію про з'єднання
БД і саме з'єднання, буде скопійовано тільки необхідну інформацію
для з'єднання, але не саме з'єднання. Це дозволить створити нове
з'єднання в новому контексті і зберегти його в тому ж місці не
торкаючись оригінального контексту.

**Застереження**

Коли запускаються print_r, var_dump або інші функції налагодження, вони
не включають захист від рекурсії.

> **Примітка**:
>
> Ресурси: Модулі та функціональність PHP, що створюють ресурси, абсолютно
> не підготовлені такого типу оточення; pthreads надає
> механізм поділу ресурсів між контекстами, проте більшість
> типів ресурсів слід вважати небезпечним. Розділяючи ресурс між
> контекстами необхідно бути дуже уважним та обережним.

**Застереження**

В оточенні, де запускається pthreads, необхідні деякі обмеження
та заборони для забезпечення стабільності.
