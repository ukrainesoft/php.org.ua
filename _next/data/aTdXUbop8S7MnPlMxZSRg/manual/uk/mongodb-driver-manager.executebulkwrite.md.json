{"pageProps":{"page":{"slug":"mongodb-driver-manager.executebulkwrite.md","content":"# MongoDB\\\\Driver\\\\Manager::executeBulkWrite\n\n(mongodb >=1.0.0)\n\nMongoDB\\\\Driver\\\\Manager::executeBulkWrite — Виконує одну або кілька операцій запису\n\n### Опис\n\n```methodsynopsis\nfinal public MongoDB\\Driver\\Manager::executeBulkWrite(string $namespace, MongoDB\\Driver\\BulkWrite $bulk, array|MongoDB\\Driver\\WriteConcern|null $options = null): MongoDB\\Driver\\WriteResult\n```\n\nВиконує одну або кілька операцій запису на основному сервері.\n\nОб'єкт класу [MongoDB\\\\Driver\\\\BulkWrite](class.mongodb-driver-bulkwrite.md) може бути створений з однією або декількома операціями запису різного типу (наприклад, оновлення, видалення та вставки). Драйвер спробує надіслати операції одного і того ж типу на сервер з мінімальною кількістю запитів, щоб скоротити звернення до сервера.\n\n### Список параметрів\n\n`namespace`(string)\n\nПовністю певне ім'я (тобто . `\"databaseName.collectionName\"`\n\n`bulk` [MongoDB\\\\Driver\\\\BulkWrite](class.mongodb-driver-bulkwrite.md)) .\n\nЗаписи для виконання.\n\n`опції`\n\n**options**\n\n| Опция | Тип | Опис |\n| --- | --- | --- |\n| session | [MongoDB\\\\Driver\\\\Session](class.mongodb-driver-session.md) |  |\n| Сесія зв'язування з операцією. |  |  |\n\n| | writeConcern |[MongoDB\\\\Driver\\\\WriteConcern](class.mongodb-driver-writeconcern.md)\n\nГарантія запису для застосування до операції.\n\n### Значення, що повертаються\n\nУ разі успішного виконання повертає [MongoDB\\\\Driver\\\\WriteResult](class.mongodb-driver-writeresult.md)\n\n### Помилки\n\n-   За відсутності будь-якої операції запису в`bulk`, викидає виняток[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)\n-   Якщо `bulk`вже був виконаний, викидає виняток[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md). Об'єкти[MongoDB\\\\Driver\\\\BulkWrite](class.mongodb-driver-bulkwrite.md)не можуть бути виконані кілька разів.\n-   Викидається [MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)якщо опція `\"session\"`вказано у поєднанні з непідтвердженою гарантією запису.\n-   При помилці парсингу аргумент кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)\n-   При невдалому з'єднанні з сервером (крім помилок аутентифікації) кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\ConnectionException](class.mongodb-driver-exception-connectionexception.md)\n-   У разі невдалої аутентифікації кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\AuthenticationException](class.mongodb-driver-exception-authenticationexception.md)\n-   При помилці запису кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\BulkWriteException](class.mongodb-driver-exception-bulkwriteexception.md)\n-   При помилці парсингу аргумент кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md)\n-   При невдалому з'єднанні з сервером (крім помилок аутентифікації) кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\ConnectionException](class.mongodb-driver-exception-connectionexception.md)\n-   У разі невдалої аутентифікації кидає виняток[MongoDB\\\\Driver\\\\Exception\\\\AuthenticationException](class.mongodb-driver-exception-authenticationexception.md)\n-   При виникненні інших помилок викидає виняток[MongoDB\\\\Driver\\\\Exception\\\\RuntimeException](class.mongodb-driver-exception-runtimeexception.md)\n\n### список змін\n\n| Версия | Опис |\n| --- | --- |\n| PECL mongodb 1.4.4 | Якщо опція `\"session\"` використовується у поєднанні з непідтвердженою гарантією запису, викидається виняток [MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md) |\n| PECL mongodb 1.4.0 | Третій параметр `options` тепер масив. Для зворотної сумісності цей параметр ще приймає об'єкт [MongoDB\\\\Driver\\\\WriteConcern](class.mongodb-driver-writeconcern.md) |\n| PECL mongodb 1.3.0 | Тепер викидається виняток[MongoDB\\\\Driver\\\\Exception\\\\InvalidArgumentException](class.mongodb-driver-exception-invalidargumentexception.md), якщо `bulk` не містить операцій запису. Раніше викидалося [MongoDB\\\\Driver\\\\Exception\\\\BulkWriteException](class.mongodb-driver-exception-bulkwriteexception.md) |\n\n### Приклади\n\n**Приклад #1 Приклад використання** MongoDB\\\\Driver\\\\Manager::executeBulkWrite()\\*\\*\\*\\*\n\n```php\n<?php\n\n$bulk = new MongoDB\\Driver\\BulkWrite();\n\n$bulk->insert(['_id' => 1, 'x' => 1]);\n$bulk->insert(['_id' => 2, 'x' => 2]);\n\n$bulk->update(['x' => 2], ['$set' => ['x' => 1]], ['multi' => false, 'upsert' => false]);\n$bulk->update(['x' => 3], ['$set' => ['x' => 3]], ['multi' => false, 'upsert' => true]);\n$bulk->update(['_id' => 3], ['$set' => ['x' => 3]], ['multi' => false, 'upsert' => true]);\n\n$bulk->insert(['_id' => 4, 'x' => 2]);\n\n$bulk->delete(['x' => 1], ['limit' => 1]);\n\n$manager = new MongoDB\\Driver\\Manager('mongodb://localhost:27017');\n$writeConcern = new MongoDB\\Driver\\WriteConcern(MongoDB\\Driver\\WriteConcern::MAJORITY, 100);\n$result = $manager->executeBulkWrite('db.collection', $bulk, $writeConcern);\n\nprintf(\"Добавлено %d документ(ов)\\n\", $result->getInsertedCount());\nprintf(\"Найдено %d документ(ов)\\n\", $result->getMatchedCount());\nprintf(\"Обновлено %d документ(ов)\\n\", $result->getModifiedCount());\nprintf(\"Добавлено и добавлено %d документ(ов)\\n\", $result->getUpsertedCount());\nprintf(\"Удалено %d документ(ов)\\n\", $result->getDeletedCount());\n\nforeach ($result->getUpsertedIds() as $index => $id) {\n    printf('upsertedId[%d]: ', $index);\n    var_dump($id);\n}\n\n/* Если WriteConcern не может быть выполнен */\nif ($writeConcernError = $result->getWriteConcernError()) {\n    printf(\"%s (%d): %s\\n\", $writeConcernError->getMessage(), $writeConcernError->getCode(), var_export($writeConcernError->getInfo(), true));\n}\n\n/* Если запись не может произойти вообще*/\nforeach ($result->getWriteErrors() as $writeError) {\n    printf(\"Операция#%d: %s (%d)\\n\", $writeError->getIndex(), $writeError->getMessage(), $writeError->getCode());\n}\n?>\n```\n\nВисновок наведеного прикладу буде схожим на:\n\n```\nДобавлено 3 документ(ов)\nНайдено 1 документ(ов)\nОбновлено 1 документ(ов)\nДобавлено и добавлено 2 документ(ов)\nУдалено 1 документ(ов)\nupsertedId[3]: object(MongoDB\\BSON\\ObjectId)#5 (1) {\n  [\"oid\"]=>\n  string(24) \"54d3adc3ce7a792f4d703756\"\n}\nupsertedId[4]: int(3)\n```\n\n### Дивіться також\n\n-   [MongoDB\\\\Driver\\\\BulkWrite](class.mongodb-driver-bulkwrite.md)\n-   [MongoDB\\\\Driver\\\\WriteResult](class.mongodb-driver-writeresult.md)\n-   [MongoDB\\\\Driver\\\\WriteConcern](class.mongodb-driver-writeconcern.md)\n-   [MongoDB\\\\Driver\\\\Server::executeBulkWrite()](mongodb-driver-server.executebulkwrite.md) \\- Виконати одну або кілька операцій запису на сервері\n","title":"MongoDB\\\\Driver\\\\Manager::executeBulkWrite","contentType":2,"navigation":[{"mongodb-driver-manager.createclientencryption.md":"« MongoDB\\\\Driver\\\\Manager::createClientEncryption"},{"mongodb-driver-manager.executecommand.md":"MongoDB\\\\Driver\\\\Manager::executeCommand »"},{"index.md":"PHP Manual"},{"class.mongodb-driver-manager.md":"MongoDB\\\\Driver\\\\Manager"}]}},"__N_SSG":true}