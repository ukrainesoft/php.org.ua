{"pageProps":{"page":{"slug":"mysqli.quickstart.multiple-statement.md","content":"## Множинні запити\n\nMySQL підтримує наявність кількох SQL-запитів у тексті одного запиту, але потребує особливого звернення. Пересилання на сервер декількох виразів в одному запиті зменшує кількість клієнт-серверних взаємодій, але потребує спеціальної обробки.\n\nМножинні запити або мультизапити повинні запускатися функцією [mysqli::multi\\_query()](mysqli.multi-query.md). Окремі SQL-пропозиції у мультизапиті відокремлюються крапкою з комою. Після виконання мультизапиту, всі результуючі набори, які він повернув, необхідно витягти.\n\nMySQL-сервер підтримує наявність в одному мультизапиті підзапитів, що повертають результуючий набір, так і не повертають.\n\n**Приклад #1 Множинні запити**\n\n```php\n<?php\n\nmysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);\n$mysqli = new mysqli(\"example.com\", \"user\", \"password\", \"database\");\n\n$mysqli->query(\"DROP TABLE IF EXISTS test\");\n$mysqli->query(\"CREATE TABLE test(id INT)\");\n\n$sql = \"SELECT COUNT(*) AS _num FROM test;\n        INSERT INTO test(id) VALUES (1);\n        SELECT COUNT(*) AS _num FROM test; \";\n\n$mysqli->multi_query($sql);\n\ndo {\n    if ($result = $mysqli->store_result()) {\n        var_dump($result->fetch_all(MYSQLI_ASSOC));\n        $result->free();\n    }\n} while ($mysqli->next_result());\n```\n\nРезультат виконання наведеного прикладу:\n\n```\narray(1) {\n  [0]=>\n  array(1) {\n    [\"_num\"]=>\n    string(1) \"0\"\n  }\n}\narray(1) {\n  [0]=>\n  array(1) {\n    [\"_num\"]=>\n    string(1) \"1\"\n  }\n}\n```\n\n**Розгляд аспектів безпеки**\n\nФункции API[mysqli::query()](mysqli.query.md) і [mysqli::real\\_query()](mysqli.real-query.md) під час роботи не встановлюють на сервері спеціальний прапор, необхідний виконання мультизапросов. Окрема функція API для мультизапитів дозволяє знизити ймовірність випадкових SQL-ін'єкцій. Зловмисник може спробувати додати до кінця запиту виразу, на кшталт `; DROP DATABASE mysql`или`; SELECT SLEEP(999)`. Якщо йому це вдасться, але не використовуватиметься функція [mysqli::multi\\_query()](mysqli.multi-query.md), сервер не виконає впроваджений та небезпечний SQL-вираз.\n\n**Приклад #2 SQL-ін'єкція**\n\n```php\n<?php\nmysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);\n$mysqli = new mysqli(\"example.com\", \"user\", \"password\", \"database\");\n$result = $mysqli->query(\"SELECT 1; DROP TABLE mysql.user\");\n?>\n```\n\nРезультат виконання наведеного прикладу:\n\n```\nPHP Fatal error:  Uncaught mysqli_sql_exception: You have an error in your SQL syntax;\ncheck the manual that corresponds to your MySQL server version for the right syntax to\nuse near 'DROP TABLE mysql.user' at line 1\n```\n\n**Підготовлювані запити**\n\nВикористання безлічі виразів у запиті, що готується, не підтримується.\n\n**Дивіться також**\n\n-   [mysqli::query()](mysqli.query.md)\n-   [mysqli::multi\\_query()](mysqli.multi-query.md)\n-   [mysqli::next\\_result()](mysqli.next-result.md)\n-   [mysqli::more\\_results()](mysqli.more-results.md)\n","title":"Множинні запити","contentType":2,"navigation":[{"mysqli.quickstart.stored-procedures.md":"« Збережені процедури"},{"mysqli.quickstart.transactions.md":"API підтримка транзакцій »"},{"index.md":"PHP Manual"},{"mysqli.quickstart.md":"Короткий посібник"}]}},"__N_SSG":true}