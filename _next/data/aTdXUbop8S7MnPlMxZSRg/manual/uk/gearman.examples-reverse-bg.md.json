{"pageProps":{"page":{"slug":"gearman.examples-reverse-bg.md","content":"## Базовий клієнт та обробник Gearman, фоновий режим\n\n**Приклад #1 Базовий клієнт та обробник Gearman, фоновий режим**\n\nЦей приклад демонструє базову роботу з клієнтом та його обробником. Клієнт відправляє рядок серверу виконання завдань у вигляді фонового завдання, а обробник перевертає рядок. Зверніть увагу, робота виконується асинхронно, тобто. клієнт не чекає завершення завдання, а одразу відключається (а значить і не отримує результату).\n\n```php\n<?php\n\n# создание объекта\n$gmclient= new GearmanClient();\n\n# указание сервера по умолчанию (localhost)\n$gmclient->addServer();\n\n# выполнение в фоновом режиме\n$job_handle = $gmclient->doBackground(\"reverse\", \"this is a test\");\n\nif ($gmclient->returnCode() != GEARMAN_SUCCESS)\n{\n  echo \"bad return code\\n\";\n  exit;\n}\n\necho \"done!\\n\";\n\n?>\n```\n\n```php\n<?php\n\necho \"Starting\\n\";\n\n# Создание обработчика.\n$gmworker= new GearmanWorker();\n\n# Указание сервера по умолчанию (localhost).\n$gmworker->addServer();\n\n# Регистрация функции \"reverse\" на сервере. Изменение функции обработчика на\n# \"reverse_fn_fast\" для более быстрой обработки без вывода.\n$gmworker->addFunction(\"reverse\", \"reverse_fn\");\n\nprint \"Waiting for job...\\n\";\nwhile($gmworker->work())\n{\n  if ($gmworker->returnCode() != GEARMAN_SUCCESS)\n  {\n    echo \"return_code: \" . $gmworker->returnCode() . \"\\n\";\n    break;\n  }\n}\n\nfunction reverse_fn($job)\n{\n  echo \"Received job: \" . $job->handle() . \"\\n\";\n\n  $workload = $job->workload();\n  $workload_size = $job->workloadSize();\n\n  echo \"Workload: $workload ($workload_size)\\n\";\n\n  # Этот цикл не является необходимым, но показывает как выполняется работа\n  for ($x= 0; $x < $workload_size; $x++)\n  {\n    echo \"Sending status: \" . ($x + 1) . \"/$workload_size complete\\n\";\n    $job->sendStatus($x, $workload_size);\n    sleep(1);\n  }\n\n  $result= strrev($workload);\n  echo \"Result: $result\\n\";\n\n  # Возвращаем, когда необходимо отправить результат обратно клиенту.\n  return $result;\n}\n\n# Гораздо более простая и менее подробная версия вышеприведённой функции выглядит так:\nfunction reverse_fn_fast($job)\n{\n  return strrev($job->workload());\n}\n\n?>\n```\n\nВисновок наведеного прикладу буде схожим на:\n\n```\n% php reverse_worker.php\nStarting\nWaiting for job...\nReceived job: H:foo.local:41\nWorkload: this is a test (14)\n1/14 complete\n2/14 complete\n3/14 complete\n4/14 complete\n5/14 complete\n6/14 complete\n7/14 complete\n8/14 complete\n9/14 complete\n10/14 complete\n11/14 complete\n12/14 complete\n13/14 complete\n14/14 complete\nResult: tset a si siht\n```\n\n```\n% php reverse_client_bg.php\ndone!\n```\n","title":"Базовий клієнт та обробник Gearman, фоновий режим","contentType":2,"navigation":[{"gearman.examples-reverse.md":"« Базове використання"},{"gearman.examples-reverse-task.md":"Базові клієнт та обробник Gearman, відправка завдань »"},{"index.md":"PHP Manual"},{"gearman.examples.md":"Приклади"}]}},"__N_SSG":true}