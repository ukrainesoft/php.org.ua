- [« Установка](mysqlnd.install.md)
- [Несумісності »](mysqlnd.incompatibilities.md)

- [PHP Manual](index.md)
- [Mysqlnd](book.mysqlnd.md)
- Налаштування під час виконання

# Налаштування під час виконання

Поведінка цих функцій залежить від установок `php.ini`.

| Ім'я За замовчуванням | Місце зміни | Список змін |
|------------------------------------------------- -----------------------------------------------|-- ------------------------------|-----------------|- -------------------------------------------------- -------------------------------------------|
| [mysqlnd.collect_statistics](mysqlnd.config.md#ini.mysqlnd.collect-statistics) | "1" | PHP_INI_SYSTEM | |
| [mysqlnd.collect_memory_statistics](mysqlnd.config.md#ini.mysqlnd.collect-memory-statistics) | "0" | PHP_INI_SYSTEM | |
| [mysqlnd.debug](mysqlnd.config.md#ini.mysqlnd.debug) | "" | PHP_INI_SYSTEM | |
| [mysqlnd.log_mask](mysqlnd.config.md#ini.mysqlnd.log-mask) | 0 | PHP_INI_ALL | |
| [mysqlnd.mempool_default_size](mysqlnd.config.md#ini.mysqlnd.mempool-default-size) | 16000 | PHP_INI_ALL | |
| [mysqlnd.net_read_timeout](mysqlnd.config.md#ini.mysqlnd.net-read-timeout) | "86400" | PHP_INI_ALL | До PHP 7.2.0 значенням "31536000", а місцем зміни було **`PHP_INI_SYSTEM`** |
| [mysqlnd.net_cmd_buffer_size](mysqlnd.config.md#ini.mysqlnd.net-cmd-buffer-size) | 5.3.0 – "2048", 5.3.1 – "4096" | PHP_INI_SYSTEM | |
| [mysqlnd.net_read_buffer_size](mysqlnd.config.md#ini.mysqlnd.net-read-buffer-size) | "32768" | PHP_INI_SYSTEM | |
| [mysqlnd.sha256_server_public_key](mysqlnd.config.md#ini.mysqlnd.sha256-server-public-key) | "" | PHP_INI_PERDIR | |
| [mysqlnd.trace_alloc](mysqlnd.config.md#ini.mysqlnd.trace-alloc) | "" | PHP_INI_SYSTEM | |
| [mysqlnd.fetch_data_copy](mysqlnd.config.md#ini.mysqlnd.fetch_data_copy) | 0 | PHP_INI_ALL | |

**Параметри конфігурації вбудованого драйвера MySQL**

Для детального опису констант PHP_INI\_\*, зверніться до розділу [Де
можуть бути встановлені параметри
конфігурації] (configuration.changes.modes.md).

Коротке пояснення конфігураційних директив.

`mysqlnd.collect_statistics` bool
Включає в себе збір різної статистики клієнта, доступ до якої можна
отримати за допомогою
[mysqli_get_client_stats()](function.mysqli-get-client-stats.md),
[mysqli_get_connection_stats()](mysqli.get-connection-stats.md), та
яка відображається у розділі `mysqlnd` виведення функції
[phpinfo()](function.phpinfo.md).

Цей параметр конфігурації включає всю [статистику вбудованого драйвера
MySQL](mysqlnd.stats.md), крім що стосується роботи з оперативною
пам'яттю.

`mysqlnd.collect_memory_statistics` bool
Включає в себе збір різної статистики оперативної пам'яті, доступ до якої
можна отримати за допомогою
[mysqli_get_client_stats()](function.mysqli-get-client-stats.md),
[mysqli_get_connection_stats()](mysqli.get-connection-stats.md), та
яка відображається у розділі `mysqlnd` виведення функції
[phpinfo()](function.phpinfo.md).

Цей параметр конфігурації включає всю статистику, що стосується роботи
з оперативною пам'яттю, до загального набору даних [статистики вбудованого
драйвера MySQL] (mysqlnd.stats.md).

`mysqlnd.debug` string
Записує команди з усіх модулів, що використовують `mysqlnd`, у вказаний
файл із логами.

Формат параметра наступний:
`mysqlnd.debug u003d "option1[,parameter_option1][:option2[,parameter_option2]]"`.

Можливі нижченаведені значення для рядка форматування:

- A\[,file\] - додає виведення трасування у вказаний файл. Також
щоразу перевіряє успішність запису даних. Це реалізовано шляхом
закриття та повторного відкриття файлу (що досить повільно). Дає
гарантію цілісності файлу з логами у разі виникнення помилки
програми.

- a\[,file\] - додає виведення трасування у вказаний файл.

- d - Включає виведення з макросу DBUG\_\<N\> для поточного стану.
Може бути доповнено списком ключових слів, щоб вибрати висновок
тільки що містить ці ключові слова макросів DBUG. Порожній список
Ключових слів має на увазі виведення всіх макросів.

- f\[,functions\] - обмежує дії відладчика вказаним списком
функцій. Порожній список функцій має на увазі вибір усіх функцій.

- F - позначає виведення кожного рядка відладчика назвою вихідного
файлу, що містить код, що спричинив висновок.

- i - позначає виведення кожного рядка відладчика PID поточного процесу.

- L - позначає виведення кожного рядка відладчика назвою вихідного
файлу, що викликав висновок, та номером рядка у ній.

- n - позначає виведення кожного рядка відладчика рівнем вкладеності
поточної функції.

- o\[,file\] - подібно до a\[,file\], але перезаписує старий файл, а
не дописує його.

- O\[,file\] - подібно до A\[,file\] але перезаписує старий файл, а не
дописує його.

- t\[,N\] - включає контроль функцій під час трасування.
Максимальний рівень вкладеності визначено N і за замовчуванням дорівнює
200.

- x – цей параметр активує профіль.

- m - відслідковувати виклики, пов'язані з виділеннями та вивільненням
пам'яті.

Приклад:

d:t:x:O,/tmp/mysqlnd.trace

> **Примітка**:
>
> Ця можливість доступна лише для налагоджувального складання PHP. Працює на
> Microsoft Windows при використанні налагоджувального складання PHP, якщо PHP
> був зібраний за допомогою Microsoft Visual C версії 9 та вище.

`mysqlnd.log_mask` int
Визначає, які запити журналюватимуться. Значення за замовчуванням -
0, що вимикає журнал. Значення параметра – тільки ціле
число, константи PHP використовувати не можна. Наприклад, при значенні 48
(16 + 32) в журнал будуть записуватися повільні запити, які або
використовують невідповідні індекси (SERVER_QUERY_NO_GOOD_INDEX_USED u003d 16),
або використовують їх взагалі SERVER_QUERY_NO_INDEX_USED u003d 32). При
значенні 2043 (1 + 2 + 8 + ... + 1024) в журнал записуватимуться всі
типи повільних запитів.

Використовуються такі типи запитів: SERVER_STATUS_IN_TRANSu003d1,
SERVER_STATUS_AUTOCOMMITu003d2, SERVER_MORE_RESULTS_EXISTSu003d8,
SERVER_QUERY_NO_GOOD_INDEX_USEDu003d16, SERVER_QUERY_NO_INDEX_USEDu003d32,
SERVER_STATUS_CURSOR_EXISTSu003d64, SERVER_STATUS_LAST_ROW_SENTu003d128,
SERVER_STATUS_DB_DROPPEDu003d256, SERVER_STATUS_NO_BACKSLASH_ESCAPESu003d512,
and SERVER_QUERY_WAS_SLOWu003d1024.

`mysqlnd.mempool_default_size` int
Більшість розміру mysqlnd memory pool, which is used by result sets.

`mysqlnd.net_read_timeout` int
`mysqlnd` та клієнтська бібліотека MySQL, `libmysqlclient`, використовують
різні мережеві API. `mysqlnd` використовує потоки PHP, тоді як
`libmysqlclient` - власну обгортку над мережевими викликами
ОС. У PHP за замовчуванням виставлено 60-секундний час
очікування потоків. Цей параметр виставляється в `php.ini` директивою
`default_socket_timeout`. За умовчанням це стосується всіх потоків,
яким не встановлено інше значення часу очікування. `mysqlnd` не
встановлював інших значень, тому підключення довго виконуються
запитів можуть бути відключені після `default_socket_timeout` секунд з
помилкою "2006 - MySQL Server has gone away". Клієнтська бібліотека MySQL
встановлює час очікування за замовчуванням, що дорівнює 24 \* 3600 секунд (1
день) і чекає на виникнення іншого часу очікування, такого як час
очікування TCP/IP. Тепер `mysqlnd` використовує такий самий дуже довгий час
очікування. Це значення можна змінити через нову директиву `php.ini` -
`mysqlnd.net_read_timeout`. `mysqlnd.net_read_timeout` буде
використовуватись будь-яким модулем (`ext/mysql`, `ext/mysqli`, `PDO_MySQL`),
які використовують `mysqlnd`. `mysqlnd` вказує потокам PHP використовувати
`mysqlnd.net_read_timeout`. Будь ласка, зверніть увагу, що можуть
бути невеликі відмінності між `MYSQL_OPT_READ_TIMEOUT` у клієнтській
бібліотеці MySQL і потоках PHP, наприклад, судячи з документації,
`MYSQL_OPT_READ_TIMEOUT` працює тільки для TCP/IP-підключень та,
аж до MySQL 5.1.2, лише під Windows. Потоки PHP можуть не мати
подібних обмежень. У разі сумнівів прохання звірятися з
документації потоків.

`mysqlnd.net_cmd_buffer_size` int
`mysqlnd` резервує внутрішній командно-мережевий буфер розміром
`mysqlnd.net_cmd_buffer_size` (в `php.ini`) байт для кожного з'єднання.
Якщо команда клієнт-серверного протоколу MySQL, наприклад, `COM_QUERY`
("звичайний" запит), не вміщується в буфер, `mysqlnd` збільшить буфер до
розміру, необхідного для надсилання команди. Щоразу, коли буфер був
збільшено, змінна статистика `command_buffer_too_small` буде
збільшено на один.

Якщо `mysqlnd` доводиться збільшувати буфер понад його заданий розмір
в `mysqlnd.net_cmd_buffer_size` байт для більшості з'єднань, вам
слід обміркувати необхідність збільшення розміру за замовчуванням, щоб
уникнути повторних резервацій буфера.

Розмір за замовчуванням буфера складає 4096 байт, що є найменшим
можливим значенням.

Це значення також може бути встановлене функцією
`mysqli_options(link, MYSQLI_OPT_NET_CMD_BUFFER_SIZE, size)`.

`mysqlnd.net_read_buffer_size` int
Максимальний розмір частини даних при зчитуванні, у байтах, при обробці
тіла командного пакета MySQL Клієнт-серверний протокол MySQL
обертає всі свої команди у пакети. Пакет складається з невеликого
заголовка та тіла, що містить безпосередньо дані команди. Розмір
тіла закодований у заголовку. `mysqlnd` зчитує тіло частинами по
`MIN(header.size, mysqlnd.net_read_buffer_size)` байт. Якщо розмір тіла
пакету більше, ніж `mysqlnd.net_read_buffer_size` байт, `mysqlnd` буде
викликати `read()` кілька разів.

Це значення також може бути встановлене функцією
`mysqli_options(link, MYSQLI_OPT_NET_READ_BUFFER_SIZE, size)`.

`mysqlnd.sha256_server_public_key` string
Ця опція відноситься до плагіна автентифікації SHA-256 і містить шлях
до файлу з публічним ключем RSA MySQL-сервера.

Клієнт може як не вказувати публічний ключ RSA, вказати його за допомогою
даної опції, або встановити ключ під час виконання за допомогою функції
[mysqli_options()](mysqli.options.md). Якщо публічний ключ RSA не був
переданий клієнтом, то ключ буде отримано в результаті стандартної
процедури аутентифікації плагіна аутентифікації SHA-256

`mysqlnd.trace_alloc` string

`mysqlnd.fetch_data_copy` int
Примушує копіювати набори з внутрішнього буфера наборів PHP
змінні замість використання логіки з посиланнями та "копіюванням при
запису" за замовчуванням. Дивіться [Реалізація управління
пам'яттю](mysqlnd.memory.md) для отримання більшої інформації.

Копіювання результуючих наборів замість PHP змінних посилаються на
Їх дозволяють виділяти пам'ять для PHP змінних заздалегідь. В залежності
від коду користувача, реальних запитів до бази даних та розмірів їх
результатів можна знизити споживання пам'яті mysqlnd.

Не використовуйте, якщо використовується PDO_MySQL. У PDO_MySQL ще не додана
підтримка нового режиму.
