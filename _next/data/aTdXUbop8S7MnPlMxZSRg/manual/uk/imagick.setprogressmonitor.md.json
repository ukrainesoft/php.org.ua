{"pageProps":{"page":{"slug":"imagick.setprogressmonitor.md","content":"# Imagick::setProgressMonitor\n\n(PECL imagick 3 >= 3.3.0)\n\nImagick::setProgressMonitor — Встановлює callback-функцію, яка буде викликатись під час обробки зображення Imagick\n\n### Опис\n\n```methodsynopsis\npublic Imagick::setProgressMonitor(callable $callback): bool\n```\n\nВстановлює callback-функцію, яка буде викликатись під час обробки зображення Imagick.\n\n### Список параметрів\n\n`callback`\n\nCallback – функція прогресу для виклику. Вона повинна повернути true, якщо обробка зображення повинна продовжуватися, або false, якщо її потрібно скасувати. Параметр offset вказує на прогрес, а параметр span - загальний обсяг роботи, який необхідно виконати.\n\n```methodsynopsis\n\n       callback\n      (\n       mixed $offset\n      , \n       mixed\n        $span\n      ): bool\n```\n\n**Застереження**\n\nЗначення, що передаються в callback-функцію, не узгоджені. Зокрема параметр span може збільшуватися під час обробки зображення. Через це обчислення прогресу виконання операції із зображенням у відсотках не є тривіальним.\n\n### Значення, що повертаються\n\nУ разі успішної роботи повертає **`true`**\n\n### Приклади\n\n**Приклад #1 Приклад використання** Imagick::setProgressMonitor()\\*\\*\\*\\*\n\n```php\n<?php\n        $abortReason = null;\n\n        try {\n            $imagick = new \\Imagick(realpath($this->control->getImagePath()));\n            $startTime = time();\n\n            $callback = function ($offset, $span)  use ($startTime, &$abortReason) {\n                if (((100 * $offset) / $span)  > 20) {\n                    $abortReason = \"Обработка достигла 20%\";\n                    return false;\n                }\n\n                $nowTime = time();\n\n                if ($nowTime - $startTime > 5) {\n                    $abortReason = \"Обработка изображения заняла более 5 секунд\";\n                    return false;\n                }\n                if (($offset % 5) == 0) {\n                    echo \"Прогресс: $offset / $span <br/>\";\n                }\n                return true;\n            };\n\n            $imagick->setProgressMonitor($callback);\n\n            $imagick->waveImage(2, 15);\n\n            echo \"Длина данных: \".strlen($imagick->getImageBlob());\n        }\n        catch(\\ImagickException $e) {\n            if ($abortReason != null) {\n                echo \"Обработка изображения была прервана: \".$abortReason.\"<br/>\";\n            }\n            else {\n                echo \"Поймано исключение ImagickException: \".$e->getMessage().\" Тип исключения - \".get_class($e);\n            }\n        }\n\n?>\n```\n","title":"Imagick::setProgressMonitor","contentType":2,"navigation":[{"imagick.setpointsize.md":"« Imagick::setPointSize"},{"imagick.setregistry.md":"Imagick::setRegistry »"},{"index.md":"PHP Manual"},{"class.imagick.md":"Imagick"}]}},"__N_SSG":true}