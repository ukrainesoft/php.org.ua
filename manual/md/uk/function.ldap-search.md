- [« ldap_sasl_bind](function.ldap-sasl-bind.md)
- [ldap_set_option »](function.ldap-set-option.md)

- [PHP Manual](index.md)
- [Функції LDAP](ref.ldap.md)
- Пошук по LDAP дереву

#ldap_search

(PHP 4, PHP 5, PHP 7, PHP 8)

ldap_search — Пошук по LDAP дереву

### Опис

**ldap_search**(
[LDAP\Connection](class.ldap-connection.md)\|array `$ldap`,
array\|string `$base`,
array\|string `$filter`,
array `$attributes` u003d \[\],
int `$attributes_only` u003d 0,
int `$sizelimit` u003d -1,
int `$timelimit` u003d -1,
int `$deref` u003d **`LDAP_DEREF_NEVER`**,
?array `$controls` u003d **`null`**
): [LDAP\Result](class.ldap-result.md)\|array\|false

Виконує пошук для зазначеного фільтра у директорії з межами
**`LDAP_SCOPE_SUBTREE`**. Еквівалентно пошуку по всьому каталогу.

Починаючи з 4.0.5 також можна проводити паралельний пошук. Щоб це
зробити, необхідно використовувати як перший параметр масив
ідентифікаторів посилань, а чи не єдиний ідентифікатор. Якщо
необхідності використовувати те ж саме основне DN і той же фільтр
для всіх пошуків немає, то можна використовувати масив базових DN та/або
масив фільтрів. Ці масиви повинні мати такий самий розмір, як і масив
ідентифікаторів посилань, тому що перші записи масивів використовуються для
одного пошуку, другі записи використовуються для іншого і таке інше. При
виконанні паралельного пошуку повертається масив ідентифікаторів
результатів пошуку, крім помилкових випадків, тоді запис,
відповідна пошуку, дорівнюватиме **`false`**. Це схоже на звичайний
пошук, коли повертається значення, за винятком того, що
ідентифікатор результату завжди повертається після пошуку.
Є деякі поодинокі випадки, коли звичайний пошук повертає
**`false`**, тоді як паралельний пошук повертає ідентифікатор.

### Список параметрів

`ldap`
Примірник [LDAP\Connection](class.ldap-connection.md), що повертається
функцією [ldap_connect()](function.ldap-connect.md).

`base`
Базове DN для каталогу.

`filter`
Пошуковий фільтр може бути простим або розширеним, використовуючи булеви
оператори у форматі, описаному в документації LDAP (дивіться [» Netscape
Directory
SDK](https://wiki.mozilla.org/Mozilla_LDAP_SDK_Programmer%27s_Guide/Searching_the_Directory_With_LDAP_C_SDK)
або [»RFC4515](http://www.faqs.org/rfcs/rfc4515) для повної інформації
про фільтри).

`attributes`
Масив необхідних атрибутів, наприклад, `array("mail", "sn", "cn")`.
Зверніть увагу, що "dn" завжди повертається, незалежно від того,
які типи атрибутів потрібні.

Використання цього параметра набагато ефективніше, ніж дія по
замовчуванням (яке має повернути всі атрибути та привласнені ним
значення). Тому використання цього параметра вважається гарним
практикою.

`attributes_only`
Повинний дорівнювати 1, якщо потрібні тільки типи атрибута. Якщо дорівнює 0,
то, за замовчуванням, вибираються типи атрибутів і значення.

`sizelimit`
Дозволяє обмежити кількість вибраних записів. Встановлення цього
параметра дорівнює 0 означає, що обмеження відсутнє.

> **Примітка**:
>
> Цей параметр НЕ може перевизначати попереднє встановлення sizelimit на
> стороні сервера. Хоча його можна встановити нижче.
>
> Деякі хости серверів каталогів будуть налаштовані так, щоб
> Повернути не більше, ніж попередньо встановлена кількість записів.
> Якщо це станеться, сервер вкаже, що повернув тільки частковий
> Набір результатів. Це також відбувається, якщо Ви використовуєте цей
> параметр, щоб обмежити кількість вибраних записів.

`timelimit`
Встановлює кількість секунд, що обмежує процес пошуку. Встановлення
цього параметра дорівнює 0 означає, що обмеження відсутня.

> **Примітка**:
>
> Цей параметр НЕ може перевизначати передустановку timelimit на
> стороні сервера. Хоча його можна встановити нижче.

`deref`
Визначає, як псевдоніми повинні бути оброблені під час пошуку. Може
бути одним із наступних:

- **`LDAP_DEREF_NEVER`** - (за замовчуванням) псевдоніми ніколи не
розіменовуються.
- **`LDAP_DEREF_SEARCHING`** - псевдоніми повинні бути розіменовані у
час пошуку, але не при визначенні розташування базового об'єкта
пошуку.
- **`LDAP_DEREF_FINDING`** - псевдоніми повинні бути розіменовані при
визначення розташування базового об'єкта, але не під час пошуку.
- **`LDAP_DEREF_ALWAYS`** - псевдоніми повинні розіменовуватися
завжди.

`controls`
Масив [керуючих констант LDAP](ldap.controls.md) для надсилання в
запит.

### Значення, що повертаються

Повертає екземпляр [LDAP\Result](class.ldap-result.md) або
**`false`** у разі виникнення помилки.

### Список змін

| Версія | Опис |
|--------|---------------------------------------- -------------------------------------------------- -------------------------------------------------- ---------------|
| 8.1.0 | Параметр `ldap` тепер очікує на екземпляр [LDAP\Connection](class.ldap-connection.md); раніше очікувався ресурс ([resource](language.types.resource.md)). |
| 8.1.0 | Повертає екземпляр [LDAP\Result](class.ldap-result.md); раніше повертався ресурс ([resource](language.types.resource.md)). |
| 8.0.0 | `controls` тепер припускає значення null; раніше значення за промовчанням було `[]`. |
| 7.3 | Додано підтримку параметра `controls` |

### Приклади

Приклад нижче отримує організаційну одиницю, прізвище, ім'я та адресу
електронної пошти для всіх людей у "My Company", де прізвище або ім'я
містять підрядок `$person`. Цей приклад використовує логічний фільтр,
щоб сказати серверу, що потрібно шукати інформацію більше, ніж в одному
атрибут.

**Приклад #1 LDAP пошук**

` <?php//$$ds вірний ідентифікатор посилання на сервер директорії// $person все або частина імені людини, н-р "Jo"$dn u003d "ou003dMy Compan|| (snu003d$person*)(givennameu003d$person*))";$justthese u003d array("ou", "sn", "givenname", "mail");$sru003dldap_search($ds, $dn, $filter, $justthese);$info u003d ldap_get_entries($ds, $sr);echo $info["count"]." записів повернуто
";?> `
